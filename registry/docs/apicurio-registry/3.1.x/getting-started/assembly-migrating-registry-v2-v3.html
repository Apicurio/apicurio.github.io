<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Migrating an existing Apicurio Registry deployment :: Apicurio Registry</title>
    <link rel="canonical" href="https://www.apicur.io/registry/docs/apicurio-registry/3.1.x/getting-started/assembly-migrating-registry-v2-v3.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="../../../assets/css/site.css">
    <link rel="stylesheet" href="https://www.apicur.io/css/rhbar.css">
<link rel="stylesheet" href="../../../assets/css/search.css">
    <link rel="shortcut icon" href="https://www.apicur.io/images/favicon.ico" type="image/x-icon" integrity="sha384-if9KH+NQ2dMhdrWu+INnJTcvG6riRakUAnbhecX5a7voubrapo7ouFGS+GYZ/N4P" crossorigin="anonymous"/>
  </head>
  <body class="article">
<div class="masthead-wrapper">
    <div class="search-box">
        <input id="search-input" type="text" placeholder="Search docs">
    </div>
    <div class="masthead">
        <div class="logo-wrapper">
            <a href="/"><img src="https://www.apicur.io/images/apicurio_headerlogo.png" class="project-logo"
                    title="Apicurio"></a>
        </div>
        <div class="menu-wrapper">
            <ul id="menu" class="menu">
                <li>
                    <a href="/studio/" id="menu-item-studio">Studio</a>
                </li>
                <li>
                    <a href="/registry/" id="menu-item-registry">Registry</a>
                </li>
                <li>
                    <a href="/datamodels/">Data Models</a>
                </li>
                <li>
                    <a href="/apicurito/">Apicurito</a>
                </li>
                <li>
                    <a href="/blog/">Blog</a>
                </li>
                <li>
                    <a href="/contact/">Contact</a>
                </li>
                <li>
                    <a href="https://github.com/apicurio">Fork</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<script>
    var currentURL = window.location.href;
    var studioAnchor = document.getElementById("menu-item-studio");
    var registryAnchor = document.getElementById("menu-item-registry");

    if (currentURL.includes("studio")) {
        studioAnchor.classList.add("active");
    } else if (currentURL.includes("registry")) {
        registryAnchor.classList.add("active");
    }
</script>
<div class="body">
<div class="nav-container" data-component="apicurio-registry" data-version="3.1.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apicurio Registry</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-intro-to-the-registry.html">Introduction to Apicurio Registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-intro-to-registry-rules.html">Apicurio Registry content rules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-installing-registry-docker.html">Installing Apicurio Registry using Docker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-installing-registry-openshift.html">Installing Apicurio Registry on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-installing-registry-storage-openshift.html">Installing Apicurio Registry storage on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-deploying-registry-operator.html">Deploying Apicurio Registry using the Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-registry-high-availability.html">Deploying Apicurio Registry for high availability</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Migration</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="assembly-migrating-registry-v2-v3.html">Migrating an existing Apicurio Registry deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-configuring-registry-security.html">Configuring Apicurio Registry security options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-configuring-the-registry.html">Configuring your Apicurio Registry deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Client applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-managing-registry-artifacts-ui.html">Managing Apicurio Registry content using the web console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-managing-registry-artifacts-api.html">Managing Apicurio Registry content using the REST API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-using-the-registry-client.html">Managing Apicurio Registry content using a SDK</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-managing-registry-artifacts-maven.html">Managing Apicurio Registry content using the Maven plug-in</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Apache Flink integration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-using-flink-catalog.html">Using Apicurio Registry with Apache Flink</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Kafka client serializers/deserialisers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-using-kafka-client-serdes.html">Validating Kafka messages using serializers/deserializers in Java clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-configuring-kafka-client-serdes.html">Configuring Kafka serializers/deserializers in Java clients</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="guide-exporting-registry-kafka-topic-data.html">Exporting Apicurio Registry Kafka topic data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">AI Agent Integration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-a2a-features.html">A2A Protocol Features in Apicurio Registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-llm-artifact-types-implementation.html">LLM Artifact Types Implementation Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-artifact-reference.html">Apicurio Registry artifact reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-rule-reference.html">Apicurio Registry content rule reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-config-reference.html">Apicurio Registry configuration reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-operator-config-reference.html">Apicurio Registry Operator configuration reference</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apicurio Registry</span>
    <span class="version">3.1.x</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apicurio Registry</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">3.1.x</a>
        </li>
        <li class="version">
          <a href="../../3.0.x/index.html">3.0.x</a>
        </li>
        <li class="version">
          <a href="../../2.6.x/index.html">2.6.x</a>
        </li>
        <li class="version">
          <a href="../../2.5.x/index.html">2.5.x</a>
        </li>
        <li class="version">
          <a href="../../2.4.x/index.html">2.4.x</a>
        </li>
        <li class="version">
          <a href="../../2.3.x/index.html">2.3.x</a>
        </li>
        <li class="version">
          <a href="../../2.2.x/index.html">2.2.x</a>
        </li>
        <li class="version">
          <a href="../../2.1.x/index.html">2.1.x</a>
        </li>
        <li class="version">
          <a href="../../2.0.x/index.html">2.0.x</a>
        </li>
        <li class="version">
          <a href="../../1.3.3.Final/index.html">1.3.3.Final</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Apicurio Registry Operator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../apicurio-registry-operator/1.2.0-dev-v2.6.x/index.html">1.2.0-dev-v2.6.x</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.1-v2.5.9.final/index.html">1.1.1-v2.5.9.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.0-v2.4.12.final/index.html">1.1.0-v2.4.12.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.0.0/index.html">1.0.0</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/0.0.4/index.html">0.0.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apicurio Registry</a></li>
    <li>Migration</li>
    <li><a href="assembly-migrating-registry-v2-v3.html">Migrating an existing Apicurio Registry deployment</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">3.1.x</button>
  <div class="version-menu">
    <a class="version is-current" href="assembly-migrating-registry-v2-v3.html">3.1.x</a>
    <a class="version" href="../../3.0.x/getting-started/assembly-migrating-registry-v2-v3.html">3.0.x</a>
    <a class="version is-missing" href="../../2.6.x/index.html">2.6.x</a>
    <a class="version is-missing" href="../../2.5.x/index.html">2.5.x</a>
    <a class="version is-missing" href="../../2.4.x/index.html">2.4.x</a>
    <a class="version is-missing" href="../../2.3.x/index.html">2.3.x</a>
    <a class="version is-missing" href="../../2.2.x/index.html">2.2.x</a>
    <a class="version is-missing" href="../../2.1.x/index.html">2.1.x</a>
    <a class="version is-missing" href="../../2.0.x/index.html">2.0.x</a>
    <a class="version is-missing" href="../../1.3.3.Final/index.html">1.3.3.Final</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/Apicurio/apicurio-registry">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Migrating an existing Apicurio Registry deployment</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph _abstract">
<p>This chapter explains how to migrate an existing Apicurio Registry deployment from version 2.x to version 3.x.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-migration_registry">Migration from Apicurio Registry 2.x to 3.x</a></p>
</li>
<li>
<p><a href="#migrating-registry-data_registry">Migrating Apicurio Registry data</a></p>
</li>
<li>
<p><a href="#migrating-registry-applications_registry">Migrating Apicurio Registry client applications</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-migration_registry"><a class="anchor" href="#registry-migration_registry"></a>Migration from Apicurio Registry 2.x to 3.x</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Apicurio Registry 3.x includes new features with breaking changes from the previous Apicurio Registry 2.x release. This section describes the major changes between Apicurio Registry 2.x and version 3.x, along with the best approach to migrating.</p>
</div>
<div class="paragraph">
<p>Because of the breaking changes in 3.x, there is no automatic upgrade and a migration process is required. This involves exporting the data in your existing registry to a new registry. You must also review your existing registry client applications and update their configurations to meet the new requirements.</p>
</div>
<div class="paragraph">
<p>When migrating to version 3.x, you must take the following major changes into account:</p>
</div>
<div class="sect2">
<h3 id="_data_storage_changes"><a class="anchor" href="#_data_storage_changes"></a>Data storage changes</h3>
<div class="paragraph">
<p>All of the storage options from 2.x continue to be supported in 3.x, but any data currently in either the Kafka topic
or in the database is no longer compatible with 3.x.  This means that, in order to migrate from 2.x to 3.x, you will
need to use the Export feature of Apicurio Registry to create a .ZIP file containing all of your 2.x data.</p>
</div>
<div class="paragraph">
<p>The in-memory storage option is also still available, but is not suitable for production workloads.</p>
</div>
<div class="paragraph">
<p>For details on how to deploy Apicurio Registry 3.x with your chosen storage option,
see <a href="assembly-installing-registry-storage-openshift.html">Installing Apicurio Registry storage on OpenShift</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_v3_rest_api"><a class="anchor" href="#_new_v3_rest_api"></a>New v3 REST API</h3>
<div class="paragraph">
<p>Apicurio Registry 3.x includes a new REST API with support for empty artifacts, artifact branches, group level rules, new search capabilities, and much more. Apicurio Registry still supports version 2.x of the core REST API as well as various compatibility APIs, for example, the Confluent schema registry API v7.  However, version 2 of the Core REST API is now deprecated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_all_new_sdks_replace_the_java_client"><a class="anchor" href="#_all_new_sdks_replace_the_java_client"></a>All new SDKs replace the Java client</h3>
<div class="ulist">
<ul>
<li>
<p>The Apicurio Registry Java client classes are no longer available in version 3.x and have been replaced by a new SDK generated using Kiota.</p>
</li>
<li>
<p>In addition to Java, SDKs are now provided for Typescript, Python, and Golang.</p>
</li>
<li>
<p>The Kafka client serializer and deserializer (SerDes) classes are available in version 3.x&#8230;&#8203;.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_configuration_has_changed"><a class="anchor" href="#_deployment_configuration_has_changed"></a>Deployment configuration has changed</h3>
<div class="paragraph">
<p>Apicurio Registry 3.x has changed a number of configuration options and added some new ones.  Options you may be using when deploying
2.x are likely still available, but may have been renamed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serdes_id_encoding_has_changed"><a class="anchor" href="#_serdes_id_encoding_has_changed"></a>SerDes ID encoding has changed</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is a critical breaking change that affects Kafka message compatibility.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Apicurio Registry 2.x, the SerDes libraries used <strong>8 bytes</strong> (long) to encode schema identifiers in Kafka messages, and used the <code>globalId</code> by default. In Apicurio Registry 3.x, the SerDes libraries now use <strong>4 bytes</strong> (int) to encode identifiers and use the <code>contentId</code> by default. This change aligns with the Confluent Schema Registry wire format.</p>
</div>
<div class="paragraph">
<p>This means that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Kafka messages produced with 2.x SerDes cannot be consumed by 3.x SerDes</strong> (and vice versa) without additional configuration.</p>
</li>
<li>
<p>Existing Kafka topics with messages serialized using 2.x SerDes will fail to deserialize with 3.x SerDes unless you configure backward compatibility.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_configuring_backward_compatibility"><a class="anchor" href="#_configuring_backward_compatibility"></a>Configuring backward compatibility</h4>
<div class="paragraph">
<p>To consume messages that were produced using Apicurio Registry 2.x SerDes, you must configure your 3.x consumers to use the legacy 8-byte ID handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">props.put("apicurio.registry.id-handler", "io.apicurio.registry.serde.Legacy8ByteIdHandler");
props.put("apicurio.registry.use-id", "globalId");</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_summary_of_id_handling_changes"><a class="anchor" href="#_summary_of_id_handling_changes"></a>Summary of ID handling changes</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Apicurio Registry 2.x Default</th>
<th class="tableblock halign-left valign-top">Apicurio Registry 3.x Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bytes (long)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes (int)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID handler class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Legacy8ByteIdHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Default4ByteIdHandler</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>globalId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>contentId</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_migration_strategies"><a class="anchor" href="#_migration_strategies"></a>Migration strategies</h4>
<div class="paragraph">
<p>There are two approaches to handle this breaking change:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Configure 3.x SerDes for backward compatibility</strong> (recommended for existing topics): Use the <code>Legacy8ByteIdHandler</code> configuration shown above. This allows 3.x consumers to read messages produced by 2.x producers.</p>
</li>
<li>
<p><strong>Migrate to new format</strong> (recommended for new deployments): Accept the new 4-byte format. This requires that all producers and consumers are upgraded to 3.x simultaneously, or that you create new Kafka topics for 3.x usage.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The 4-byte format is more efficient and aligns with the Confluent Schema Registry wire format, making interoperability easier.
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details on the v3 REST API, see the <a href="../assets-attachments/registry-rest-api.htm">Registry REST API documentation</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-registry-data_registry"><a class="anchor" href="#migrating-registry-data_registry"></a>Migrating Apicurio Registry data</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Migrating data to Apicurio Registry 3.x requires exporting all data from your existing Apicurio Registry 2.x deployment and importing it into the new 3.x deployment. If you are using Apicurio Registry as a schema registry for Kafka applications, data migration is critical because each Kafka message carries the global identifier for the schema stored in Apicurio Registry. This identifier must be preserved during registry data migration.</p>
</div>
<div class="paragraph">
<p>Both Apicurio Registry 3.x and 2.x provide an API to bulk import/export all data from your registry deployment, which guarantees that all identifiers are kept when importing data from your existing registry. The export API downloads a custom <code>.zip</code> file containing all the information for your artifacts. The import API accepts this <code>.zip</code> and loads all artifacts into the registry in a single batch.</p>
</div>
<div class="paragraph">
<p>The Apicurio Registry 3.x import feature is able to import <code>.zip</code> contents created from either a 2.x or 3.x deployment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Running a Apicurio Registry instance of the 2.x server you are exporting from and the 3.x instance you are importing into.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Export all the data from Apicurio Registry 2.x using the Export feature, which can be accessed from the UI or the REST API. This generates a <code>all-artifacts.zip</code> file in a directory of your choice.</p>
</li>
<li>
<p>Import the <code>.zip</code> file into Apicurio Registry 3.x using the import API:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST "http://new-registry.my-company.com/apis/registry/v3/admin/import" \
  -H "Accept: application/json" -H "Content-Type: application/zip" \
  --data-binary @all-artifacts.zip</code></pre>
</div>
</div>
</li>
<li>
<p>Check that all the artifacts have been imported into the new 3.x registry by running these commands and comparing the count field:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl "http://old-registry.my-company.com/apis/registry/v2/search/artifacts"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl "http://new-registry.my-company.com/apis/registry/v3/search/artifacts"</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details on the import/export REST API, see
<a href="assembly-managing-registry-artifacts-api.html">Managing Apicurio Registry content using the REST API</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-registry-applications_registry"><a class="anchor" href="#migrating-registry-applications_registry"></a>Migrating Apicurio Registry client applications</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>You must review your existing Apicurio Registry client applications to ensure that the Maven dependencies and Java client configuration meet the new requirements for version 3.x. For example, this includes new Maven dependencies for the Apicurio Registry Java REST client libraries or Kafka client serializer/deserializer (Serdes) libraries. You must also update your Java application configuration with the new registry v3 API path.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Existing Apicurio Registry 2.6.3 Java client application or Kafka client producer and consumer Java applications with SerDes</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>If you are using the Apicurio Registry Java REST client, you must change the Maven dependencies for the Apicurio Registry Java client libraries, which have been repackaged in version 3.x:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-java-sdk&lt;/artifactId&gt;
    &lt;version&gt;3.1.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In your Java client application, you must change your registry URL configuration, from pointing to the existing v2 API path to the new v3 path. Starting with v3, we use Vertx as the default platform for our rest client, due to this change, a RequestAdapter is required when the client is created. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ClientExample {


     public static void main(String[] args) throws Exception {
         VertXRequestAdapter vertXRequestAdapter = new VertXRequestAdapter(vertx);
         vertXRequestAdapter.setBaseUrl("https://new-registry.my-company.com/apis/registry/v3");
         RegistryClient client = new RegistryClient(vertXRequestAdapter);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more details on the Java client in
<a href="assembly-using-the-registry-client.html">Managing Apicurio Registry content using a Java client</a>.</p>
</div>
</li>
<li>
<p>If you are using the Apicurio Registry SerDes libraries, you must change the Maven dependencies, which have been repackaged in version 3.x. In Apicurio Registry 2.6.3, the SerDes libraries were provided into three separate Maven modules, while this is still true, the names have been changed:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-avro-serde-kafka&lt;/artifactId&gt;
    &lt;version&gt;3.1.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-jsonschema-serde-kafka&lt;/artifactId&gt;
    &lt;version&gt;3.1.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-protobuf-serde-kafka&lt;/artifactId&gt;
    &lt;version&gt;3.1.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Apicurio Registry 3.x, the SerDes libraries have been significantly refactored to make them re-usable for other messaging platforms like Apache Pulsar, that&#8217;s why the Apache Kafka specific ones have been renamed.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The SerDes ID encoding format has changed from 8 bytes to 4 bytes. See <a href="#registry-migration_registry">SerDes ID encoding has changed</a> for details on configuring backward compatibility with existing Kafka topics.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If you have existing Kafka topics with messages serialized using Apicurio Registry 2.x SerDes, configure the legacy ID handler:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">props.put("apicurio.registry.id-handler", "io.apicurio.registry.serde.Legacy8ByteIdHandler");
props.put("apicurio.registry.use-id", "globalId");</code></pre>
</div>
</div>
</li>
<li>
<p>In your Kafka producer and consumer Java applications, you must change your registry URL configuration from pointing to the existing v2 API path to the new v3 path. For example:</p>
<div class="paragraph">
<p><em>Existing registry v2 API path</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">props.putIfAbsent(SerdeConfig.REGISTRY_URL, "http://new-registry.my-company.com/apis/registry/v3");</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>New registry v3 API path</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">props.putIfAbsent(SerdeConfig.REGISTRY_URL, "http://new-registry.my-company.com/apis/registry/v3");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The refactored SerDes libraries also include other important changes to configuration properties. For more details on SerDes configuration, see
<a href="assembly-using-kafka-client-serdes.html">Validating schemas using Kafka client serializers/deserializers in Java clients</a>.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For detailed configuration examples, see the <a href="https://github.com/Apicurio/apicurio-registry/tree/main/examples">Apicurio Registry example applications</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright Â© 2024 Red Hat, Inc. All rights reserved.</p>
</footer>
<script src="../../../assets/js/site.js"></script>
<script src="../../../assets/js/vendor/lunr.js"></script>
<script src="../../../assets/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/apicurio-registry/3.1.x/getting-started/assembly-migrating-registry-v2-v3.html"></script>
<script async src="../../../assets/../search-index.js"></script>
<script async src="../../../assets/js/vendor/highlight.js"></script>
  </body>
</html>
