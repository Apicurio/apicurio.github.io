<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validating Kafka messages using serializers/deserializers in Java clients :: Apicurio Registry</title>
    <link rel="canonical" href="https://www.apicur.io/registry/docs/apicurio-registry/3.1.x/getting-started/assembly-using-kafka-client-serdes.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="../../../assets/css/site.css">
    <link rel="stylesheet" href="https://www.apicur.io/css/rhbar.css">
<link rel="stylesheet" href="../../../assets/css/search.css">
    <link rel="shortcut icon" href="https://www.apicur.io/images/favicon.ico" type="image/x-icon" integrity="sha384-if9KH+NQ2dMhdrWu+INnJTcvG6riRakUAnbhecX5a7voubrapo7ouFGS+GYZ/N4P" crossorigin="anonymous"/>
  </head>
  <body class="article">
<div class="masthead-wrapper">
    <div class="search-box">
        <input id="search-input" type="text" placeholder="Search docs">
    </div>
    <div class="masthead">
        <div class="logo-wrapper">
            <a href="/"><img src="https://www.apicur.io/images/apicurio_headerlogo.png" class="project-logo"
                    title="Apicurio"></a>
        </div>
        <div class="menu-wrapper">
            <ul id="menu" class="menu">
                <li>
                    <a href="/studio/" id="menu-item-studio">Studio</a>
                </li>
                <li>
                    <a href="/registry/" id="menu-item-registry">Registry</a>
                </li>
                <li>
                    <a href="/datamodels/">Data Models</a>
                </li>
                <li>
                    <a href="/apicurito/">Apicurito</a>
                </li>
                <li>
                    <a href="/blog/">Blog</a>
                </li>
                <li>
                    <a href="/contact/">Contact</a>
                </li>
                <li>
                    <a href="https://github.com/apicurio">Fork</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<script>
    var currentURL = window.location.href;
    var studioAnchor = document.getElementById("menu-item-studio");
    var registryAnchor = document.getElementById("menu-item-registry");

    if (currentURL.includes("studio")) {
        studioAnchor.classList.add("active");
    } else if (currentURL.includes("registry")) {
        registryAnchor.classList.add("active");
    }
</script>
<div class="body">
<div class="nav-container" data-component="apicurio-registry" data-version="3.1.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apicurio Registry</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-intro-to-the-registry.html">Introduction to Apicurio Registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-intro-to-registry-rules.html">Apicurio Registry content rules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-installing-registry-docker.html">Installing Apicurio Registry using Docker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-installing-registry-openshift.html">Installing Apicurio Registry on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-installing-registry-storage-openshift.html">Installing Apicurio Registry storage on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-deploying-registry-operator.html">Deploying Apicurio Registry using the Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-registry-high-availability.html">Deploying Apicurio Registry for high availability</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Migration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-migrating-registry-v2-v3.html">Migrating an existing Apicurio Registry deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-configuring-registry-security.html">Configuring Apicurio Registry security options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-configuring-the-registry.html">Configuring your Apicurio Registry deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Client applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-managing-registry-artifacts-ui.html">Managing Apicurio Registry content using the web console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-managing-registry-artifacts-api.html">Managing Apicurio Registry content using the REST API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-using-the-registry-client.html">Managing Apicurio Registry content using a SDK</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-managing-registry-artifacts-maven.html">Managing Apicurio Registry content using the Maven plug-in</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Kafka client serializers/deserialisers</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="assembly-using-kafka-client-serdes.html">Validating Kafka messages using serializers/deserializers in Java clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-configuring-kafka-client-serdes.html">Configuring Kafka serializers/deserializers in Java clients</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="guide-exporting-registry-kafka-topic-data.html">Exporting Apicurio Registry Kafka topic data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-artifact-reference.html">Apicurio Registry artifact reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-rule-reference.html">Apicurio Registry content rule reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-config-reference.html">Apicurio Registry configuration reference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly-operator-config-reference.html">Apicurio Registry Operator configuration reference</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apicurio Registry</span>
    <span class="version">3.1.x</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apicurio Registry</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">3.1.x</a>
        </li>
        <li class="version">
          <a href="../../3.0.x/index.html">3.0.x</a>
        </li>
        <li class="version">
          <a href="../../2.6.x/index.html">2.6.x</a>
        </li>
        <li class="version">
          <a href="../../2.5.x/index.html">2.5.x</a>
        </li>
        <li class="version">
          <a href="../../2.4.x/index.html">2.4.x</a>
        </li>
        <li class="version">
          <a href="../../2.3.x/index.html">2.3.x</a>
        </li>
        <li class="version">
          <a href="../../2.2.x/index.html">2.2.x</a>
        </li>
        <li class="version">
          <a href="../../2.1.x/index.html">2.1.x</a>
        </li>
        <li class="version">
          <a href="../../2.0.x/index.html">2.0.x</a>
        </li>
        <li class="version">
          <a href="../../1.3.3.Final/index.html">1.3.3.Final</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Apicurio Registry Operator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../apicurio-registry-operator/1.2.0-dev-v2.6.x/index.html">1.2.0-dev-v2.6.x</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.1-v2.5.9.final/index.html">1.1.1-v2.5.9.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.0-v2.4.12.final/index.html">1.1.0-v2.4.12.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.0.0/index.html">1.0.0</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/0.0.4/index.html">0.0.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apicurio Registry</a></li>
    <li>Kafka client serializers/deserialisers</li>
    <li><a href="assembly-using-kafka-client-serdes.html">Validating Kafka messages using serializers/deserializers in Java clients</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">3.1.x</button>
  <div class="version-menu">
    <a class="version is-current" href="assembly-using-kafka-client-serdes.html">3.1.x</a>
    <a class="version" href="../../3.0.x/getting-started/assembly-using-kafka-client-serdes.html">3.0.x</a>
    <a class="version" href="../../2.6.x/getting-started/assembly-using-kafka-client-serdes.html">2.6.x</a>
    <a class="version" href="../../2.5.x/getting-started/assembly-using-kafka-client-serdes.html">2.5.x</a>
    <a class="version" href="../../2.4.x/getting-started/assembly-using-kafka-client-serdes.html">2.4.x</a>
    <a class="version" href="../../2.3.x/getting-started/assembly-using-kafka-client-serdes.html">2.3.x</a>
    <a class="version" href="../../2.2.x/getting-started/assembly-using-kafka-client-serdes.html">2.2.x</a>
    <a class="version" href="../../2.1.x/getting-started/assembly-using-kafka-client-serdes.html">2.1.x</a>
    <a class="version" href="../../2.0.x/getting-started/assembly-using-kafka-client-serdes.html">2.0.x</a>
    <a class="version" href="../../1.3.3.Final/getting-started/assembly-using-kafka-client-serdes.html">1.3.3.Final</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/Apicurio/apicurio-registry">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Validating Kafka messages using serializers/deserializers in Java clients</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Apicurio Registry provides client serializers/deserializers (SerDes) for Kafka producer and consumer applications written in Java. Kafka producer applications use serializers to encode messages that conform to a specific event schema. Kafka consumer applications use deserializers to validate that messages have been serialized using the correct schema, based on a specific schema ID. This ensures consistent schema use and helps to prevent data errors at runtime.</p>
</div>
<div class="paragraph">
<p>This chapter explains how to use Kafka client SerDes in your producer and consumer client applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-serdes-concepts-serde_registry">Kafka client applications and Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-concepts-strategy_registry">Strategies to look up a schema in Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-register_registry">Registering a schema in Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-consumer_registry">Using a schema from a Kafka consumer client</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-producer_registry">Using a schema from a Kafka producer client</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-stream_registry">Using a schema from a Kafka Streams application</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have read <a href="assembly-intro-to-the-registry.html">Introduction to Apicurio Registry</a>.</p>
</li>
<li>
<p>You have installed Apicurio Registry.</p>
</li>
<li>
<p>You have created Kafka producer and consumer client applications.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-concepts-serde_registry"><a class="anchor" href="#registry-serdes-concepts-serde_registry"></a>Kafka client applications and Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Apicurio Registry decouples schema management from client application configuration. You can enable a Java client application to use a schema from Apicurio Registry by specifying its URL in your client code.</p>
</div>
<div class="paragraph">
<p>You can store the schemas in Apicurio Registry to serialize and deserialize messages, which are referenced from your client applications to ensure that the messages that they send and receive are compatible with those schemas. Kafka client applications can push or pull their schemas from Apicurio Registry at runtime.</p>
</div>
<div class="paragraph">
<p>Schemas can evolve, so you can define rules in Apicurio Registry, for example, to ensure that schema changes are valid and do not break previous versions used by applications. Apicurio Registry checks for compatibility by comparing a modified schema with previous schema versions.</p>
</div>
<h3 id="_apicurio_registry_schema_technologies" class="discrete">Apicurio Registry schema technologies</h3>
<div class="paragraph">
<p>Apicurio Registry provides schema registry support for schema technologies such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avro</p>
</li>
<li>
<p>Protobuf</p>
</li>
<li>
<p>JSON Schema</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These schema technologies can be used by client applications through the Kafka client serializer/deserializer (SerDes) services provided by Apicurio Registry.  The maturity and usage of the SerDes classes provided by Apicurio Registry might vary. The sections that follow provide more details about each schema type.</p>
</div>
<h3 id="_producer_schema_configuration" class="discrete">Producer schema configuration</h3>
<div class="paragraph">
<p>A producer client application uses a serializer to put the messages that it sends to a specific broker topic into the correct data format.</p>
</div>
<div class="paragraph">
<p>To enable a producer to use Apicurio Registry for serialization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-serdes-register_registry">Define and register your schema with Apicurio Registry</a> (if it does not already exist).</p>
</li>
<li>
<p><a href="#registry-serdes-config-producer_registry">Configure your producer client code</a> with the following:</p>
<div class="ulist">
<ul>
<li>
<p>URL of Apicurio Registry</p>
</li>
<li>
<p>Apicurio Registry serializer to use with messages</p>
</li>
<li>
<p>Strategy to map the Kafka message to a schema artifact in Apicurio Registry</p>
</li>
<li>
<p>Strategy to look up or register the schema used for serialization in Apicurio Registry</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After registering your schema, when you start Kafka and Apicurio Registry, you can access the schema to format messages sent to the Kafka broker topic by the producer. Alternatively, depending on configuration, the producer can automatically register the schema on first use.</p>
</div>
<div class="paragraph">
<p>If a schema already exists, you can create a new version using the registry REST API based on compatibility rules defined in Apicurio Registry. Versions are used for compatibility checking as a schema evolves. A group ID, artifact ID, and version represents a unique tuple that identifies a schema.</p>
</div>
<h3 id="_consumer_schema_configuration" class="discrete">Consumer schema configuration</h3>
<div class="paragraph">
<p>A consumer client application uses a deserializer to get the messages that it consumes from a specific broker topic into the correct data format.</p>
</div>
<div class="paragraph">
<p>To enable a consumer to use Apicurio Registry for deserialization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-serdes-register_registry">Define and register your schema with Apicurio Registry</a> (if it does not already exist)</p>
</li>
<li>
<p><a href="#registry-serdes-config-consumer_registry">Configure the consumer client code</a>  with the following:</p>
<div class="ulist">
<ul>
<li>
<p>URL of Apicurio Registry</p>
</li>
<li>
<p>Apicurio Registry deserializer to use with the messages</p>
</li>
<li>
<p>Input data stream for deserialization</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Retrieve schemas using a content ID</div>
<p>By default, the schema is retrieved from Apicurio Registry by the deserializer using a content ID (which is an ID unique to the <strong>content</strong> of an artifact version, but not unique to the version itself), which is specified in the message being consumed. The schema content ID can be located in the message headers or in the message payload, depending on the configuration of the producer application.  By default, the content ID will be located in the message body.</p>
</div>
<div class="paragraph">
<p>When locating the content ID in the message payload, the format of the data begins with a magic byte, used as a signal to consumers, followed by the content ID, and the message data as normal. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># ...
[MAGIC_BYTE]
[CONTENT_ID]
[MESSAGE DATA]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then when you start Kafka and Apicurio Registry, you can access the schema to format messages received from the Kafka broker topic.</p>
</div>
<div class="paragraph">
<div class="title">Retrieve schemas using a global ID</div>
<p>Alternatively, you can configure to retrieve schemas from Apicurio Registry based on the global ID, which is the unique ID of the artifact version.  The same options are available to you when using global ID instead of contentID.  You can either send the global ID in the message headers or the message body (default).</p>
</div>
<div class="paragraph">
<p>When locating the global ID in the message payload, the format of the data begins with a magic byte, used as a signal to consumers, followed by the global ID, and the message data as normal. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># ...
[MAGIC_BYTE]
[GLOBAL_ID]
[MESSAGE DATA]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-concepts-strategy_registry"><a class="anchor" href="#registry-serdes-concepts-strategy_registry"></a>Strategies to look up a schema in Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>The Kafka client serializer uses <em>lookup strategies</em> to determine the artifact ID and global ID under which the message schema is registered in Apicurio Registry. For a given topic and message, you can use different implementations of the <code>ArtifactReferenceResolverStrategy</code> Java interface to return a reference to an artifact in the registry.</p>
</div>
<div class="paragraph">
<p>The classes for each strategy are in the <code>io.apicurio.registry.serde.strategy</code> package. Specific strategy classes for Avro SerDes are in the <code>io.apicurio.registry.serde.avro.strategy package</code>. The default strategy is the <code>TopicIdStrategy</code>, which looks for Apicurio Registry artifacts with the same name as the Kafka topic receiving messages.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public ArtifactReference artifactReference(String topic, boolean isKey, T schema) {
        return ArtifactReference.builder()
                .groupId(null)
                .artifactId(String.format("%s-%s", topic, isKey ? "key" : "value"))
                .build();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>topic</code> parameter is the name of the Kafka topic receiving the message.</p>
</li>
<li>
<p>The <code>isKey</code> parameter is <code>true</code> when the message key is serialized, and <code>false</code> when the message value is serialized.</p>
</li>
<li>
<p>The <code>schema</code> parameter is the schema of the message serialized or deserialized.</p>
</li>
<li>
<p>The <code>ArtifactReference</code> returned contains the artifact ID under which the schema is registered.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which lookup strategy you use depends on how and where you store your schema. For example, you might use a strategy that uses a <em>record ID</em> if you have different Kafka topics with the same Avro message type.</p>
</div>
<h3 id="_artifact_resolver_strategy" class="discrete">Artifact resolver strategy</h3>
<div class="paragraph">
<p>The artifact resolver strategy provides a way to map the Kafka topic and message information to an artifact in Apicurio Registry. The common convention for the mapping is to combine the Kafka topic name with the <code>key</code> or <code>value</code>, depending on whether the serializer is used for the Kafka message key or value.</p>
</div>
<div class="paragraph">
<p>However, you can use alternative conventions for the mapping by using a strategy provided by Apicurio Registry, or by creating a custom Java class that implements <code>io.apicurio.registry.serde.strategy.ArtifactReferenceResolverStrategy</code>.</p>
</div>
<h3 id="service-registry-concepts-artifactid-registry" class="discrete">Strategies to return a reference to an artifact</h3>
<div class="paragraph">
<p>Apicurio Registry provides the following strategies to return a reference to an artifact based on an implementation of <code>ArtifactReferenceResolverStrategy</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>RecordIdStrategy</code></dt>
<dd>
<p>Avro-specific strategy that uses the full name of the schema.</p>
</dd>
<dt class="hdlist1"><code>TopicRecordIdStrategy</code></dt>
<dd>
<p>Avro-specific strategy that uses the topic name and the full name of the schema.</p>
</dd>
<dt class="hdlist1"><code>TopicIdStrategy</code></dt>
<dd>
<p>Default strategy that uses the topic name and <code>key</code> or <code>value</code> suffix.</p>
</dd>
<dt class="hdlist1"><code>SimpleTopicIdStrategy</code></dt>
<dd>
<p>Simple strategy that only uses the topic name.</p>
</dd>
</dl>
</div>
<h3 id="_defaultschemaresolver_interface" class="discrete">DefaultSchemaResolver interface</h3>
<div class="paragraph">
<p>The default schema resolver locates and identifies the specific version of the schema registered under the artifact reference provided by the artifact resolver strategy. Every version of every artifact has a single globally unique identifier that can be used to retrieve the content of that artifact. This global ID is included in every Kafka message so that a deserializer can properly fetch the schema from Apicurio Registry.</p>
</div>
<div class="paragraph">
<p>The default schema resolver can look up an existing artifact version, or it can register one if not found, depending on which strategy is used. You can also provide your own strategy by creating a custom Java class that implements <code>io.apicurio.registry.resolver.SchemaResolver</code>. However, it is recommended to use the <code>DefaultSchemaResolver</code> and specify configuration properties instead.</p>
</div>
<h3 id="configuring-globalid-strategy-registry" class="discrete">Configuration for registry lookup options</h3>
<div class="paragraph">
<p>When using the <code>DefaultSchemaResolver</code>, you can configure its behavior using application properties. The following table shows some commonly used examples:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Apicurio Registry lookup configuration options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 20%;">
<col style="width: 33.3333%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apicurio.registry.find-latest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify whether the serializer tries to find the latest artifact in the registry for the corresponding group ID and artifact ID.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apicurio.registry.use-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instructs the serializer to write the specified ID to Kafka and instructs the deserializer to use this ID to find the schema.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apicurio.registry.auto-register</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify whether the serializer tries to create an artifact in the registry. The JSON Schema serializer does not support this.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apicurio.registry.check-period-ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify how long to cache the global ID in milliseconds. If not configured, the global ID is fetched every time.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-register_registry"><a class="anchor" href="#registry-serdes-register_registry"></a>Registering a schema in Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>After you have defined a schema in the appropriate format, such as Apache Avro, you can add the schema to Apicurio Registry.</p>
</div>
<div class="paragraph">
<p>You can add the schema using the following approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apicurio Registry web console</p>
</li>
<li>
<p>curl command using the Apicurio Registry REST API</p>
</li>
<li>
<p>Maven plug-in supplied with Apicurio Registry</p>
</li>
<li>
<p>Schema configuration added to your client code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Client applications cannot use Apicurio Registry until you have registered your schemas.</p>
</div>
<h3 id="_apicurio_registry_web_console" class="discrete">Apicurio Registry web console</h3>
<div class="paragraph">
<p>When Apicurio Registry is installed, you can connect to the web console from the <code>ui</code> endpoint:</p>
</div>
<div class="paragraph">
<p><code>http://MY-REGISTRY-URL/ui</code></p>
</div>
<div class="paragraph">
<p>From the console, you can add, view and configure schemas. You can also create the rules that prevent invalid content being added to the registry.</p>
</div>
<h3 id="_curl_command_example" class="discrete">Curl command example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"> curl -X POST -H "Content-type: application/json; artifactType=AVRO" \
   -H "X-Registry-ArtifactId: share-price" \ <i class="conum" data-value="1"></i><b>(1)</b>
   --data '{
     "type":"record",
     "name":"price",
     "namespace":"com.example",
     "fields":[{"name":"symbol","type":"string"},
     {"name":"price","type":"string"}]}'
   https://my-cluster-my-registry-my-project.example.com/apis/registry/v3/groups/my-group/artifacts -s <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simple Avro schema artifact.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>OpenShift route name that exposes Apicurio Registry.</td>
</tr>
</table>
</div>
<h3 id="_maven_plug_in_example" class="discrete">Maven plug-in example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
  &lt;artifactId&gt;apicurio-registry-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;${apicurio.version}&lt;/version&gt;
  &lt;executions&gt;
      &lt;execution&gt;
        &lt;phase&gt;generate-sources&lt;/phase&gt;
        &lt;goals&gt;
            &lt;goal&gt;register&lt;/goal&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;/goals&gt;
        &lt;configuration&gt;
            &lt;registryUrl&gt;http://REGISTRY-URL/apis/registry/v3&lt;/registryUrl&gt; <i class="conum" data-value="2"></i><b>(2)</b>
            &lt;artifacts&gt;
                &lt;artifact&gt;
                    &lt;groupId&gt;TestGroup&lt;/groupId&gt; <i class="conum" data-value="3"></i><b>(3)</b>
                    &lt;artifactId&gt;FullNameRecord&lt;/artifactId&gt;
                    &lt;file&gt;${project.basedir}/src/main/resources/schemas/record.avsc&lt;/file&gt;
                    &lt;ifExists&gt;FAIL&lt;/ifExists&gt;
                &lt;/artifact&gt;
                &lt;artifact&gt;
                    &lt;groupId&gt;TestGroup&lt;/groupId&gt;
                    &lt;artifactId&gt;ExampleAPI&lt;/artifactId&gt; <i class="conum" data-value="4"></i><b>(4)</b>
                    &lt;artifactType&gt;GRAPHQL&lt;/artifactType&gt;
                    &lt;file&gt;${project.basedir}/src/main/resources/apis/example.graphql&lt;/file&gt;
                    &lt;ifExists&gt;FIND_OR_CREATE_VERSION&lt;/ifExists&gt;
                    &lt;canonicalize&gt;true&lt;/canonicalize&gt;
                &lt;/artifact&gt;
            &lt;/artifacts&gt;
        &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
 &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify <code>register</code> as the execution goal to upload the schema artifact to the registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the Apicurio Registry URL with the <code>../apis/registry/v3</code> endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the Apicurio Registry artifact group ID.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can upload multiple artifacts using the specified group ID, artifact ID, and location.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-config-consumer_registry"><a class="anchor" href="#registry-serdes-config-consumer_registry"></a>Using a schema from a Kafka consumer client</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>This procedure describes how to configure a Kafka consumer client written in Java to use a schema from Apicurio Registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry is installed</p>
</li>
<li>
<p>The schema is registered with Apicurio Registry</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the client with the URL of Apicurio Registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl = "https://registry.example.com/apis/registry/v3";
Properties props = new Properties();
props.putIfAbsent(SerdeConfig.REGISTRY_URL, registryUrl);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the client with the Apicurio Registry deserializer. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Configure Kafka settings
props.putIfAbsent(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, SERVERS);
props.putIfAbsent(ConsumerConfig.GROUP_ID_CONFIG, "Consumer-" + TOPIC_NAME);
props.putIfAbsent(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, "true");
props.putIfAbsent(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, "1000");
props.putIfAbsent(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");
// Configure deserializer settings
props.putIfAbsent(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG,
    AvroKafkaDeserializer.class.getName()); <i class="conum" data-value="1"></i><b>(1)</b>
props.putIfAbsent(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG,
    AvroKafkaDeserializer.class.getName()); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The deserializer provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The deserialization is in Apache Avro JSON format.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-config-producer_registry"><a class="anchor" href="#registry-serdes-config-producer_registry"></a>Using a schema from a Kafka producer client</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>This procedure describes how to configure a Kafka producer client written in Java to use a schema from Apicurio Registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry is installed</p>
</li>
<li>
<p>The schema is registered with Apicurio Registry</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the client with the URL of Apicurio Registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl = "https://registry.example.com/apis/registry/v3";
Properties props = new Properties();
props.putIfAbsent(SerdeConfig.REGISTRY_URL, registryUrl);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the client with the serializer, and the strategy to look up the schema in Apicurio Registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">props.put(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG, "my-cluster-kafka-bootstrap:9092");
props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, AvroKafkaSerializer.class.getName()); <i class="conum" data-value="1"></i><b>(1)</b>
props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, AvroKafkaSerializer.class.getName()); <i class="conum" data-value="2"></i><b>(2)</b>
props.put(SerdeConfig.FIND_LATEST_ARTIFACT, Boolean.TRUE); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The serializer for the message key provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The serializer for the message value provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The lookup strategy to find the global ID for the schema.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-config-stream_registry"><a class="anchor" href="#registry-serdes-config-stream_registry"></a>Using a schema from a Kafka Streams application</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>This procedure describes how to configure a Kafka Streams client written in Java to use an Apache Avro schema from Apicurio Registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry is installed</p>
</li>
<li>
<p>The schema is registered with Apicurio Registry</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create and configure a Java client with the Apicurio Registry URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl = "https://registry.example.com/apis/registry/v3";

RegistryService client = RegistryClient.cached(registryUrl);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the serializer and deserializer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Serializer&lt;LogInput&gt; serializer = new AvroKafkaSerializer&lt;LogInput&gt;(); <i class="conum" data-value="1"></i><b>(1)</b>

Deserializer&lt;LogInput&gt; deserializer = new AvroKafkaDeserializer &lt;LogInput&gt;(); <i class="conum" data-value="2"></i><b>(2)</b>

Serde&lt;LogInput&gt; logSerde = Serdes.serdeFrom(
    serializer,
    deserializer
);

Map&lt;String, Object&gt; config = new HashMap&lt;&gt;();
config.put(SerdeConfig.REGISTRY_URL, registryUrl);
config.put(AvroSerdeConfig.USE_SPECIFIC_AVRO_READER, true);
logSerde.configure(config, false); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Avro serializer provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Avro deserializer provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configures the Apicurio Registry URL and the Avro reader for deserialization in Avro format.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the Kafka Streams client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KStream&lt;String, LogInput&gt; input = builder.stream(
    INPUT_TOPIC,
    Consumed.with(Serdes.String(), logSerde)
);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright Â© 2024 Red Hat, Inc. All rights reserved.</p>
</footer>
<script src="../../../assets/js/site.js"></script>
<script src="../../../assets/js/vendor/lunr.js"></script>
<script src="../../../assets/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/apicurio-registry/3.1.x/getting-started/assembly-using-kafka-client-serdes.html"></script>
<script async src="../../../assets/../search-index.js"></script>
<script async src="../../../assets/js/vendor/highlight.js"></script>
  </body>
</html>
