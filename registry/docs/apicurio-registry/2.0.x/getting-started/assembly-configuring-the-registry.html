<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuring your Apicurio Registry deployment :: Apicurio Registry</title>
    <link rel="canonical" href="https://www.apicur.io/registry/docs/apicurio-registry/2.5.x/getting-started/assembly-configuring-the-registry.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="../../../assets/css/site.css">
    <link rel="stylesheet" href="https://www.apicur.io/css/rhbar.css">
<link rel="stylesheet" href="../../../assets/css/search.css">
    <link rel="shortcut icon" href="https://www.apicur.io/images/favicon.ico" type="image/x-icon" integrity="sha384-if9KH+NQ2dMhdrWu+INnJTcvG6riRakUAnbhecX5a7voubrapo7ouFGS+GYZ/N4P" crossorigin="anonymous"/>
  </head>
  <body class="article">
<div id="rhbar">
    <a class="jbdevlogo" href="https://www.jboss.org/projects/about" rel="nofollow" target="_blank"></a>
    <a class="rhlogo" href="https://www.redhat.com/" rel="nofollow" target="_blank"></a>
</div>
<div class="masthead-header">

    <a href="" target="_blank" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    </a>
    <div class="masthead-logo"></div>
    <div class="masthead-brand"><a href="/">Apicurio Studio</a></div>
    <div class="masthead-menu">
          <input id="search-input" type="text" placeholder="Search docs">
    </div>

    <div class="masthead-menu">
        <ul>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </div>
</div>
<div class="body">
<div class="nav-container" data-component="apicurio-registry" data-version="2.0.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apicurio Registry</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-intro-to-the-registry.html">Introduction to Apicurio Registry</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-intro-to-registry-rules.html">Apicurio Registry content rules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-docker.html">Installing Apicurio Registry using Docker</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-openshift.html">Installing Apicurio Registry on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-storage-openshift.html">Installing Apicurio Registry storage on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-migrating-registry-v1-v2.html">Migrating an existing Apicurio Registry deployment</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="assembly-configuring-the-registry.html">Configuring your Apicurio Registry deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-ui.html">Managing Apicurio Registry content using the web console</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-api.html">Managing Apicurio Registry content using the REST API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-maven.html">Managing Apicurio Registry content using the Maven plug-in</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-using-the-registry-client.html">Managing Apicurio Registry content using a Java client</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-using-kafka-client-serdes.html">Validating schemas using Kafka serializers/deserializers in Java clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-configuring-kafka-client-serdes.html">Configuring Kafka serializers/deserializers in Java clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-registry-reference.html">Apicurio Registry artifact reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://www.apicur.io/registry/docs/apicurio-registry-operator/1.0.0/index.html">Apicurio Registry Operator documentation</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apicurio Registry</span>
    <span class="version">2.0.x</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apicurio Registry</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../2.5.x/index.html">2.5.x</a>
        </li>
        <li class="version">
          <a href="../../2.4.x/index.html">2.4.x</a>
        </li>
        <li class="version">
          <a href="../../2.3.x/index.html">2.3.x</a>
        </li>
        <li class="version">
          <a href="../../2.2.x/index.html">2.2.x</a>
        </li>
        <li class="version">
          <a href="../../2.1.x/index.html">2.1.x</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">2.0.x</a>
        </li>
        <li class="version">
          <a href="../../1.3.3.Final/index.html">1.3.3.Final</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Apicurio Registry Operator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../apicurio-registry-operator/1.2.0-dev-v2.x/index.html">1.2.0-dev-v2.x</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.1-v2.5.9.final/index.html">1.1.1-v2.5.9.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.0-v2.4.12.final/index.html">1.1.0-v2.4.12.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.0.0/index.html">1.0.0</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/0.0.4/index.html">0.0.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../2.5.x/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apicurio Registry</a></li>
    <li><a href="assembly-configuring-the-registry.html">Configuring your Apicurio Registry deployment</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2.0.x</button>
  <div class="version-menu">
    <a class="version" href="../../2.5.x/getting-started/assembly-configuring-the-registry.html">2.5.x</a>
    <a class="version" href="../../2.4.x/getting-started/assembly-configuring-the-registry.html">2.4.x</a>
    <a class="version" href="../../2.3.x/getting-started/assembly-configuring-the-registry.html">2.3.x</a>
    <a class="version" href="../../2.2.x/getting-started/assembly-configuring-the-registry.html">2.2.x</a>
    <a class="version" href="../../2.1.x/getting-started/assembly-configuring-the-registry.html">2.1.x</a>
    <a class="version is-current" href="assembly-configuring-the-registry.html">2.0.x</a>
    <a class="version" href="../../1.3.3.Final/getting-started/assembly-configuring-the-registry.html">1.3.3.Final</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/Apicurio/apicurio-registry">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Configuring your Apicurio Registry deployment</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph _abstract">
<p>This chapter explains various configuration options for Apicurio Registry, such as authentication, logging, cloud events, and health checks on OpenShift.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-security">Configuring Apicurio Registry authentication and authorization with Keycloak</a></p>
</li>
<li>
<p><a href="#registry-logging">Configuring Apicurio Registry logging</a></p>
</li>
<li>
<p><a href="#registry-cloud-events">Configuring Apicurio Registry event sourcing</a></p>
</li>
<li>
<p><a href="#configuring-liveness-readiness-probes">Configuring Apicurio Registry health checks on OpenShift</a></p>
</li>
<li>
<p><a href="#registry-liveness-env-vars">Environment variables for Apicurio Registry health checks</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-security"><a class="anchor" href="#registry-security"></a>Configuring Apicurio Registry authentication and authorization with Keycloak</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>This section explains how to manually configure authentication and authorization options for Apicurio Registry using Keycloak.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively, for details on how to configure these settings automatically,
see the <a href="https://www.apicur.io/registry/docs/apicurio-registry-operator/1.0.0/assembly-registry-maintenance.html#registry-security-keycloak">Apicurio Registry Operator documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can enable authentication for the Apicurio Registry web console and core REST API using Keycloak based on OAuth using OpenID Connect (OIDC). The same Keycloak realm and users are federated across the Apicurio Registry web console and core REST API using OpenID Connect so that you only require one set of credentials.</p>
</div>
<div class="paragraph">
<p>Apicurio Registry provides role-based authorization for default admin, write, and read-only user roles. Apicurio Registry also provides content-based authorization at the schema or API level, where only the creator of the registry artifact can update or delete it. Apicurio Registry authentication and authorization settings are disabled by default.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Keycloak is installed and running. For more details, see
<a href="https://www.keycloak.org/getting-started">Getting Started with Keycloak</a>.</p>
</li>
<li>
<p>Apicurio Registry is installed and running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak Admin Console, create a Keycloak realm for Apicurio Registry. By default, Apicurio Registry expects a realm name of <code>registry</code>. For more details on creating realms, see
<a href="https://www.keycloak.org/getting-started">Getting Started with Keycloak</a>.</p>
</li>
<li>
<p>Create a Keycloak client for the Apicurio Registry API. By default, Apicurio Registry expects the following settings:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Client ID</strong>: <code>registry-api</code></p>
</li>
<li>
<p><strong>Client Protocol</strong>: <code>openid-connect</code></p>
</li>
<li>
<p><strong>Access Type</strong>: <code>bearer-only</code></p>
<div class="paragraph">
<p>You can use the defaults for the other client settings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using Keycloak service accounts, the client <strong>Access Type</strong> must be <code>confidential</code> instead of <code>bearer-only</code>.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Create a Keycloak client for the Apicurio Registry web console. By default, Apicurio Registry expects the following settings:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Client ID</strong>: <code>apicurio-registry</code></p>
</li>
<li>
<p><strong>Client Protocol</strong>: <code>openid-connect</code></p>
</li>
<li>
<p><strong>Access Type</strong>: <code>public</code></p>
</li>
<li>
<p><strong>Valid Redirect URLs</strong>: <code>http://my-registry-url:8080/*</code></p>
</li>
<li>
<p><strong>Web Origins</strong>: <code>+</code></p>
<div class="paragraph">
<p>You can use the defaults for the other client settings.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In your Apicurio Registry deployment on OpenShift, set the following Apicurio Registry environment variables to configure authentication using Keycloak:</p>
<table class="tableblock frame-all grid-all stretch table-expandable">
<caption class="title">Table 1. Configuration for Apicurio Registry authentication</caption>
<colgroup>
<col style="width: 31.25%;">
<col style="width: 31.25%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment variable</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTH_ENABLED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, the environment variables that follow are required.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KEYCLOAK_URL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL of the Keycloak authentication server to use. Must end with <code>/auth</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KEYCLOAK_REALM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Keycloak realm used for authentication.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KEYCLOAK_API_CLIENT_ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The client ID for the Apicurio Registry REST API.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry-api</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KEYCLOAK_UI_CLIENT_ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The client ID for the Apicurio Registry web console.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apicurio-registry</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For an example of setting environment variables on OpenShift, see <a href="#configuring-liveness-readiness-probes">Configuring Apicurio Registry health checks on OpenShift</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the following option to <code>true</code> to enable Apicurio Registry user roles in Keycloak:</p>
<table class="tableblock frame-all grid-all stretch table-expandable">
<caption class="title">Table 2. Configuration for Apicurio Registry user roles</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 35.7142%;">
<col style="width: 21.4285%;">
<col style="width: 14.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment variable</th>
<th class="tableblock halign-left valign-top">Java system property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ROLES_ENABLED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry.auth.roles.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>When Apicurio Registry user roles are enabled, you must assign Apicurio Registry users to at least one of the following default user roles in your Keycloak realm:</p>
<table class="tableblock frame-all grid-all stretch table-expandable">
<caption class="title">Table 3. Default user roles for registry authentication and authorization</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Read artifacts</th>
<th class="tableblock halign-left valign-top">Write artifacts</th>
<th class="tableblock halign-left valign-top">Global rules</th>
<th class="tableblock halign-left valign-top">Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sr-admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full access to all create, read, update, and delete operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sr-developer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to create, read, update, and delete operations, except configuring global rules. This role can configure artifact rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sr-readonly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to read and search operations only. This role cannot configure any rules.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Set the following to <code>true</code> to enable owner-only authorization for updates to schema and API artifacts in Apicurio Registry:</p>
<table class="tableblock frame-all grid-all stretch table-expandable">
<caption class="title">Table 4. Configuration for owner-only authorization</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 16.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment variable</th>
<th class="tableblock halign-left valign-top">Java system property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGISTRY_AUTH_OWNER_ONLY_AUTHORIZATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>registry.auth.owner-only-authorization</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For an open source example application and Keycloak realm, see <a href="https://github.com/Apicurio/apicurio-registry/tree/2.0.x/distro/docker-compose">Docker Compose-based example of using Keycloak with Apicurio Registry</a></p>
</li>
<li>
<p>For details on how to use Keycloak in a production environment, see
the <a href="https://www.keycloak.org/documentation">Keycloak documentation</a></p>
</li>
<li>
<p>For details on custom security configuration, the see <a href="https://quarkus.io/guides/security-openid-connect-web-authentication">Quarkus Open ID Connect documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-logging"><a class="anchor" href="#registry-logging"></a>Configuring Apicurio Registry logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can set Apicurio Registry logging configuration at runtime. Apicurio Registry provides a REST endpoint to set the log level for specific loggers for finer grained logging. This section explains how to view and set Apicurio Registry log levels at runtime using the Apicurio Registry <code>/admin</code> REST API.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Get the URL to access your Apicurio Registry instance, or get your Apicurio Registry route if you have Apicurio Registry deployed on OpenShift. This simple example uses a URL of <code>localhost:8080</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use this <code>curl</code> command to obtain the current log level for the logger <code>io.apicurio.registry.storage</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -i localhost:8080/apis/registry/v2/admin/loggers/io.apicurio.registry.storage
HTTP/1.1 200 OK
[...]
Content-Type: application/json
{"name":"io.apicurio.registry.storage","level":"INFO"}</code></pre>
</div>
</div>
</li>
<li>
<p>Use this <code>curl</code> command to change the log level for the logger <code>io.apicurio.registry.storage</code> to <code>DEBUG</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X PUT -i -H "Content-Type: application/json" --data '{"level":"DEBUG"}' localhost:8080/apis/registry/v2/admin/loggers/io.apicurio.registry.storage
HTTP/1.1 200 OK
[...]
Content-Type: application/json
{"name":"io.apicurio.registry.storage","level":"DEBUG"}</code></pre>
</div>
</div>
</li>
<li>
<p>Use this <code>curl</code> command to revert the log level for the logger <code>io.apicurio.registry.storage</code> to its default value:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X DELETE -i localhost:8080/apis/registry/v2/admin/loggers/io.apicurio.registry.storage
HTTP/1.1 200 OK
[...]
Content-Type: application/json
{"name":"io.apicurio.registry.storage","level":"INFO"}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-cloud-events"><a class="anchor" href="#registry-cloud-events"></a>Configuring Apicurio Registry event sourcing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure Apicurio Registry to send events when changes are made to the registry. For example, Apicurio Registry can trigger events when schema and API artifacts are created, updated, deleted, and so on. You can configure Apicurio Registry to send events to your applications and to third-party integrations in this way.</p>
</div>
<div class="paragraph">
<p>There are different protocols available for transporting the events. The currently implemented protocols are HTTP and Apache Kafka. However, regardless of the protocol, the events are sent using the CNCF CloudEvents specification.</p>
</div>
<div class="paragraph">
<p>All of the event types are defined in <code>io.apicurio.registry.events.dto.RegistryEventType</code>. For example, the event types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.apicurio.registry.artifact-created</code></p>
</li>
<li>
<p><code>io.apicurio.registry.artifact-updated</code></p>
</li>
<li>
<p><code>io.apicurio.registry.artifact-rule-created</code></p>
</li>
<li>
<p><code>io.apicurio.registry.global-rule-created</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure cloud events in Apicurio Registry using Java system properties or equivalent environment variables.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have an application that you want to send Apicurio Registry cloud events to. For example, this can be a custom application or a third-party application.</p>
</li>
</ul>
</div>
<h3 id="_configuring_apicurio_registry_event_sourcing_using_http" class="discrete">Configuring Apicurio Registry event sourcing using HTTP</h3>
<div class="paragraph">
<p>The example in this section shows a custom application running at <code>http://my-app-host:8888/events</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>When using the HTTP protocol, set your Apicurio Registry configuration to send events to a your application as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>registry.events.sink.my-custom-consumer=http://my-app-host:8888/events</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If required, you can configure multiple event consumers as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>registry.events.sink.my-custom-consumer=http://my-app-host:8888/events</code></p>
</li>
<li>
<p><code>registry.events.sink.other-consumer=http://my-consumer.com/events</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h3 id="_configuring_apicurio_registry_event_sourcing_using_apache_kafka" class="discrete">Configuring Apicurio Registry event sourcing using Apache Kafka</h3>
<div class="paragraph">
<p>The example in this section shows a Kafka topic named <code>my-registry-events</code> running on <code>my-kafka-host:9092</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>When using the Kafka protocol, set your Kafka topic as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>registry.events.kafka.topic=my-registry-events</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>You can set the configuration for the Kafka producer using the <code>KAFKA_BOOTSTRAP_SERVERS</code> environment variable:</p>
<div class="ulist">
<ul>
<li>
<p><code>KAFKA_BOOTSTRAP_SERVERS=my-kafka-host:9092</code></p>
<div class="paragraph">
<p>Alternatively, you can set the properties for the kafka producer using the <code>registry.events.kafka.config</code> prefix, for example:
<code>registry.events.kafka.config.bootstrap.servers=my-kafka-host:9092</code></p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>If required, you can also set the Kafka topic partition to use to produce events:</p>
<div class="ulist">
<ul>
<li>
<p><code>registry.events.kafka.topic-partition=1</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details, see the <a href="https://cloudevents.io/">CNCF CloudEvents specification</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-liveness-readiness-probes"><a class="anchor" href="#configuring-liveness-readiness-probes"></a>Configuring Apicurio Registry health checks on OpenShift</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>You can configure optional environment variables for liveness and readiness probes to monitor the health of the Apicurio Registry server on OpenShift:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Liveness probes</em> test if the application can make progress. If the application cannot make progress, OpenShift automatically restarts the failing Pod.</p>
</li>
<li>
<p><em>Readiness probes</em> test if the application is ready to process requests. If the application is not ready, it can become overwhelmed by requests, and OpenShift stops sending requests for the time that the probe fails. If other Pods are OK, they continue to receive requests.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The default values of the liveness and readiness environment variables are designed for most cases and should only be changed if required by your environment. Any changes to the defaults depend on your hardware, network, and amount of data stored. These values should be kept as low as possible to avoid unnecessary overhead.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have an OpenShift cluster with cluster administrator access.</p>
</li>
<li>
<p>You must have already installed Apicurio Registry on OpenShift.</p>
</li>
<li>
<p>You must have already installed and configured your chosen Apicurio Registry storage in Strimzi or PostgreSQL.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console, log in using an account with cluster administrator privileges.</p>
</li>
<li>
<p>Click <strong>Installed Operators</strong> &gt; <strong>Apicurio Registry</strong>.</p>
</li>
<li>
<p>On the <strong>ApicurioRegistry</strong> tab, click the Operator custom resource for your deployment, for example, <strong>example-apicurioregistry</strong>.</p>
</li>
<li>
<p>In the main overview page, find the <strong>Deployment Name</strong> section and the corresponding <code>DeploymentConfig</code> name for your Apicurio Registry deployment, for example, <strong>example-apicurioregistry</strong>.</p>
</li>
<li>
<p>In the left navigation menu, click <strong>Workloads</strong> &gt; <strong>Deployment Configs</strong>, and select your <code>DeploymentConfig</code> name.</p>
</li>
<li>
<p>Click the <strong>Environment</strong> tab, and enter your environment variables in the <strong>Single values env</strong> section, for example:</p>
<div class="ulist">
<ul>
<li>
<p><strong>NAME</strong>: <code>LIVENESS_STATUS_RESET</code></p>
</li>
<li>
<p><strong>VALUE</strong>: <code>350</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong> at the bottom.</p>
<div class="paragraph">
<p>Alternatively, you can perform these steps using the OpenShift <code>oc</code> command. For more details, see the <a href="https://docs.openshift.com/container-platform/4.6/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI documentation</a>.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#registry-liveness-env-vars">Environment variables for Apicurio Registry health checks</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.6/applications/application-health.html">OpenShift documentation on monitoring application health</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-liveness-env-vars"><a class="anchor" href="#registry-liveness-env-vars"></a>Environment variables for Apicurio Registry health checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the available environment variables for Apicurio Registry health checks on OpenShift. These include liveness and readiness probes to monitor the health of the Apicurio Registry server on OpenShift. For an example procedure, see <a href="#configuring-liveness-readiness-probes">Configuring Apicurio Registry health checks on OpenShift</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The following environment variables are provided for reference only. The default values are designed for most cases and should only be changed if required by your environment. Any changes to the defaults depend on your hardware, network, and amount of data stored. These values should be kept as low as possible to avoid unnecessary overhead.
</td>
</tr>
</table>
</div>
<h3 id="_liveness_environment_variables" class="discrete">Liveness environment variables</h3>
<table class="tableblock frame-all grid-all stretch table-expandable">
<caption class="title">Table 5. Environment variables for Apicurio Registry liveness probes</caption>
<colgroup>
<col style="width: 29.4117%;">
<col style="width: 29.4117%;">
<col style="width: 11.7647%;">
<col style="width: 29.4119%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVENESS_ERROR_THRESHOLD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of liveness issues or errors that can occur before the liveness probe fails.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVENESS_COUNTER_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period in which the threshold number of errors must occur. For example, if this value is 60 and the threshold is 1, the check fails after two errors occur in 1 minute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVENESS_STATUS_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that must elapse without any more errors for the liveness probe to reset to OK status.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVENESS_ERRORS_IGNORED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of ignored liveness exceptions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.grpc.StatusRuntimeException,org.apache.kafka.streams.errors.InvalidStateStoreException</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because OpenShift automatically restarts a Pod that fails a liveness check, the liveness settings, unlike readiness settings, do not directly affect behavior of Apicurio Registry on OpenShift.
</td>
</tr>
</table>
</div>
<h3 id="_readiness_environment_variables" class="discrete">Readiness environment variables</h3>
<table class="tableblock frame-all grid-all stretch table-expandable">
<caption class="title">Table 6. Environment variables for Apicurio Registry readiness probes</caption>
<colgroup>
<col style="width: 30.7692%;">
<col style="width: 38.4615%;">
<col style="width: 15.3846%;">
<col style="width: 15.3847%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READINESS_ERROR_THRESHOLD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of readiness issues or errors that can occur before the readiness probe fails.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READINESS_COUNTER_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period in which the threshold number of errors must occur. For example, if this value is 60 and the threshold is 1, the check fails after two errors occur in 1 minute.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READINESS_STATUS_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that must elapse without any more errors for the liveness probe to reset to OK status. In this case, this means how long the Pod stays not ready, until it returns to normal operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READINESS_TIMEOUT</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Readiness tracks the timeout of two operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How long it takes for storage requests to complete</p>
</li>
<li>
<p>How long it takes for HTTP REST API requests to return a response</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If these operations take more time than the configured timeout, this is counted as a readiness issue or error. This value controls the timeouts for both operations.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#configuring-liveness-readiness-probes">Configuring Apicurio Registry health checks on OpenShift</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.6/applications/application-health.html">OpenShift documentation on monitoring application health</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright © 2023 Red Hat, Inc. All rights reserved.</p>
</footer>
<script src="../../../assets/js/site.js"></script>
<script src="../../../assets/js/vendor/lunr.js"></script>
<script src="../../../assets/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/apicurio-registry/2.0.x/getting-started/assembly-configuring-the-registry.html"></script>
<script async src="../../../assets/../search-index.js"></script>
<script async src="../../../assets/js/vendor/highlight.js"></script>
  </body>
</html>
