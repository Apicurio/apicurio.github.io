<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Migrating an existing Apicurio Registry deployment :: Apicurio Registry</title>
    <link rel="canonical" href="https://www.apicur.io/registry/docs/apicurio-registry/2.5.x/getting-started/assembly-migrating-registry-v1-v2.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="../../../assets/css/site.css">
    <link rel="stylesheet" href="https://www.apicur.io/css/rhbar.css">
<link rel="stylesheet" href="../../../assets/css/search.css">
    <link rel="shortcut icon" href="https://www.apicur.io/images/favicon.ico" type="image/x-icon" integrity="sha384-if9KH+NQ2dMhdrWu+INnJTcvG6riRakUAnbhecX5a7voubrapo7ouFGS+GYZ/N4P" crossorigin="anonymous"/>
  </head>
  <body class="article">
<div id="rhbar">
    <a class="jbdevlogo" href="https://www.jboss.org/projects/about" rel="nofollow" target="_blank"></a>
    <a class="rhlogo" href="https://www.redhat.com/" rel="nofollow" target="_blank"></a>
</div>
<div class="masthead-header">

    <a href="" target="_blank" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    </a>
    <div class="masthead-logo"></div>
    <div class="masthead-brand"><a href="/">Apicurio Studio</a></div>
    <div class="masthead-menu">
          <input id="search-input" type="text" placeholder="Search docs">
    </div>

    <div class="masthead-menu">
        <ul>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </div>
</div>
<div class="body">
<div class="nav-container" data-component="apicurio-registry" data-version="2.0.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apicurio Registry</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-intro-to-the-registry.html">Introduction to Apicurio Registry</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-intro-to-registry-rules.html">Apicurio Registry content rules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-docker.html">Installing Apicurio Registry using Docker</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-openshift.html">Installing Apicurio Registry on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-storage-openshift.html">Installing Apicurio Registry storage on OpenShift</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="assembly-migrating-registry-v1-v2.html">Migrating an existing Apicurio Registry deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-configuring-the-registry.html">Configuring your Apicurio Registry deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-ui.html">Managing Apicurio Registry content using the web console</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-api.html">Managing Apicurio Registry content using the REST API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-maven.html">Managing Apicurio Registry content using the Maven plug-in</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-using-the-registry-client.html">Managing Apicurio Registry content using a Java client</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-using-kafka-client-serdes.html">Validating schemas using Kafka serializers/deserializers in Java clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-configuring-kafka-client-serdes.html">Configuring Kafka serializers/deserializers in Java clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-registry-reference.html">Apicurio Registry artifact reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://www.apicur.io/registry/docs/apicurio-registry-operator/1.0.0/index.html">Apicurio Registry Operator documentation</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apicurio Registry</span>
    <span class="version">2.0.x</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apicurio Registry</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../2.5.x/index.html">2.5.x</a>
        </li>
        <li class="version">
          <a href="../../2.4.x/index.html">2.4.x</a>
        </li>
        <li class="version">
          <a href="../../2.3.x/index.html">2.3.x</a>
        </li>
        <li class="version">
          <a href="../../2.2.x/index.html">2.2.x</a>
        </li>
        <li class="version">
          <a href="../../2.1.x/index.html">2.1.x</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">2.0.x</a>
        </li>
        <li class="version">
          <a href="../../1.3.3.Final/index.html">1.3.3.Final</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Apicurio Registry Operator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../apicurio-registry-operator/1.2.0-dev-v2.x/index.html">1.2.0-dev-v2.x</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.2-v2.5.11.final/index.html">1.1.2-v2.5.11.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.1-v2.5.9.final/index.html">1.1.1-v2.5.9.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.0-v2.4.12.final/index.html">1.1.0-v2.4.12.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.0.0/index.html">1.0.0</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/0.0.4/index.html">0.0.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../2.5.x/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apicurio Registry</a></li>
    <li><a href="assembly-migrating-registry-v1-v2.html">Migrating an existing Apicurio Registry deployment</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2.0.x</button>
  <div class="version-menu">
    <a class="version" href="../../2.5.x/getting-started/assembly-migrating-registry-v1-v2.html">2.5.x</a>
    <a class="version" href="../../2.4.x/getting-started/assembly-migrating-registry-v1-v2.html">2.4.x</a>
    <a class="version" href="../../2.3.x/getting-started/assembly-migrating-registry-v1-v2.html">2.3.x</a>
    <a class="version" href="../../2.2.x/getting-started/assembly-migrating-registry-v1-v2.html">2.2.x</a>
    <a class="version" href="../../2.1.x/getting-started/assembly-migrating-registry-v1-v2.html">2.1.x</a>
    <a class="version is-current" href="assembly-migrating-registry-v1-v2.html">2.0.x</a>
    <a class="version is-missing" href="../../1.3.3.Final/index.html">1.3.3.Final</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/Apicurio/apicurio-registry">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Migrating an existing Apicurio Registry deployment</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph _abstract">
<p>This chapter explains how to migrate an existing Apicurio Registry deployment from version 1.3.x to version 2.x.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-migration">Migration from Apicurio Registry 1.3.x to 2.x</a></p>
</li>
<li>
<p><a href="#migrating-registry-data">Migrating Apicurio Registry data</a></p>
</li>
<li>
<p><a href="#migrating-registry-applications">Migrating Apicurio Registry client applications</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-migration"><a class="anchor" href="#registry-migration"></a>Migration from Apicurio Registry 1.3.x to 2.x</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Apicurio Registry 2.x includes new features with breaking changes from the previous Apicurio Registry 1.3.x release. This section describes the major changes between Apicurio Registry 1.3.x and version 2.x.</p>
</div>
<div class="paragraph">
<p>Because of the breaking changes in 2.x, there is no automatic upgrade and a migration process is required. This involves moving the data in your existing registry to a new registry. You must also review your existing registry client applications and update their configuration to meet the new requirements.</p>
</div>
<div class="paragraph">
<p>When migrating to version 2.x, you must take the following major changes into account:</p>
</div>
<div class="sect2">
<h3 id="_new_data_storage_options"><a class="anchor" href="#_new_data_storage_options"></a>New data storage options</h3>
<div class="paragraph">
<p>The existing registry data storage options in Apicurio Registry 1.3.x (<code>streams</code>,<code>jpa</code>, and <code>infinispan</code>) have been replaced with new storage options in version 2.x (<code>sql</code> and <code>kafkasql</code>). These new storage options provide more robust, performant, and maintainable Apicurio Registry deployments.
The in-memory storage option (<code>mem</code>) is also still available, but is not suitable for production workloads.</p>
</div>
<div class="paragraph">
<p>For details on how to deploy Apicurio Registry 2.x with your chosen storage option,
see <a href="assembly-installing-registry-storage-openshift.html">Installing Apicurio Registry storage on OpenShift</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_v2_rest_api"><a class="anchor" href="#_new_v2_rest_api"></a>New v2 REST API</h3>
<div class="paragraph">
<p>Apicurio Registry 2.x includes a new REST API with support for artifact groups and improved long term maintainability. Apicurio Registry still supports the original registry v1 REST API and compatibility APIs, for example, Confluent and IBM schema registry APIs. Apicurio Registry now also implements the Schema Registry specification provided in the CNCF Cloud Events specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_refactored_java_client_libraries"><a class="anchor" href="#_refactored_java_client_libraries"></a>Refactored Java client libraries</h3>
<div class="ulist">
<ul>
<li>
<p>The Apicurio Registry Java client classes are available in version 2.x in a different Maven module named <code>apicurio-registry-client</code>.</p>
</li>
<li>
<p>The Kakfa client serializer and deserializer (SerDe) classes are available in version 2.x in three different Maven modules, one for each supported data format: Apache Avro, Protobuf, and JSON Schema. You can now use only the module you want without pulling in transitive dependencies that you are not concerned with.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details on the v2 REST API, see the <a href="../assets-attachments/registry-rest-api.htm">Registry REST API documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-registry-data"><a class="anchor" href="#migrating-registry-data"></a>Migrating Apicurio Registry data</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Migrating data to Apicurio Registry 2.x requires exporting all data from your existing 1.3.x deployment and importing it into the new 2.x deployment. If you are using Apicurio Registry as a schema registry for Kafka applications, data migration is critical because each Kafka message carries the global identifier for the schema stored in Apicurio Registry. This identifier must be preserved during registry data migration.</p>
</div>
<div class="paragraph">
<p>Apicurio Registry 2.x provides an API to bulk import/export all data from your registry deployment, which guarantees that all identifiers are kept when importing data from your existing registry. The export API downloads a custom <code>.zip</code> file containing all the information for your artifacts. The import API accepts this <code>.zip</code> and loads all artifacts into the registry in a single batch.</p>
</div>
<div class="paragraph">
<p>Apicurio Registry 1.3.x does not provide an import/export API. However, version 2.x provides an export tool compatible with Apicurio Registry 1.3.x to export a <code>.zip</code>, which you can import into your 2.x registry. This tool uses common existing APIs to export all content in the registry. However, it is less performant than the 2.x export API, and should only be used when exporting from a 1.3.x registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Running Apicurio Registry instances of the 1.3.x server you are exporting from and the 2.x server you are importing into.</p>
</li>
<li>
<p>Download the
<a href="https://github.com/Apicurio/apicurio-registry/releases/download/2.0.1.Final/apicurio-registry-utils-exportV1-2.0.1.Final.jar">Apicurio Registry exportV1 tool</a> from GitHub.
This is a Java application that you can run on the command line.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Export all the data from Apicurio Registry 1.3.x using the <code>exportV1</code> tool. This generates a <code>registry-export.zip</code> file in your current directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">java -jar apicurio-registry-utils-exportV1-2.0.1.Final.jar http://old-registry.my-company.com/api</code></pre>
</div>
</div>
</li>
<li>
<p>Import the <code>.zip</code> file into Apicurio Registry 2.x using the import API:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST "http://new-registry.my-company.com/apis/registry/v2/admin/import" \
  -H "Accept: application/json" -H "Content-Type: application/zip" \
  --data-binary @registry-export.zip</code></pre>
</div>
</div>
</li>
<li>
<p>Check that all the artifacts have been imported into the new 2.x registry by running these commands and comparing the count field:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl "http://old-registry.my-company.com/api/search/artifacts"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl "http://new-registry.my-company.com/apis/registry/v2/search/artifacts"</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details on the import/export REST API, see
<a href="assembly-managing-registry-artifacts-api.html">Managing Apicurio Registry content using the REST API</a></p>
</li>
<li>
<p>For more details on the export tool for migrating from version 1.x to 2.x, see the <a href="https://github.com/Apicurio/apicurio-registry/tree/2.0.x/utils/exportV1">Apicurio Registry export utility for 1.x versions</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-registry-applications"><a class="anchor" href="#migrating-registry-applications"></a>Migrating Apicurio Registry client applications</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>You must review your existing Apicurio Registry client applications to ensure that the Maven dependencies and Java client configuration meet the new requirements for version 2.x. For example, this includes new Maven dependencies for the Apicurio Registry Java REST client libraries or Kafka client serializer/deserializer (Serdes) libraries. You must also update your Java application configuration with the new registry v2 API path.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Existing Apicurio Registry 1.3.x Java client application or Kafka client producer and consumer Java applications with SerDes</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>If you are using the Apicurio Registry Java REST client, you must change the Maven dependencies for the Apicurio Registry Java client libraries, which have been repackaged in version 2.x:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-client&lt;/artifactId&gt;
    &lt;version&gt;2.0.1.Final&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In your Java client application, you must change your registry URL configuration, from pointing to the existing v1 API path to the new v2 path. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ClientExample {

    private static final RegistryRestClient client;

     public static void main(String[] args) throws Exception {
        // Create a registry client
        String registryUrl = "https://new-registry.my-company.com/apis/registry/v2";
        RegistryClient client = RegistryClientFactory.create(registryUrl);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more details on the Java client in
<a href="assembly-using-the-registry-client.html">Managing Apicurio Registry content using a Java client</a>.</p>
</div>
</li>
<li>
<p>If you are using the Apicurio Registry SerDes libraries, you must change the Maven dependencies, which have been repackaged in version 2.x. In Apicurio Registry 1.3.x, the SerDes libraries were all provided with only one Maven dependency:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-utils-serde&lt;/artifactId&gt;
    &lt;version&gt;1.3.2.Final&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Apicurio Registry 2.x, the SerDes libraries have been split into three Maven dependencies, one for each supported data format: <code>avro</code>, <code>protobuf</code>, and <code>json schema</code>, depending on your use cases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-serdes-avro-serde&lt;/artifactId&gt;
    &lt;version&gt;2.0.1.Final&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-serdes-protobuf-serde&lt;/artifactId&gt;
    &lt;version&gt;2.0.1.Final&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.apicurio&lt;/groupId&gt;
    &lt;artifactId&gt;apicurio-registry-serdes-jsonschema-serde&lt;/artifactId&gt;
    &lt;version&gt;2.0.1.Final&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In your Kafka producer and consumer Java applications, you must change your registry URL configuration from pointing to the existing v1 API path to the new v2 path. For example:</p>
<div class="paragraph">
<p><em>Existing registry v1 API path</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">props.putIfAbsent(AbstractKafkaSerDe.REGISTRY_URL_CONFIG_PARAM, "http://old-registry.my-company.com/api");</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>New registry v2 API path</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">props.putIfAbsent(SerdeConfig.REGISTRY_URL, "http://new-registry.my-company.com/apis/registry/v2");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The refactored SerDes libraries also include other important changes to configuration properties. For more details on SerDes configuration, see
<a href="assembly-using-kafka-client-serdes.html">Validating schemas using Kafka client serializers/deserializers in Java clients</a>.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For detailed configuration examples, see the <a href="https://github.com/Apicurio/apicurio-registry-examples/tree/2.0.x">Apicurio Registry example applications</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright © 2023 Red Hat, Inc. All rights reserved.</p>
</footer>
<script src="../../../assets/js/site.js"></script>
<script src="../../../assets/js/vendor/lunr.js"></script>
<script src="../../../assets/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/apicurio-registry/2.0.x/getting-started/assembly-migrating-registry-v1-v2.html"></script>
<script async src="../../../assets/../search-index.js"></script>
<script async src="../../../assets/js/vendor/highlight.js"></script>
  </body>
</html>
