<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validating schemas using Kafka client serializers/deserializers :: Apicurio Registry</title>
    <link rel="canonical" href="https://www.apicur.io/registry/docs/apicurio-registry/2.5.x/getting-started/assembly-using-kafka-client-serdes.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="../../../assets/css/site.css">
    <link rel="stylesheet" href="https://www.apicur.io/css/rhbar.css">
<link rel="stylesheet" href="../../../assets/css/search.css">
    <link rel="shortcut icon" href="https://www.apicur.io/images/favicon.ico" type="image/x-icon" integrity="sha384-if9KH+NQ2dMhdrWu+INnJTcvG6riRakUAnbhecX5a7voubrapo7ouFGS+GYZ/N4P" crossorigin="anonymous"/>
  </head>
  <body class="article">
<div id="rhbar">
    <a class="jbdevlogo" href="https://www.jboss.org/projects/about" rel="nofollow" target="_blank"></a>
    <a class="rhlogo" href="https://www.redhat.com/" rel="nofollow" target="_blank"></a>
</div>
<div class="masthead-header">

    <a href="" target="_blank" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    </a>
    <div class="masthead-logo"></div>
    <div class="masthead-brand"><a href="/">Apicurio Studio</a></div>
    <div class="masthead-menu">
          <input id="search-input" type="text" placeholder="Search docs">
    </div>

    <div class="masthead-menu">
        <ul>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </div>
</div>
<div class="body">
<div class="nav-container" data-component="apicurio-registry" data-version="1.3.3.Final">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apicurio Registry</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-intro-to-the-registry.html">Introduction to Apicurio Registry</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-intro-to-registry-rules.html">Apicurio Registry content rules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-docker.html">Installing Apicurio Registry using Docker</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-openshift.html">Installing Apicurio Registry on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-registry-storage-openshift.html">Installing Apicurio Registry storage on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-configuring-the-registry.html">Configuring Apicurio Registry deployment on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-ui.html">Managing Apicurio Registry content using the web console</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-api.html">Managing Apicurio Registry content using the REST API</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-maven.html">Managing Apicurio Registry content using the Maven plug-in</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-using-the-registry-client.html">Managing Apicurio Registry content using the Java client</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="assembly-using-kafka-client-serdes.html">Validating schemas using Kafka client serializers/deserializers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-registry-reference.html">Apicurio Registry artifact reference</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apicurio Registry</span>
    <span class="version">1.3.3.Final</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apicurio Registry</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../2.5.x/index.html">2.5.x</a>
        </li>
        <li class="version">
          <a href="../../2.4.x/index.html">2.4.x</a>
        </li>
        <li class="version">
          <a href="../../2.3.x/index.html">2.3.x</a>
        </li>
        <li class="version">
          <a href="../../2.2.x/index.html">2.2.x</a>
        </li>
        <li class="version">
          <a href="../../2.1.x/index.html">2.1.x</a>
        </li>
        <li class="version">
          <a href="../../2.0.x/index.html">2.0.x</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">1.3.3.Final</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Apicurio Registry Operator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../apicurio-registry-operator/1.2.0-dev-v2.x/index.html">1.2.0-dev-v2.x</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.2-v2.5.11.final/index.html">1.1.2-v2.5.11.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.1-v2.5.9.final/index.html">1.1.1-v2.5.9.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.1.0-v2.4.12.final/index.html">1.1.0-v2.4.12.final</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/1.0.0/index.html">1.0.0</a>
        </li>
        <li class="version">
          <a href="../../../apicurio-registry-operator/0.0.4/index.html">0.0.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../2.5.x/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apicurio Registry</a></li>
    <li><a href="assembly-using-kafka-client-serdes.html">Validating schemas using Kafka client serializers/deserializers</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">1.3.3.Final</button>
  <div class="version-menu">
    <a class="version" href="../../2.5.x/getting-started/assembly-using-kafka-client-serdes.html">2.5.x</a>
    <a class="version" href="../../2.4.x/getting-started/assembly-using-kafka-client-serdes.html">2.4.x</a>
    <a class="version" href="../../2.3.x/getting-started/assembly-using-kafka-client-serdes.html">2.3.x</a>
    <a class="version" href="../../2.2.x/getting-started/assembly-using-kafka-client-serdes.html">2.2.x</a>
    <a class="version" href="../../2.1.x/getting-started/assembly-using-kafka-client-serdes.html">2.1.x</a>
    <a class="version" href="../../2.0.x/getting-started/assembly-using-kafka-client-serdes.html">2.0.x</a>
    <a class="version is-current" href="assembly-using-kafka-client-serdes.html">1.3.3.Final</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/Apicurio/apicurio-registry">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Validating schemas using Kafka client serializers/deserializers</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apicurio Registry provides Kafka client serializers/deserializers for producer and consumer applications. Kafka producer applications use serializers to encode messages that conform to a specific event schema. Kafka consumer applications use deserializers to validate that the messages have been serialized using the correct schema, based on a specific schema ID. This ensures consistent schema use and helps to prevent data errors at runtime.</p>
</div>
<div class="paragraph">
<p>This chapter provides instructions on how to use the Kafka client serializers and deserializers for Apache Avro, JSON Schema, and Google Protobuf in your Kafka producer and consumer client applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-serdes-concepts-serde-registry">Kafka client applications and Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-concepts-strategy-registry">Strategies to look up a schema</a></p>
</li>
<li>
<p><a href="#registry-serdes-concepts-constants-registry">Apicurio Registry serializer/deserializer constants</a></p>
</li>
<li>
<p><a href="#registry-serdes-types-serde-registry">Using different client serializer/deserializer types</a></p>
</li>
<li>
<p><a href="#registry-serdes-types-avro-registry">Configure Avro SerDe with Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-types-json-registry">Configure JSON Schema SerDe with Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-types-protobuf-registry">Configure Protobuf SerDe with Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-register-registry">Registering a schema in Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-consumer-registry">Using a schema from a Kafka consumer client</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-producer-registry">Using a schema from a Kafka producer client</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-stream-registry">Using a schema from a Kafka Streams application</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have read <a href="assembly-intro-to-the-registry.html">Introduction to Apicurio Registry</a></p>
</li>
<li>
<p>You must have installed Apicurio Registry.</p>
</li>
<li>
<p>You must have created Kafka producer and consumer client applications.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-concepts-serde-registry"><a class="anchor" href="#registry-serdes-concepts-serde-registry"></a>Kafka client applications and Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using Apicurio Registry decouples schema management from client application configuration. You can enable an application to use a schema from the registry by specifying its URL in the client code.</p>
</div>
<div class="paragraph">
<p>For example, you can store the schemas to serialize and deserialize messages in the registry, which are then referenced from the applications that use them to ensure that the messages that they send and receive are compatible with those schemas. Kafka client applications can push or pull their schemas from Apicurio Registry at runtime.</p>
</div>
<div class="paragraph">
<p>Schemas can evolve, so you can define rules in Apicurio Registry, for example, to ensure that changes to a schema are valid and do not break previous versions used by applications. Apicurio Registry checks for compatibility by comparing a modified schema with previous schema versions.</p>
</div>
<div class="paragraph">
<p>Apicurio Registry provides schema registry support for a number of schema technologies such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avro</p>
</li>
<li>
<p>Protobuf</p>
</li>
<li>
<p>JSON Schema</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These schema technologies can be used by client applications through Kafka client serializer/deserializer (SerDe) services provided by Apicurio Registry.  The maturity and usage of the SerDe classes provided by Apicurio Registry may vary. See the type-specific sections below for more details about each.</p>
</div>
<h3 id="_producer_schema_configuration" class="discrete">Producer schema configuration</h3>
<div class="paragraph">
<p>A producer client application uses a serializer to put the messages that it sends to a specific broker topic into the correct data format.</p>
</div>
<div class="paragraph">
<p>To enable a producer to use Apicurio Registry for serialization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-serdes-register-registry">Define and register your schema with Apicurio Registry</a> (optional)</p>
</li>
<li>
<p><a href="#registry-serdes-config-producer-registry">Configure the producer client code</a>:</p>
<div class="ulist">
<ul>
<li>
<p>URL of Apicurio Registry</p>
</li>
<li>
<p>Apicurio Registry serializer to use with the messages</p>
</li>
<li>
<p>Strategy to map the Kafka message to an artifact ID in Apicurio Registry</p>
</li>
<li>
<p>Strategy to look up or register the schema used for serialization in Apicurio Registry</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After registering your schema, when you start Kafka and Apicurio Registry, you can access the schema to format messages sent to the Kafka broker topic by the producer.  Alternatively (depending on configuration), the producer can automatically register the schema on first use.</p>
</div>
<div class="paragraph">
<p>If a schema already exists, you can create a new version using the REST API based on compatibility rules defined in Apicurio Registry. Versions are used for compatibility checking as a schema evolves. An artifact ID and schema version represents a unique tuple that identifies a schema.</p>
</div>
<h3 id="_consumer_schema_configuration" class="discrete">Consumer schema configuration</h3>
<div class="paragraph">
<p>A consumer client application uses a deserializer to get the messages that it consumes from a specific broker topic into the correct data format.</p>
</div>
<div class="paragraph">
<p>To enable a consumer to use Apicurio Registry for deserialization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-serdes-register-registry">Define and register your schema with Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-consumer-registry">Configure the consumer client code</a>:</p>
<div class="ulist">
<ul>
<li>
<p>URL of Apicurio Registry</p>
</li>
<li>
<p>Apicurio Registry deserializer to use with the messages</p>
</li>
<li>
<p>Input data stream for deserialization</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The schema is then retrieved by the deserializer using a global ID written into the message being consumed.  The schema global ID can be located in the message headers or in the message payload itself, depending on the configuration of the producer application.</p>
</div>
<div class="paragraph">
<p>When locating the global ID in the message payload, the format of the data begins with a magic byte (as a signal to consumers) followed by the global ID and then the message data as normal.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># ...
[MAGIC_BYTE]
[GLOBAL_ID]
[MESSAGE DATA]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when you start Kafka and Apicurio Registry, you can access the schema to format messages received from the Kafka broker topic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-concepts-strategy-registry"><a class="anchor" href="#registry-serdes-concepts-strategy-registry"></a>Strategies to look up a schema</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Kafka client serializer uses <em>lookup strategies</em> to determine the artifact ID and the global ID under which the message schema is registered in Apicurio Registry.</p>
</div>
<div class="paragraph">
<p>For a given topic and message, you can use implementations of the following Java interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ArtifactIdStrategy</code> to return an artifact ID</p>
</li>
<li>
<p><code>GlobalIdStrategy</code> to return a global ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The classes for each strategy are organized in the <code>io.apicurio.registry.utils.serde.strategy</code> package. The default strategy is the artifact ID <code>TopicIdStrategy</code>, which looks for Apicurio Registry artifacts with the same name as the Kafka topic receiving messages.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public String artifactId(String topic, boolean isKey, T schema) {
    return String.format("%s-%s", topic, isKey ? "key" : "value");
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>topic</code> parameter is the name of the Kafka topic receiving the message.</p>
</li>
<li>
<p>The <code>isKey</code> parameter is <code>true</code> when the message key is being serialized, and <code>false</code> when the message value is being serialized.</p>
</li>
<li>
<p>The <code>schema</code> parameter is the schema of the message being serialized or deserialized.</p>
</li>
<li>
<p>The <code>artifactID</code> returned is the artifact ID under which the schema is registered in Apicurio Registry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which lookup strategy you use depends on how and where you store your schema. For example, you might use a strategy that uses a <em>record ID</em> if you have different Kafka topics with the same Avro message type.</p>
</div>
<h3 id="_artifact_id_strategy" class="discrete">Artifact ID strategy</h3>
<div class="paragraph">
<p>The artifact ID strategy provides a way to map the Kafka topic and message information to an artifact ID in Apicurio Registry. The common convention for the mapping is to combine the Kafka topic name with the <code>key</code> or <code>value</code>, depending on whether the serializer is used for the Kafka message key or value.</p>
</div>
<div class="paragraph">
<p>However, you can use alternative conventions for the mapping by using a strategy provided by Apicurio Registry, or by creating a custom Java class that implements <code>io.apicurio.registry.utils.serde.strategy.ArtifactIdStrategy</code>.</p>
</div>
<h3 id="service-registry-concepts-artifactid-registry" class="discrete">Strategies to return an artifact ID</h3>
<div class="paragraph">
<p>Apicurio Registry provides the following strategies to return an artifact ID based on an implementation of <code>ArtifactIdStrategy</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>RecordIdStrategy</code></dt>
<dd>
<p>Avro-specific strategy that uses the full name of the schema.</p>
</dd>
<dt class="hdlist1"><code>TopicRecordIdStrategy</code></dt>
<dd>
<p>Avro-specific strategy that uses the topic name and the full name of the schema.</p>
</dd>
<dt class="hdlist1"><code>TopicIdStrategy</code></dt>
<dd>
<p>Default strategy that uses the topic name and <code>key</code> or <code>value</code> suffix.</p>
</dd>
<dt class="hdlist1"><code>SimpleTopicIdStrategy</code></dt>
<dd>
<p>Simple strategy that only uses the topic name.</p>
</dd>
</dl>
</div>
<h3 id="_global_id_strategy" class="discrete">Global ID strategy</h3>
<div class="paragraph">
<p>The global ID strategy locates and identifies the specific version of the schema registered under the artifact ID provided by the artifact ID strategy. Every version of every artifact has a single globally unique identifier that can be used to retrieve the content of that artifact. This global ID is included in every Kafka message so that a deserializer can properly fetch the schema from Apicurio Registry.</p>
</div>
<div class="paragraph">
<p>The global ID strategy can look up an existing artifact version, or it can register one if not found, depending on which strategy is used. You can also provide your own strategy by creating a
custom Java class that implements <code>io.apicurio.registry.utils.serde.strategy.GlobalIdStrategy</code>.</p>
</div>
<h3 id="service-registry-concepts-globalid-registry" class="discrete">Strategies to return a global ID</h3>
<div class="paragraph">
<p>Apicurio Registry provides the following strategies to return a global ID based on an implementation of <code>GlobalIdStrategy</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>FindLatestIdStrategy</code></dt>
<dd>
<p>Strategy that returns the global ID of the latest schema version, based on an artifact ID.</p>
</dd>
<dt class="hdlist1"><code>FindBySchemaIdStrategy</code></dt>
<dd>
<p>Strategy that matches schema content, based on an artifact ID, to return a global ID.</p>
</dd>
<dt class="hdlist1"><code>CachedSchemaIdStrategy</code></dt>
<dd>
<p>Strategy that caches the schema, and uses the global ID of the cached schema.</p>
</dd>
<dt class="hdlist1"><code>GetOrCreateIdStrategy</code></dt>
<dd>
<p>Strategy that tries to get the latest schema, based on an artifact ID, and if it does not exist, creates a new schema.</p>
</dd>
<dt class="hdlist1"><code>AutoRegisterIdStrategy</code></dt>
<dd>
<p>Strategy that updates the schema, and uses the global ID of the updated schema.</p>
</dd>
</dl>
</div>
<h3 id="configuring-globalid-strategy-registry" class="discrete">Global ID strategy configuration</h3>
<div class="paragraph">
<p>You can configure the following application property for the global ID strategy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apicurio.registry.check-period-ms</code>: Configures the remote schema lookup period in milliseconds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure application properties as Java system properties or include them in the Quarkus
<code>application.properties</code> file. For more details, see the <a href="https://quarkus.io/guides/config#overriding-properties-at-runtime">Quarkus documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-concepts-constants-registry"><a class="anchor" href="#registry-serdes-concepts-constants-registry"></a>Apicurio Registry serializer/deserializer constants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure specific client serializer/deserializer (SerDe) services and schema lookup strategies directly into a client using the constants outlined in this section.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can specify the constants in a properties file, or a properties instance.</p>
</div>
<h3 id="_constants_for_serializerdeserializer_services" class="discrete">Constants for serializer/deserializer services</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class AbstractKafkaSerDe&lt;T extends AbstractKafkaSerDe&lt;T&gt;&gt; implements AutoCloseable {
   protected final Logger log = LoggerFactory.getLogger(getClass());

   public static final String REGISTRY_URL_CONFIG_PARAM = "apicurio.registry.url"; <i class="conum" data-value="1"></i><b>(1)</b>
   public static final String REGISTRY_CACHED_CONFIG_PARAM = "apicurio.registry.cached"; <i class="conum" data-value="2"></i><b>(2)</b>
   public static final String REGISTRY_ID_HANDLER_CONFIG_PARAM = "apicurio.registry.id-handler"; <i class="conum" data-value="3"></i><b>(3)</b>
   public static final String REGISTRY_CONFLUENT_ID_HANDLER_CONFIG_PARAM = "apicurio.registry.as-confluent"; <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>(Required) The URL of Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Allows the client to make the request and look up the information from a cache of previous results, to improve processing time.
If the cache is empty, the lookup is performed from Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Extends ID handling to support other ID formats and make them compatible with Apicurio Registry SerDe services.
For example, changing the ID format from <code>Long</code> to <code>Integer</code> supports the Confluent ID format.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A flag to simplify the handling of Confluent IDs. If set to <code>true</code>, an <code>Integer</code> is used for the global ID lookup.</td>
</tr>
</table>
</div>
<h3 id="_constants_for_lookup_strategies" class="discrete">Constants for lookup strategies</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class AbstractKafkaStrategyAwareSerDe&lt;T, S extends AbstractKafkaStrategyAwareSerDe&lt;T, S&gt;&gt; extends AbstractKafkaSerDe&lt;S&gt; {
   public static final String REGISTRY_ARTIFACT_ID_STRATEGY_CONFIG_PARAM = "apicurio.registry.artifact-id"; <i class="conum" data-value="1"></i><b>(1)</b>
   public static final String REGISTRY_GLOBAL_ID_STRATEGY_CONFIG_PARAM = "apicurio.registry.global-id"; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#service-registry-concepts-artifactid-registry">ArtifactId strategy</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#service-registry-concepts-globalid-registry">Global ID strategy</a>.</td>
</tr>
</table>
</div>
<h3 id="_constants_for_converters" class="discrete">Constants for converters</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SchemalessConverter&lt;T&gt; extends AbstractKafkaSerDe&lt;SchemalessConverter&lt;T&gt;&gt; implements Converter {
   public static final String REGISTRY_CONVERTER_SERIALIZER_PARAM = "apicurio.registry.converter.serializer"; <i class="conum" data-value="1"></i><b>(1)</b>
   public static final String REGISTRY_CONVERTER_DESERIALIZER_PARAM = "apicurio.registry.converter.deserializer"; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>(Required) Serializer to use with the converter.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>(Required) Deserializer to use with the converter.</td>
</tr>
</table>
</div>
<h3 id="_constants_for_avro_data_providers" class="discrete">Constants for Avro data providers</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface AvroDatumProvider&lt;T&gt; {
   String REGISTRY_AVRO_DATUM_PROVIDER_CONFIG_PARAM = "apicurio.registry.avro-datum-provider"; <i class="conum" data-value="1"></i><b>(1)</b>
   String REGISTRY_USE_SPECIFIC_AVRO_READER_CONFIG_PARAM = "apicurio.registry.use-specific-avro-reader"; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Avro Datum provider to write data to a schema, with or without reflection.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Flag to set to use an Avro-specific datum reader.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DefaultAvroDatumProvider (io.apicurio.registry.utils.serde.avro) <i class="conum" data-value="1"></i><b>(1)</b>
ReflectAvroDatumProvider (io.apicurio.registry.utils.serde.avro) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default datum reader.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Datum reader using reflection.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-types-serde-registry"><a class="anchor" href="#registry-serdes-types-serde-registry"></a>Using different client serializer/deserializer types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When using a schema technology in your Kafka applications, you must choose which specific schema type to use. Common options include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Avro</p>
</li>
<li>
<p>JSON Schema</p>
</li>
<li>
<p>Google Protobuf</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which schema technology you choose is dependent on use case and preference. Of course you can use Kafka to implement custom serializer and deserializer classes, so you are always free to write your own classes, including leveraging Apicurio Registry functionality using the Apicurio Registry REST Java client.</p>
</div>
<div class="paragraph">
<p>For your convenience, Apicurio Registry provides out-of-the box SerDe classes for Avro, JSON Schema, and Protobuf schema technologies. The following sections explains how to configure Kafka applications to use each type.</p>
</div>
<h3 id="_kafka_application_configuration_for_serializersdeserializers" class="discrete">Kafka application configuration for serializers/deserializers</h3>
<div class="paragraph">
<p>Using one of the serializer or deserializer classes provided by Apicurio Registry in your Kafka application involves setting the correct configuration properties. The following simple examples show how to configure a serializer in a Kafka producer application and how to configure a deserializer in a Kafka consumer application.</p>
</div>
<div class="listingblock">
<div class="title">Example serializer configuration in a Kafka producer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Producer&lt;Object,Object&gt; createKafkaProducer(String kafkaBootstrapServers, String topicName) {
    Properties props = new Properties();

    // Configure standard Kafka settings
    props.putIfAbsent(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaBootstrapServers);
    props.putIfAbsent(ProducerConfig.CLIENT_ID_CONFIG, "Producer-" + topicName);
    props.putIfAbsent(ProducerConfig.ACKS_CONFIG, "all");

    // Use a Apicurio Registry-provided Kafka serializer
    props.putIfAbsent(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,
        io.apicurio.registry.utils.serde.AvroKafkaSerializer.class.getName());
    props.putIfAbsent(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,
        io.apicurio.registry.utils.serde.AvroKafkaSerializer.class.getName());

    // Configure Apicurio Registry location
    props.putIfAbsent(AbstractKafkaSerDe.REGISTRY_URL_CONFIG_PARAM, REGISTRY_URL);

    // Map the topic name (plus -key/value) to the artifactId in the registry
    props.putIfAbsent(AbstractKafkaSerializer.REGISTRY_ARTIFACT_ID_STRATEGY_CONFIG_PARAM,
        io.apicurio.registry.utils.serde.strategy.TopicIdStrategy.class.getName());

    // Get an existing schema or auto-register if not found
    props.putIfAbsent(AbstractKafkaSerializer.REGISTRY_GLOBAL_ID_STRATEGY_CONFIG_PARAM,
        io.apicurio.registry.utils.serde.strategy.GetOrCreateIdStrategy.class.getName());

    // Create the Kafka producer
    Producer&lt;Object, Object&gt; producer = new KafkaProducer&lt;&gt;(props);
    return producer;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example deserializer configuration in a Kafka consumer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Consumer&lt;Object,Object&gt; createKafkaConsumer(String kafkaBootstrapServers, String topicName) {
    Properties props = new Properties();

    // Configure standard Kafka settings
    props.putIfAbsent(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaBootstrapServers);
    props.putIfAbsent(ConsumerConfig.GROUP_ID_CONFIG, "Consumer-" + topicName);
    props.putIfAbsent(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, "true");
    props.putIfAbsent(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, "1000");
    props.putIfAbsent(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");

    // Use a Apicurio Registry-provided Kafka deserializer
    props.putIfAbsent(ProducerConfig.KEY_DESERIALIZER_CLASS_CONFIG,
        io.apicurio.registry.utils.serde.AvroKafkaDeserializer.class.getName());
    props.putIfAbsent(ProducerConfig.VALUE_DESERIALIZER_CLASS_CONFIG,
        io.apicurio.registry.utils.serde.AvroKafkaDeserializer.class.getName());

    // Configure Apicurio Registry location
    props.putIfAbsent(AbstractKafkaSerDe.REGISTRY_URL_CONFIG_PARAM, REGISTRY_URL);

    // No other configuration needed for deserializer because  globalId of the schema
    // the deserializer uses is sent as part of the message. The deserializer simply
    // extracts that globalId and uses it to look up the schema from the registry.

    // Create the Kafka consumer
    KafkaConsumer&lt;Long, GenericRecord&gt; consumer = new KafkaConsumer&lt;&gt;(props);
    return consumer;
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="registry-serdes-types-avro-registry"><a class="anchor" href="#registry-serdes-types-avro-registry"></a>Configure Avro SerDe with Apicurio Registry</h3>
<div class="paragraph">
<p>Apicurio Registry provides Kafka client serializer and deserializer classes for Apache Avro to make using Avro as
easy as possible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.apicurio.registry.utils.serde.AvroKafkaSerializer</code></p>
</li>
<li>
<p><code>io.apicurio.registry.utils.serde.AvroKafkaDeserializer</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Configure the Avro serializer</div>
<p>You can configure the Avro serializer class in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apicurio Registry location as a URL</p>
</li>
<li>
<p>Artifact ID strategy</p>
</li>
<li>
<p>Global ID strategy</p>
</li>
<li>
<p>Global ID location</p>
</li>
<li>
<p>Global ID handler</p>
</li>
<li>
<p>Avro datum provider</p>
</li>
<li>
<p>Avro encoding</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Global ID location</div>
<p>The serializer passes the unique global ID of the schema as part of the Kafka message so that consumers can use the right schema for deserialization.  The location of that global ID can be in the payload of the message or in the message headers. The default approach is to pass the global ID in the message payload. If you want the ID sent in the message headers instead, you can set the following configuration property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>props.putIfAbsent(AbstractKafkaSerDe.USE_HEADERS, "true")</pre>
</div>
</div>
<div class="paragraph">
<p>The property name is <code>apicurio.registry.use.headers</code>.</p>
</div>
<div class="paragraph">
<div class="title">Global ID handler</div>
<p>You can customize precisely how the global ID is encoded when passing it in the Kafka message body. Set
the configuration property <code>apicurio.registry.id-handler</code> to be a class that implements the
<code>io.apicurio.registry.utils.serde.strategy.IdHandler</code> interface. Apicurio Registry provides two implementations of
that interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.apicurio.registry.utils.serde.strategy.DefaultIdHandler</code> - stores the ID as an 8 byte long</p>
</li>
<li>
<p><code>io.apicurio.registry.utils.serde.strategy.Legacy4ByteIdHandler</code> - stores the ID as an 4 byte int</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apicurio Registry represents the global ID of an artifact as a long, but for legacy reasons (or for compatibility with other registries or serde classes) you may want to use 4 bytes when sending the ID.</p>
</div>
<div class="paragraph">
<div class="title">Avro datum provider</div>
<p>Avro provides different datum writers and readers to write and read data. Apicurio Registry supports three different types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generic</p>
</li>
<li>
<p>Specific</p>
</li>
<li>
<p>Reflect</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Apicurio Registry <code>AvroDatumProvider</code> is the abstraction on which type is then actually used, where <code>DefaultAvroDatumProvider</code> is used by default.</p>
</div>
<div class="paragraph">
<p>There are two configuration options you can set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apicurio.registry.avro-datum-provider</code> - provide a fully qualified Java class name of the <code>AvroDatumProvider</code> implementation, for example <code>io.apicurio.registry.utils.serde.avro.ReflectAvroDatumProvider</code></p>
</li>
<li>
<p><code>apicurio.registry.use-specific-avro-reader</code> - true or false, to use specific type when using <code>DefaultAvroDatumProvider</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Avro encoding</div>
<p>When using Apache Avro to serializer data, it is common to use the Avro binary encoding format. This is so that the data is encoded in as efficient a format as possible.  However, Avro also supports encoding the data as JSON. Encoding as JSON is useful because it is much easier to inspect the payload of each message, often for logging, debugging, or other similar use cases.  The Apicurio Registry Avro serializer can be configured to change the encoding to JSON from the default (binary).</p>
</div>
<div class="paragraph">
<p>Set the Avro encoding to use by configuring the <code>apicurio.avro.encoding</code> property. The value must be either
<code>JSON</code> or <code>BINARY</code>.</p>
</div>
<div class="paragraph">
<div class="title">Configure the Avro deserializer</div>
<p>You must configure the Avro deserializer class to match the configuration settings of the serializer.  As a
result, you can configure the Avro deserializer class in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apicurio Registry location as a URL</p>
</li>
<li>
<p>Global ID handler</p>
</li>
<li>
<p>Avro datum provider</p>
</li>
<li>
<p>Avro encoding</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the serializer section for these configuration options - the property names and values are the same.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following options are not needed when configuring the deserializer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Artifact ID strategy</p>
</li>
<li>
<p>Global ID strategy</p>
</li>
<li>
<p>Global ID location</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason these options are not necessary is that the deserializer class can figure this information out from
the message itself. In the case of the two strategies, they are not needed because the serializer is responsible for sending the global ID of the schema as part of the message.</p>
</div>
<div class="paragraph">
<p>The location of that global ID is determined by the deserializer by simply checking for the magic byte at the start of the message payload. If that byte is found, the global ID is read from the message payload using the configured handler.  If the magic byte is not found, the global ID is read from the message headers.</p>
</div>
</div>
<div class="sect2">
<h3 id="registry-serdes-types-json-registry"><a class="anchor" href="#registry-serdes-types-json-registry"></a>Configure JSON Schema SerDe with Apicurio Registry</h3>
<div class="paragraph">
<p>Apicurio Registry provides Kafka client serializer and deserializer classes for JSON Schema to make using JSON Schema as easy as possible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.apicurio.registry.utils.serde.JsonSchemaKafkaSerializer</code></p>
</li>
<li>
<p><code>io.apicurio.registry.utils.serde.JsonSchemaKafkaDeserializer</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike Apache Avro, JSON Schema is not actually a serialization technology - it is instead a validation
technology. As a result, configuration options for JSON Schema are quite different. For example, there is no
encoding option, because data is always encoded as JSON.</p>
</div>
<div class="paragraph">
<div class="title">Configure the JSON Schema serializer</div>
<p>You can configure the JSON Schema serializer class in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apicurio Registry location as a URL</p>
</li>
<li>
<p>Artifact ID strategy</p>
</li>
<li>
<p>Global ID strategy</p>
</li>
<li>
<p>Validation enabled/disabled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The only non-standard configuration property is whether JSON Schema validation is enabled or
disabled.  The validation feature is disabled by default but can be enabled by setting
<code>apicurio.registry.serdes.json-schema.validation-enabled</code> to <code>"true"</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>props.putIfAbsent(JsonSchemaSerDeConstants.REGISTRY_JSON_SCHEMA_VALIDATION_ENABLED, "true")`</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Configure the JSON Schema deserializer</div>
<p>You can configure the JSON Schema deserializer class in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apicurio Registry location as a URL</p>
</li>
<li>
<p>Validation enabled/disabled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The deserializer is simple to configure. You must provide the location of Apicurio Registry so that the schema can be loaded. The only other configuration is whether or not to perform validation.  These
configuration properties are the same as for the serializer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Deserializer validation only works if the serializer passes the global ID in the Kafka message, which will only happen when validation is enabled in the serializer.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="registry-serdes-types-protobuf-registry"><a class="anchor" href="#registry-serdes-types-protobuf-registry"></a>Configure Protobuf SerDe with Apicurio Registry</h3>
<div class="paragraph">
<p>Apicurio Registry provides Kafka client serializer and deserializer classes for Google Protobuf to make using Protobuf as easy as possible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.apicurio.registry.utils.serde.ProtobufKafkaSerializer</code></p>
</li>
<li>
<p><code>io.apicurio.registry.utils.serde.ProtobufKafkaDeserializer</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Configure the Protobuf serializer</div>
<p>You can configure the Protobuf serializer class in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apicurio Registry location as a URL</p>
</li>
<li>
<p>Artifact ID strategy</p>
</li>
<li>
<p>Global ID strategy</p>
</li>
<li>
<p>Global ID location</p>
</li>
<li>
<p>Global ID handler</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Configure the Protobuf deserializer</div>
<p>You must configure the Protobuf deserializer class to match the configuration settings of the serializer.  As a result, you can configure the Protobuf deserializer class in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apicurio Registry location as a URL</p>
</li>
<li>
<p>Global ID handler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the serializer section for these configuration options - the property names and values are the same.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following options are not needed when configuring the deserializer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Artifact ID strategy</p>
</li>
<li>
<p>Global ID strategy</p>
</li>
<li>
<p>Global ID location</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason these options are not necessary is that the deserializer class can figure this information out from
the message itself. In the case of the two strategies, they are not needed because the serializer is responsible for sending the global ID of the schema as part of the message.</p>
</div>
<div class="paragraph">
<p>The location of that global ID is determined (by the deserializer) by simply checking for the magic byte at the start of the message payload. If that byte is found, the global ID is read from the message payload (using the configured handler). If the magic byte is not found, the global ID is read from the message headers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Protobuf deserializer does not deserialize to your exact Protobuf Message implementation,
but rather to a <code>DynamicMessage</code> instance (because there is no appropriate API to do otherwise).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-register-registry"><a class="anchor" href="#registry-serdes-register-registry"></a>Registering a schema in Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you have defined a schema in the appropriate format, such as Apache Avro, you can add the schema to Apicurio Registry.</p>
</div>
<div class="paragraph">
<p>You can add the schema using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Apicurio Registry web console</p>
</li>
<li>
<p>A curl command using the Apicurio Registry API</p>
</li>
<li>
<p>A Maven plugin supplied with Apicurio Registry</p>
</li>
<li>
<p>Schema configuration added to your client code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Client applications cannot use Apicurio Registry until you have registered your schemas.</p>
</div>
<h3 id="_apicurio_registry_web_console" class="discrete">Apicurio Registry web console</h3>
<div class="paragraph">
<p>Having installed Apicurio Registry, you connect to the web console from the <code>ui</code> endpoint:</p>
</div>
<div class="paragraph">
<p><code>http://MY-REGISTRY-URL/ui</code></p>
</div>
<div class="paragraph">
<p>From the console, you can add, view and configure schemas.
You can also create the rules that prevent invalid content being added to the registry.</p>
</div>
<h3 id="_curl_command_example" class="discrete">Curl command example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">curl -X POST -H "Content-type: application/json; artifactType=AVRO" \
  -H "X-Registry-ArtifactId: prices-value" \
  --data '{ <i class="conum" data-value="1"></i><b>(1)</b>
      "type":"record",
      "name":"price",
      "namespace":"com.redhat",
      "fields":[{"name":"symbol","type":"string"},
      {"name":"price","type":"string"}]
    }'
  https://my-cluster-service-registry-myproject.example.com/api/artifacts -s <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Avro schema artifact.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>OpenShift route name that exposes Apicurio Registry.</td>
</tr>
</table>
</div>
<h3 id="_maven_plugin_example" class="discrete">Maven plugin example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
&lt;groupId&gt;io.apicurio&lt;/groupId&gt;
&lt;artifactId&gt;apicurio-registry-maven-plugin&lt;/artifactId&gt;
&lt;version&gt;${registry.version}&lt;/version&gt;
&lt;executions&gt;
  &lt;execution&gt;
    &lt;phase&gt;generate-sources&lt;/phase&gt;
    &lt;goals&gt;
      &lt;goal&gt;register&lt;/goal&gt;
    &lt;/goals&gt;
    &lt;configuration&gt;
      &lt;registryUrl&gt;https://my-cluster-service-registry-myproject.example.com/api&lt;/registryUrl&gt;
      &lt;artifactType&gt;AVRO&lt;/artifactType&gt;
      &lt;artifacts&gt;
        &lt;schema1&gt;${project.basedir}/schemas/schema1.avsc&lt;/schema1&gt;
      &lt;/artifacts&gt;
    &lt;/configuration&gt;
  &lt;/execution&gt;
&lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<h3 id="_configuration_using_a_producer_client_example" class="discrete">Configuration using a producer client example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl_node1 = PropertiesUtil.property(clientProperties, "registry.url.node1", <i class="conum" data-value="1"></i><b>(1)</b>
    "https://my-cluster-service-registry-myproject.example.com/api");
try (RegistryService service = RegistryClient.create(registryUrl_node1)) {
    String artifactId = ApplicationImpl.INPUT_TOPIC + "-value";
    try {
        service.getArtifactMetaData(artifactId); <i class="conum" data-value="2"></i><b>(2)</b>
    } catch (WebApplicationException e) {
        CompletionStage &lt;ArtifactMetaData&gt; csa = service.createArtifact(
            ArtifactType.AVRO,
            artifactId,
            new ByteArrayInputStream(LogInput.SCHEMA$.toString().getBytes())
        );
        csa.toCompletableFuture().get();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The properties are registered. You can register properties against more than one node.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Check to see if the schema already exists based on the artifact ID.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-config-consumer-registry"><a class="anchor" href="#registry-serdes-config-consumer-registry"></a>Using a schema from a Kafka consumer client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This procedure describes how to configure a Kafka consumer client written in Java to use a schema from Apicurio Registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry is installed</p>
</li>
<li>
<p>The schema is registered with Apicurio Registry</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the client with the URL of Apicurio Registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">String registryUrl = "https://registry.example.com/api";
Properties props = new Properties();
props.putIfAbsent(AbstractKafkaSerDe.REGISTRY_URL_CONFIG_PARAM, registryUrl);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the client with the Apicurio Registry deserializer. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Configure Kafka
props.putIfAbsent(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, SERVERS);
props.putIfAbsent(ConsumerConfig.GROUP_ID_CONFIG, "Consumer-" + TOPIC_NAME);
props.putIfAbsent(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, "true");
props.putIfAbsent(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, "1000");
props.putIfAbsent(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");
props.putIfAbsent(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG,
    AvroKafkaDeserializer.class.getName()); <i class="conum" data-value="1"></i><b>(1)</b>
props.putIfAbsent(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG,
    AvroKafkaDeserializer.class.getName()); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The deserializer provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The deserialization is in Apache Avro JSON format.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-config-producer-registry"><a class="anchor" href="#registry-serdes-config-producer-registry"></a>Using a schema from a Kafka producer client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This procedure describes how to configure a Kafka producer client written in Java to use a schema from Apicurio Registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry is installed</p>
</li>
<li>
<p>The schema is registered with Apicurio Registry</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the client with the URL of Apicurio Registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl = "https://registry.example.com/api";
Properties props = new Properties();
props.putIfAbsent(AbstractKafkaSerDe.REGISTRY_URL_CONFIG_PARAM, registryUrl);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the client with the serializer, and the strategy to look up the schema in Apicurio Registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">props.put(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG, "my-cluster-kafka-bootstrap:9092");
props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, AvroKafkaSerializer.class.getName()); <i class="conum" data-value="1"></i><b>(1)</b>
props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, AvroKafkaSerializer.class.getName()); <i class="conum" data-value="2"></i><b>(2)</b>
props.put(AbstractKafkaSerializer.REGISTRY_GLOBAL_ID_STRATEGY_CONFIG_PARAM, FindLatestIdStrategy.class.getName()); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The serializer for the message key provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The serializer for the message value provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Lookup strategy to find the global ID for the schema.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-config-stream-registry"><a class="anchor" href="#registry-serdes-config-stream-registry"></a>Using a schema from a Kafka Streams application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This procedure describes how to configure a Kafka Streams client written in Java to use a schema from Apicurio Registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry is installed</p>
</li>
<li>
<p>The schema is registered with Apicurio Registry</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create and configure a REST client with the Apicurio Registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">String registryUrl = "https://registry.example.com/api";
RegistryService client = RegistryClient.cached(registryUrl);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the serializer, deserializer, and create the Kafka Streams client. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Serializer&lt;LogInput&gt; serializer = new AvroKafkaSerializer&lt;&gt;( <i class="conum" data-value="1"></i><b>(1)</b>
    client,
    new DefaultAvroDatumProvider&lt;LogInput&gt;().setUseSpecificAvroReader(true)
);
Deserializer&lt;LogInput&gt; deserializer = new AvroKafkaDeserializer &lt;&gt; ( <i class="conum" data-value="2"></i><b>(2)</b>
    client,
    new DefaultAvroDatumProvider&lt;LogInput&gt;().setUseSpecificAvroReader(true)
);
Serde&lt;LogInput&gt; logSerde = Serdes.serdeFrom( <i class="conum" data-value="3"></i><b>(3)</b>
    serializer,
    deserializer
);
KStream&lt;String, LogInput&gt; input = builder.stream( <i class="conum" data-value="4"></i><b>(4)</b>
    INPUT_TOPIC,
    Consumed.with(Serdes.String(), logSerde)
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The serializer provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The deserializer provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The deserialization is in Apache Avro format.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The Kafka Streams client application.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright © 2023 Red Hat, Inc. All rights reserved.</p>
</footer>
<script src="../../../assets/js/site.js"></script>
<script src="../../../assets/js/vendor/lunr.js"></script>
<script src="../../../assets/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/apicurio-registry/1.3.3.Final/getting-started/assembly-using-kafka-client-serdes.html"></script>
<script async src="../../../assets/../search-index.js"></script>
<script async src="../../../assets/js/vendor/highlight.js"></script>
  </body>
</html>
