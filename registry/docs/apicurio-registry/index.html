<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting Started with Apicurio Registry :: Apicurio Registry</title>
    <link rel="canonical" href="https://www.apicur.io/registry/docs/apicurio-registry/index.html">
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="../assets/css/site.css">
    <link rel="stylesheet" href="https://www.apicur.io/css/rhbar.css">
    <link rel="shortcut icon" href="https://www.apicur.io/images/favicon.ico" type="image/x-icon" integrity="sha384-if9KH+NQ2dMhdrWu+INnJTcvG6riRakUAnbhecX5a7voubrapo7ouFGS+GYZ/N4P" crossorigin="anonymous"/>
  </head>
  <body class="article">
<div id="rhbar">
    <a class="jbdevlogo" href="https://www.jboss.org/projects/about" rel="nofollow" target="_blank"></a>
    <a class="rhlogo" href="https://www.redhat.com/" rel="nofollow" target="_blank"></a>
</div>
<div class="masthead-header">

    <a href="" target="_blank" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    </a>

    <div class="masthead-logo"></div>
    <div class="masthead-brand"><a href="/">Apicurio Studio</a></div>
    <div class="masthead-menu">
        <ul>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </div>
</div>
<div class="body">
<div class="nav-container" data-component="apicurio-registry" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Apicurio Registry</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="index.html"> Getting Started</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apicurio Registry</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apicurio Registry</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link is-current"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Apicurio Registry</a></li>
    <li><a href="index.html"> Getting Started</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///work/apicurio-registry/.antora/modules/ROOT/pages/index.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Getting Started with Apicurio Registry</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#intro-to-the-registry">1. Introduction to Apicurio Registry</a>
<ul class="sectlevel2">
<li><a href="#registry-overview">1.1. Apicurio Registry overview</a></li>
<li><a href="#registry-artifacts">1.2. Apicurio Registry artifacts</a></li>
<li><a href="#registry-web-console">1.3. Apicurio Registry web console</a></li>
<li><a href="#registry-rest-api">1.4. Registry REST API</a></li>
<li><a href="#registry-storage">1.5. Storage options</a></li>
<li><a href="#client-serde">1.6. Kafka client serializers/deserializers</a></li>
<li><a href="#kafka-connect">1.7. Kafka Connect converters</a></li>
<li><a href="#registry-demo">1.8. Registry demonstration examples</a></li>
<li><a href="#registry-distros">1.9. Available distributions</a></li>
</ul>
</li>
<li><a href="#intro-to-registry-rules">2. Introduction to Apicurio Registry rules</a>
<ul class="sectlevel2">
<li><a href="#registry-rules">2.1. Rules for registry content</a></li>
<li><a href="#registry-rules-apply">2.2. When rules are applied</a></li>
<li><a href="#registry-rules-work">2.3. How rules work</a></li>
</ul>
</li>
<li><a href="#installing-the-registry-docker">3. Installing Apicurio Registry using Docker</a>
<ul class="sectlevel2">
<li><a href="#installing-registry-in-memory-storage">3.1. Installing Apicurio Registry with in-memory storage</a></li>
<li><a href="#installing-registry-jpa-storage">3.2. Installing Apicurio Registry with JPA storage</a></li>
<li><a href="#installing-registry-infinispan-storage">3.3. Installing Apicurio Registry with embedded Infinispan storage</a></li>
<li><a href="#installing-registry-kafka-storage">3.4. Installing Apicurio Registry with Apache Kafka storage</a></li>
<li><a href="#installing-registry-kafka-streams-storage">3.5. Installing Apicurio Registry with Apache Kafka Streams storage</a></li>
</ul>
</li>
<li><a href="#installing-the-registry">4. Installing Apicurio Registry on OpenShift</a>
<ul class="sectlevel2">
<li><a href="#installing-registry-operatorhub">4.1. Installing Apicurio Registry from the OpenShift OperatorHub</a></li>
<li><a href="#installing-kafka-streams-operatorhub">4.2. Installing Strimzi from the OpenShift OperatorHub</a></li>
<li><a href="#setting-up-kafka-streams-storage">4.3. Configuring Apicurio Registry with Strimzi storage on OpenShift</a></li>
<li><a href="#setting-up-infinispan-storage">4.4. Configuring Apicurio Registry with embedded Infinispan storage on OpenShift</a></li>
<li><a href="#installing-postgresql-operatorhub">4.5. Installing a PostgreSQL database from the OpenShift OperatorHub</a></li>
<li><a href="#setting-up-postgresql-storage">4.6. Configuring Apicurio Registry with PostgreSQL database storage on OpenShift</a></li>
</ul>
</li>
<li><a href="#configuring-the-registry">5. Configuring Apicurio Registry on OpenShift</a>
<ul class="sectlevel2">
<li><a href="#configuring-liveness-readiness-probes">5.1. Configuring Apicurio Registry health checks on OpenShift</a></li>
<li><a href="#registry-liveness-env-vars">5.2. Environment variables for Apicurio Registry health checks</a></li>
</ul>
</li>
<li><a href="#managing-registry-artifacts-ui">6. Managing Apicurio Registry content using the web console</a>
<ul class="sectlevel2">
<li><a href="#adding-artifacts-using-console">6.1. Adding artifacts using the Apicurio Registry web console</a></li>
<li><a href="#browsing-artifacts-using-console">6.2. Viewing artifacts using the Apicurio Registry web console</a></li>
<li><a href="#configuring-rules-using-console">6.3. Configuring content rules using the Apicurio Registry web console</a></li>
</ul>
</li>
<li><a href="#managing-registry-artifacts-api">7. Managing Apicurio Registry content using the REST API</a>
<ul class="sectlevel2">
<li><a href="#managing-artifacts-using-rest-api">7.1. Managing artifacts using Registry REST API commands</a></li>
<li><a href="#managing-artifacts-using-maven-plugin">7.2. Managing artifacts using the Apicurio Registry Maven plug-in</a></li>
<li><a href="#managing-artifacts-using-client-code">7.3. Managing artifacts using a Apicurio Registry client application</a></li>
</ul>
</li>
<li><a href="#artifact-and-rule-types">8. Apicurio Registry reference</a>
<ul class="sectlevel2">
<li><a href="#registry-artifact-types">8.1. Apicurio Registry artifact types</a></li>
<li><a href="#registry-rule-types">8.2. Apicurio Registry content rule types</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="intro-to-the-registry"><a class="anchor" href="#intro-to-the-registry"></a>1. Introduction to Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces Apicurio Registry concepts and features and provides details on the supported artifact types that are stored in the registry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-overview">Apicurio Registry overview</a></p>
</li>
<li>
<p><a href="#registry-artifacts">Apicurio Registry artifacts</a></p>
</li>
<li>
<p><a href="#registry-web-console">Apicurio Registry web console</a></p>
</li>
<li>
<p><a href="#registry-rest-api">Registry REST API</a></p>
</li>
<li>
<p><a href="#registry-storage">Storage options</a></p>
</li>
<li>
<p><a href="#client-serde">Kafka client serializers/deserializers</a></p>
</li>
<li>
<p><a href="#kafka-connect">Kafka Connect converters</a></p>
</li>
<li>
<p><a href="#registry-demo">Registry demonstration examples</a></p>
</li>
<li>
<p><a href="#registry-distros">Available distributions</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="registry-overview"><a class="anchor" href="#registry-overview"></a>1.1. Apicurio Registry overview</h3>
<div class="paragraph">
<p>Apicurio Registry is a datastore for sharing standard event schemas and API designs across API and event-driven architectures. You can use Apicurio Registry to decouple the structure of your data from your client applications, and to share and manage your data types and API descriptions at runtime using a REST interface.</p>
</div>
<div class="paragraph">
<p>For example, client applications can dynamically push or pull the latest schema updates to or from Apicurio Registry at runtime without needing to redeploy. Developer teams can query the registry for existing schemas required for services already deployed in production, and can register new schemas required for new services in development.</p>
</div>
<div class="paragraph">
<p>You can enable client applications to use schemas and API designs stored in Apicurio Registry by specifying the registry URL in your client application code. For example, the registry can store schemas used to serialize and deserialize messages, which can then be referenced from your client applications to ensure that the messages that they send and receive are compatible with those schemas.</p>
</div>
<div class="paragraph">
<p>Using Apicurio Registry to decouple your data structure from your applications reduces costs by decreasing overall message size, and creates efficiencies by increasing consistent reuse of schemas and API designs across your organization.
Apicurio Registry provides a web console to make it easy for developers and administrators to manage registry content.</p>
</div>
<div class="paragraph">
<p>In addition, you can configure optional rules to govern the evolution of your registry content. For example, these include rules to ensure that uploaded content is syntactically and semantically valid, or is backwards and forwards compatible with other versions. Any configured rules must pass before new versions can be uploaded to the registry, which ensures that time is not wasted on invalid or incompatible schemas or API designs.</p>
</div>
<h4 id="_apicurio_registry_features" class="discrete">Apicurio Registry features</h4>
<div class="paragraph">
<p>Apicurio Registry provides the following main features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for multiple payload formats for standard event schemas and API specifications</p>
</li>
<li>
<p>Pluggable storage options including Apache Kafka, embedded Infinispan, or PostgreSQL database</p>
</li>
<li>
<p>Registry content management using a web console, REST API command, Maven plug-in, or Java client</p>
</li>
<li>
<p>Rules for content validation and version compatibility to govern how registry content evolves over time</p>
</li>
<li>
<p>Full Apache Kafka schema registry support, including integration with Kafka Connect for external systems</p>
</li>
<li>
<p>Client serializers/deserializers (Serdes) to validate Kafka and other message types at runtime</p>
</li>
<li>
<p>Cloud-native Quarkus Java runtime for low memory footprint and fast deployment times</p>
</li>
<li>
<p>Compatibility with existing Confluent schema registry client applications</p>
</li>
<li>
<p>Operator-based installation of Apicurio Registry on OpenShift</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="registry-artifacts"><a class="anchor" href="#registry-artifacts"></a>1.2. Apicurio Registry artifacts</h3>
<div class="paragraph">
<p>The items stored in Apicurio Registry, such as event schemas and API specifications, are known as registry <em>artifacts</em>. The following shows an example of an Apache Avro schema artifact in JSON format for a simple share price application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "type": "record",
   "name": "price",
   "namespace": "com.example",
   "fields": [
       {
           "name": "symbol",
           "type": "string"
       },
       {
           "name": "price",
           "type": "string"
       }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a schema or API contract is added as an artifact in the registry, client applications can then use that schema or API contract to validate that client messages conform to the correct data structure at runtime.</p>
</div>
<div class="paragraph">
<p>Apicurio Registry supports a wide range of message payload formats for standard event schemas and API specifications. For example, supported formats include Apache Avro, Google protocol buffers, GraphQL, AsyncAPI, OpenAPI, and others. For more details, see <a href="#registry-artifact-types">Apicurio Registry artifact types</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="registry-web-console"><a class="anchor" href="#registry-web-console"></a>1.3. Apicurio Registry web console</h3>
<div class="paragraph">
<p>You can use the Apicurio Registry web console to browse and search the artifacts stored in the registry, and to upload new artifacts and artifact versions. You can search for artifacts by label, name, and description. You can also view an artifactâ€™s content, view all of its available versions, or download an artifact file locally.</p>
</div>
<div class="paragraph">
<p>You can also use the Apicurio Registry web console to configure optional rules for registry content, both globally and for each artifact. These optional rules for content validation and compatibility are applied when new artifacts or artifact versions are uploaded to the registry. For more details, see <a href="#registry-rules">Rules for registry content</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets-images/images/getting-started/registry-web-console.png" alt="Apicurio Registry web console">
</div>
<div class="title">Figure 1. Apicurio Registry web console</div>
</div>
<div class="paragraph">
<p>The Apicurio Registry web console is available from the main endpoint of your Apicurio Registry deployment, for example, on  <code>http://MY-REGISTRY-URL/ui</code>. For more details, see <a href="#managing-registry-artifacts-ui">Managing Apicurio Registry content using the web console</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="registry-rest-api"><a class="anchor" href="#registry-rest-api"></a>1.4. Registry REST API</h3>
<div class="paragraph">
<p>Using the Registry REST API, client applications can manage the artifacts in Apicurio Registry. This API provides create, read, update, and delete operations for:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Artifacts</dt>
<dd>
<p>Manage the schema and API design artifacts stored in the registry. This also includes browse or search for artifacts, for example, by name, ID, description, or label. You can also manage the lifecycle state of an artifact: enabled, disabled, or deprecated.</p>
</dd>
<dt class="hdlist1">Artifact versions</dt>
<dd>
<p>Manage the versions that are created when artifact content is updated. This also includes browse or search for versions, for example, by name, ID, description, or label. You can also manage the lifecycle state of a version: enabled, disabled, or deprecated.</p>
</dd>
<dt class="hdlist1">Artifact metadata</dt>
<dd>
<p>Manage details about artifacts such as when an artifact was created or modified, its current state, and so on. Users can edit some metadata, and some is read-only. For example, editable metadata includes artifact name, description, or label, but when the artifact was created and modified are read-only.</p>
</dd>
<dt class="hdlist1">Global rules</dt>
<dd>
<p>Configure rules to govern the content evolution of all artifacts to prevent invalid or incompatible content from being added to the registry. Global rules are applied only if an artifact does not have its own specific artifact rules configured.</p>
</dd>
<dt class="hdlist1">Artifact rules</dt>
<dd>
<p>Configure rules to govern the content evolution of a specific artifact to prevent invalid or incompatible content from being added to the registry. Artifact rules override any global rules configured.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Compatibility with other schema registries</div>
<p>The Registry REST API is compatible with the Confluent schema registry REST API, which includes support for Apache Avro, Google Protocol buffers, and JSON Schema artifact types. Applications using Confluent client libraries can use Apicurio Registry as a drop-in replacement instead.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For detailed information, see the <a href="files/registry-rest-api.htm">Apicurio Registry REST API documentation</a>.</p>
</li>
<li>
<p>The Registry REST API documentation is also available from the main endpoint of your Apicurio Registry deployment, for example, on <code>http://MY-REGISTRY-URL/api</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="registry-storage"><a class="anchor" href="#registry-storage"></a>1.5. Storage options</h3>
<div class="paragraph">
<p>Apicurio Registry provides the following underlying storage implementations for registry artifacts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In-memory</p>
</li>
<li>
<p>Java Persistence API</p>
</li>
<li>
<p>Apache Kafka</p>
</li>
<li>
<p>Apache Kafka Streams</p>
</li>
<li>
<p>Embedded Infinispan cache</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The in-memory storage option is suitable for a development environment only. All data is lost when restarting this storage implementation. All other storage options are suitable for development and production environments.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For details on how to install into your preferred storage option, see <a href="#installing-the-registry">Installing Apicurio Registry on OpenShift</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="client-serde"><a class="anchor" href="#client-serde"></a>1.6. Kafka client serializers/deserializers</h3>
<div class="paragraph">
<p>Kafka producer applications can use serializers to encode messages that conform to a specific event schema. Kafka consumer applications can then use deserializers to validate that messages have been serialized using the correct schema, based on a specific schema ID.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets-images/images/getting-started/registry-serdes-architecture.png" alt="Registry Serdes architecture">
</div>
<div class="title">Figure 2. Apicurio Registry and Kafka client serializer/deserializer architecture</div>
</div>
<div class="paragraph">
<p>Apicurio Registry provides Kafka client serializers/deserializers (Serdes) to validate the following message types at runtime:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Avro</p>
</li>
<li>
<p>Google protocol buffers</p>
</li>
<li>
<p>JSON Schema</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Apicurio Registry Maven repository and source code distributions include the Kafka serializer/deserializer implementations for these message types, which Kafka client developers can use to integrate with the registry. These implementations include custom <code>io.apicurio.registry.utils.serde</code> Java classes for each supported message type, which client applications can use to pull schemas from the registry at runtime for validation.</p>
</div>
</div>
<div class="sect2">
<h3 id="kafka-connect"><a class="anchor" href="#kafka-connect"></a>1.7. Kafka Connect converters</h3>
<div class="paragraph">
<p>You can use Apicurio Registry with Apache Kafka Connect to stream data between Kafka and external systems. Using Kafka Connect, you can define connectors for different systems to move large volumes of data into and out of Kafka-based systems.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets-images/images/getting-started/registry-connect-architecture.png" alt="Registry and Kafka Connect architecture">
</div>
<div class="title">Figure 3. Apicurio Registry and Kafka Connect architecture</div>
</div>
<div class="paragraph">
<p>Apicurio Registry provides the following features for Kafka Connect:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Storage for Kafka Connect schemas</p>
</li>
<li>
<p>Kafka Connect converters for Apache Avro and JSON Schema</p>
</li>
<li>
<p>Registry REST API to manage schemas</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the Avro and JSON Schema converters to map Kafka Connect schemas into Avro or JSON schemas. Those schemas can then serialize message keys and values into the compact Avro binary format or human-readable JSON format. The converted JSON is also less verbose because the messages do not contain the schema information, only the schema ID.</p>
</div>
<div class="paragraph">
<p>Apicurio Registry can manage and track the Avro and JSON schemas used in the Kafka topics. Because the schemas are stored in Apicurio Registry and decoupled from the message content, each message must only include a tiny schema identifier. For an I/O bound system like Kafka, this means more total throughput for producers and consumers.</p>
</div>
<div class="paragraph">
<p>The Avro and JSON Schema serializers and deserializers (Serdes) provided by Apicurio Registry are also used by Kafka producers and consumers in this use case. Kafka consumer applications that you write to consume change events can use the Avro or JSON Serdes to deserialize these change events. You can install these Serdes into any Kafka-based system and use them along with Kafka Connect, or with Kafka Connect-based systems such as Debezium and Camel Kafka Connector.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kafka.apache.org/documentation/#connect">Apache Kafka Connect documentation</a></p>
</li>
<li>
<p><a href="https://debezium.io/blog/2020/04/09/using-debezium-wit-apicurio-api-schema-registry/">Demonstration of using Kakfa Connect with Debezium and Apicurio Registry</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="registry-demo"><a class="anchor" href="#registry-demo"></a>1.8. Registry demonstration examples</h3>
<div class="paragraph">
<p>Apicurio Registry provides an open source demonstration example of Apache Avro serialization/deserialization with storage in Apache Kafka Streams. This example shows how the serializer/deserializer obtains the Avro schema from the registry at runtime and uses it to serialize and deserialize Kafka messages. For more details, see <a href="https://github.com/Apicurio/apicurio-registry-demo" class="bare">https://github.com/Apicurio/apicurio-registry-demo</a>.</p>
</div>
<div class="paragraph">
<p>This demonstration also provides simple examples of both
<a href="https://github.com/Apicurio/apicurio-registry-demo/tree/master/src/main/java/io/apicurio/registry/demo/simple">Avro and JSON Schema serialization/deserialization with storage in Apache Kafka</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="registry-distros"><a class="anchor" href="#registry-distros"></a>1.9. Available distributions</h3>
<div class="paragraph">
<p>Apicurio Registry includes the following distributions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Apicurio Registry images</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Distribution option</th>
<th class="tableblock halign-left valign-top">Container Image</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In-memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://hub.docker.com/r/apicurio/apicurio-registry-mem" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-mem</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Persistence API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://hub.docker.com/r/apicurio/apicurio-registry-jpa" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-jpa</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://hub.docker.com/r/apicurio/apicurio-registry-kafka" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-kafka</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Kafka Streams</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://hub.docker.com/r/apicurio/apicurio-registry-streams" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-streams</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://hub.docker.com/r/apicurio/apicurio-registry-infinispan" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-infinispan</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apicurio Registry Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://hub.docker.com/r/apicurio/apicurio-registry-operator" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-operator</a></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For details on building from source code and running Docker images, see <a href="https://github.com/Apicurio/apicurio-registry" class="bare">https://github.com/Apicurio/apicurio-registry</a></p>
</li>
<li>
<p>For details on using the Operator to deploy, see <a href="https://github.com/Apicurio/apicurio-registry-operator" class="bare">https://github.com/Apicurio/apicurio-registry-operator</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intro-to-registry-rules"><a class="anchor" href="#intro-to-registry-rules"></a>2. Introduction to Apicurio Registry rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces the optional rules used to govern registry content and provides details on the available rule types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-rules">Rules for registry content</a></p>
</li>
<li>
<p><a href="#registry-rules-apply">When rules are applied</a></p>
</li>
<li>
<p><a href="#registry-rules-work">How rules work</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="registry-rules"><a class="anchor" href="#registry-rules"></a>2.1. Rules for registry content</h3>
<div class="paragraph">
<p>To govern the evolution of registry content, you can configure optional rules for artifact content added to the registry. All configured global rules or artifact rules must pass before a new artifact version can be uploaded to the registry. Configured artifact rules override any configured global rules.</p>
</div>
<div class="paragraph">
<p>The goal of these rules is to prevent invalid content from being added to the registry. For example, content can be invalid for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invalid syntax for a given artifact type (for example, <code>AVRO</code> or <code>PROTOBUF</code>)</p>
</li>
<li>
<p>Valid syntax, but semantics violate a specification</p>
</li>
<li>
<p>Incompatibility, when new content includes breaking changes relative to the current artifact version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can add these optional content rules using the Apicurio Registry web console, REST API commands, or a Java client application.</p>
</div>
</div>
<div class="sect2">
<h3 id="registry-rules-apply"><a class="anchor" href="#registry-rules-apply"></a>2.2. When rules are applied</h3>
<div class="paragraph">
<p>Rules are applied only when content is added to the registry. This includes the following REST operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding an artifact</p>
</li>
<li>
<p>Updating an artifact</p>
</li>
<li>
<p>Adding an artifact version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a rule is violated, Apicurio Registry returns an HTTP error. The response body includes the violated rule and a message showing what went wrong.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no rules are configured for an artifact, the set of currently configured global rules are applied, if any.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="registry-rules-work"><a class="anchor" href="#registry-rules-work"></a>2.3. How rules work</h3>
<div class="paragraph">
<p>Each rule has a name and optional configuration information. The registry storage maintains the list of rules for each artifact and the list of global rules. Each rule in the list consists of a name and a set of configuration properties, which are specific to the rule implementation.</p>
</div>
<div class="paragraph">
<p>A rule is provided with the content of the current version of the artifact (if one exists) and the new version of the artifact being added. The rule implementation returns true or false depending on whether the artifact passes the rule. If not, the registry reports the reason why in an HTTP error response. Some rules might not use the previous version of the content. For example, compatibility rules use previous versions, but syntax or semantic validity rules do not.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more details, see <a href="#registry-rule-types">Apicurio Registry content rule types</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-the-registry-docker"><a class="anchor" href="#installing-the-registry-docker"></a>3. Installing Apicurio Registry using Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to install and run Apicurio Registry using Docker with the following storage options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#installing-registry-in-memory-storage">Installing Apicurio Registry with in-memory storage</a></p>
</li>
<li>
<p><a href="#installing-registry-jpa-storage">Installing Apicurio Registry with JPA storage</a></p>
</li>
<li>
<p><a href="#installing-registry-infinispan-storage">Installing Apicurio Registry with embedded Infinispan storage</a></p>
</li>
<li>
<p><a href="#installing-registry-kafka-storage">Installing Apicurio Registry with Apache Kafka storage</a></p>
</li>
<li>
<p><a href="#installing-registry-kafka-streams-storage">Installing Apicurio Registry with Apache Kafka Streams storage</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#registry-overview">Apicurio Registry overview</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can install more than one instance of Apicurio Registry depending on your environment. The number of instances depends on your storage option, for example, your Kafka, Infinispan, or database cluster configuration, and on the number and type of artifacts stored in Apicurio Registry.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For details on building from source, see <a href="https://github.com/Apicurio/apicurio-registry" class="bare">https://github.com/Apicurio/apicurio-registry</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="installing-registry-in-memory-storage"><a class="anchor" href="#installing-registry-in-memory-storage"></a>3.1. Installing Apicurio Registry with in-memory storage</h3>
<div class="paragraph">
<p>This section explains how to install and run Apicurio Registry with simple in-memory storage from a container image.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The in-memory storage option is suitable for development only. All data is lost when the container image is restarted.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have Docker installed and the Docker daemon running.</p>
</li>
<li>
<p>Ensure that you can connect to the container repository: <a href="https://hub.docker.com/r/apicurio/apicurio-registry-mem" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-mem</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get the Apicurio Registry container image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker pull apicurio/apicurio-registry-mem</code></pre>
</div>
</div>
</li>
<li>
<p>Run the container image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -it -p 8080:8080 apicurio/apicurio-registry-mem:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Send a test request using the Apicurio Registry REST API. For example, enter the following <code>curl</code> command to create a simple Avro schema artifact for a share price application in the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST -H "Content-type: application/json; artifactType=AVRO" -H "X-Registry-ArtifactId: share-price" --data '{"type":"record","name":"price","namespace":"com.example","fields":[{"name":"symbol","type":"string"},{"name":"price","type":"string"}]}' http://localhost:8080/api/artifacts</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the response includes the expected JSON body to confirm that the Avro schema artifact was created in the registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"createdOn":1578310374517,"modifiedOn":1578310374517,"id":"share-price","version":1,"type":"AVRO","globalId":8}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more REST API sample requests, see the <a href="files/registry-rest-api.htm">Registry REST API documentation</a>.</p>
</li>
<li>
<p>For a demonstration based on Kafka Streams storage, see <a href="https://github.com/Apicurio/apicurio-registry-demo" class="bare">https://github.com/Apicurio/apicurio-registry-demo</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installing-registry-jpa-storage"><a class="anchor" href="#installing-registry-jpa-storage"></a>3.2. Installing Apicurio Registry with JPA storage</h3>
<div class="paragraph">
<p>This section explains how to install and run Apicurio Registry with Java Persistence API storage from a container image. This storage option is suitable for production environments.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have Docker installed and the Docker daemon running.</p>
</li>
<li>
<p>Ensure that you can connect to the container repository: <a href="https://hub.docker.com/r/apicurio/apicurio-registry-jpa" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-jpa</a>.</p>
</li>
<li>
<p>You must already have a PostgreSQL database server installed and running. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ postgres -D /usr/local/pgsql/data</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://www.postgresql.org/docs/12/server-start.html" class="bare">https://www.postgresql.org/docs/12/server-start.html</a></p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get the Apicurio Registry container image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker pull apicurio/apicurio-registry-jpa</code></pre>
</div>
</div>
</li>
<li>
<p>Run the container image and specify the database connection URL and credentials for the PostgreSQL server as environment variables:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -it -p 8080:8080 \
-e "QUARKUS_DATASOURCE_URL=jdbc:postgresql://postgres/apicurio-registry" \
-e "QUARKUS_DATASOURCE_USERNAME=apicurio-registry" \
-e "QUARKUS_DATASOURCE_PASSWORD=password" \
apicurio/apicurio-registry-jpa:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Send a test request using the Apicurio Registry REST API. For example, enter the following <code>curl</code> command to create a simple Avro schema artifact for a share price application in the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST -H "Content-type: application/json; artifactType=AVRO" -H "X-Registry-ArtifactId: share-price" --data '{"type":"record","name":"price","namespace":"com.example","fields":[{"name":"symbol","type":"string"},{"name":"price","type":"string"}]}' http://localhost:8080/api/artifacts</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the response includes the expected JSON body to confirm that the Avro schema artifact was created in the registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"createdOn":1578310374517,"modifiedOn":1578310374517,"id":"share-price","version":1,"type":"AVRO","globalId":8}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more REST API sample requests, see the <a href="files/registry-rest-api.htm">Registry REST API documentation</a>.</p>
</li>
<li>
<p>For more details on PostgreSQL, see the <a href="https://www.postgresql.org/docs/12/index.html">PostgreSQL documentation</a>.</p>
</li>
<li>
<p>For a demonstration based on Kafka Streams storage, see <a href="https://github.com/Apicurio/apicurio-registry-demo" class="bare">https://github.com/Apicurio/apicurio-registry-demo</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installing-registry-infinispan-storage"><a class="anchor" href="#installing-registry-infinispan-storage"></a>3.3. Installing Apicurio Registry with embedded Infinispan storage</h3>
<div class="paragraph">
<p>This section explains how to install and run Apicurio Registry with embedded Infinispan storage from a container image. This storage option is based on Infinispan community Java libraries embedded in the Quarkus-based Apicurio Registry server. You do not need to install a separate Infinispan server using this storage option.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default embedded Infinispan storage is suitable for development only. If you do not configure an Infinispan cluster, all data is lost when the container image is restarted. For more details on Infinispan, see the <a href="https://infinispan.org/documentation/">Infinispan documentation</a>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have Docker installed and the Docker daemon running.</p>
</li>
<li>
<p>Ensure that you can connect to the container repository: <a href="https://hub.docker.com/r/apicurio/apicurio-registry-mem" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-mem</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get the Apicurio Registry container image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker pull apicurio/apicurio-registry-infinispan:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Run the container image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -it -p 8080:8080 apicurio/apicurio-registry-infinispan:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Send a test request using the Apicurio Registry REST API. For example, enter the following <code>curl</code> command to create a simple Avro schema artifact for a share price application in the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST -H "Content-type: application/json; artifactType=AVRO" -H "X-Registry-ArtifactId: share-price" --data '{"type":"record","name":"price","namespace":"com.example","fields":[{"name":"symbol","type":"string"},{"name":"price","type":"string"}]}' http://localhost:8080/api/artifacts</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the response includes the expected JSON body to confirm that the Avro schema artifact was created in the registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"createdOn":1578310374517,"modifiedOn":1578310374517,"id":"share-price","version":1,"type":"AVRO","globalId":8}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more REST API sample requests, see the <a href="files/registry-rest-api.htm">Registry REST API documentation</a>.</p>
</li>
<li>
<p>For more details on Infinispan, see <a href="https://infinispan.org/" class="bare">https://infinispan.org/</a>.</p>
</li>
<li>
<p>For a demonstration based on Kafka Streams storage, see <a href="https://github.com/Apicurio/apicurio-registry-demo" class="bare">https://github.com/Apicurio/apicurio-registry-demo</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installing-registry-kafka-storage"><a class="anchor" href="#installing-registry-kafka-storage"></a>3.4. Installing Apicurio Registry with Apache Kafka storage</h3>
<div class="paragraph">
<p>This topic explains how to install and run Apicurio Registry with Kafka storage from a container image. This storage option is suitable for production environments.</p>
</div>
<div class="paragraph">
<p>The following Kafka-based systems are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Kafka 2.2.x</p>
</li>
<li>
<p>Apache Kafka 2.3</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have Docker installed and the Docker daemon running.</p>
</li>
<li>
<p>Ensure that you can connect to the container repository: <a href="https://hub.docker.com/r/apicurio/apicurio-registry-kafka" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-kafka</a>.</p>
</li>
<li>
<p>Ensure that <code>KAFKA_HOME</code> is set to the location of your Kafka-based system.</p>
</li>
<li>
<p>You must already have your Kafka broker running. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$KAFKA_HOME/bin/zookeeper-server-start.sh $KAFKA_HOME/config/zookeeper.properties &amp;
$KAFKA_HOME/bin/kafka-server-start.sh $KAFKA_HOME/config/server.properties &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://kafka.apache.org/quickstart" class="bare">https://kafka.apache.org/quickstart</a>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get the Apicurio Registry container image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker pull apicurio/apicurio-registry-kafka</code></pre>
</div>
</div>
</li>
<li>
<p>Run the container image and specify the following environment variable for your Kafka system:</p>
<div class="ulist">
<ul>
<li>
<p><code>KAFKA_BOOTSTRAP_SERVERS</code> - The address(es) of your Kafka broker(s).</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -it -p 8080:8080 -e "KAFKA_BOOTSTRAP_SERVERS=kafka:9092" apicurio/apicurio-registry-kafka:latest</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Send a test request using the Apicurio Registry REST API. For example, enter the following <code>curl</code> command to create a simple Avro schema artifact for a share price application in the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST -H "Content-type: application/json; artifactType=AVRO" -H "X-Registry-ArtifactId: share-price" --data '{"type":"record","name":"price","namespace":"com.example","fields":[{"name":"symbol","type":"string"},{"name":"price","type":"string"}]}' http://localhost:8080/api/artifacts</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the response includes the expected JSON body to confirm that the Avro schema artifact was created in the registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"createdOn":1578310374517,"modifiedOn":1578310374517,"id":"share-price","version":1,"type":"AVRO","globalId":8}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more REST API sample requests, see the <a href="files/registry-rest-api.htm">Registry REST API documentation</a>.</p>
</li>
<li>
<p>For a demonstration based on Kafka Streams storage, see <a href="https://github.com/Apicurio/apicurio-registry-demo" class="bare">https://github.com/Apicurio/apicurio-registry-demo</a>.</p>
</li>
<li>
<p>For more details on Apache Kafka, see <a href="https://kafka.apache.org/documentation/" class="bare">https://kafka.apache.org/documentation/</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installing-registry-kafka-streams-storage"><a class="anchor" href="#installing-registry-kafka-streams-storage"></a>3.5. Installing Apicurio Registry with Apache Kafka Streams storage</h3>
<div class="paragraph">
<p>This topic explains how to install and run Apicurio Registry with Kafka Streams storage from a container image. This storage option is suitable for production environments.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have Docker installed and the Docker daemon running.</p>
</li>
<li>
<p>Ensure that you can connect to the container repository: <a href="https://hub.docker.com/r/apicurio/apicurio-registry-streams" class="bare">https://hub.docker.com/r/apicurio/apicurio-registry-streams</a>.</p>
</li>
<li>
<p>Ensure that <code>KAFKA_HOME</code> is set to the location of your Kafka-based system.</p>
</li>
<li>
<p>You must already have a Kafka broker running. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$KAFKA_HOME/bin/zookeeper-server-start.sh $KAFKA_HOME/config/zookeeper.properties &amp;
$KAFKA_HOME/bin/kafka-server-start.sh $KAFKA_HOME/config/server.properties &amp;</code></pre>
</div>
</div>
</li>
<li>
<p>You must have created the following topics for Kafka Streams storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$KAFKA_HOME/bin/kafka-topics.sh --zookeeper localhost --create --topic storage-topic --partitions 1 --replication-factor 1  --config cleanup.policy=compact
$KAFKA_HOME/bin/kafka-topics.sh --zookeeper localhost --create --topic global-id-topic --partitions 1 --replication-factor 1 --config cleanup.policy=compact</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://kafka.apache.org/quickstart" class="bare">https://kafka.apache.org/quickstart</a>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get the Apicurio Registry container image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker pull apicurio/apicurio-registry-kafka-streams</code></pre>
</div>
</div>
</li>
<li>
<p>Run the container image and specify the following environment variables for your Kafka system:</p>
<div class="ulist">
<ul>
<li>
<p><code>KAFKA_BOOTSTRAP_SERVERS</code> - The address(es) of your Kafka broker(s).</p>
</li>
<li>
<p><code>APPLICATION_ID</code> - The name of your Kafka Streams application.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker run -it -p 8080:8080 -e "KAFKA_BOOTSTRAP_SERVERS=kafka:9092" -e "APPLICATION_ID=my-kafka-streams-app" apicurio/apicurio-registry-kafka-streams:latest</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Send a test request using the Apicurio Registry REST API. For example, enter the following <code>curl</code> command to create a simple Avro schema artifact for a share price application in the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST -H "Content-type: application/json; artifactType=AVRO" -H "X-Registry-ArtifactId: share-price" --data '{"type":"record","name":"price","namespace":"com.example","fields":[{"name":"symbol","type":"string"},{"name":"price","type":"string"}]}' http://localhost:8080/api/artifacts</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the response includes the expected JSON body to confirm that the Avro schema artifact was created in the registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"createdOn":1578310374517,"modifiedOn":1578310374517,"id":"prices-value","version":1,"type":"AVRO","globalId":8}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more REST API sample requests, see the <a href="files/registry-rest-api.htm">Registry REST API documentation</a>.</p>
</li>
<li>
<p>For a demonstration based on Kafka Streams storage, see <a href="https://github.com/Apicurio/apicurio-registry-demo" class="bare">https://github.com/Apicurio/apicurio-registry-demo</a>.</p>
</li>
<li>
<p>For more details on Kafka Streams, see the <a href="https://kafka.apache.org/documentation/streams//">Apache Kafka Streams documentation</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-the-registry"><a class="anchor" href="#installing-the-registry"></a>4. Installing Apicurio Registry on OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to first install Apicurio Registry and then how to set up your chosen registry storage option: Strimzi, embedded Infinispan, or PostgreSQL database.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#registry-overview">Apicurio Registry overview</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Apicurio Registry installation</div>
<ul>
<li>
<p><a href="#installing-registry-operatorhub">Installing Apicurio Registry from the OpenShift OperatorHub</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Strimzi storage</div>
<ul>
<li>
<p><a href="#installing-kafka-streams-operatorhub">Installing Strimzi from the OpenShift OperatorHub</a></p>
</li>
<li>
<p><a href="#setting-up-kafka-streams-storage">Configuring Apicurio Registry with Strimzi storage on OpenShift</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Embedded Infinispan storage</div>
<ul>
<li>
<p><a href="#setting-up-infinispan-storage">Configuring Apicurio Registry with embedded Infinispan storage on OpenShift</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">PostgreSQL database storage</div>
<ul>
<li>
<p><a href="#installing-postgresql-operatorhub">Installing a PostgreSQL database from the OpenShift OperatorHub</a></p>
</li>
<li>
<p><a href="#setting-up-postgresql-storage">Configuring Apicurio Registry with PostgreSQL database storage on OpenShift</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can install more than one instance of Apicurio Registry depending on your environment. The number of instances depends on your storage option, for example, your Kafka, Infinispan, or database cluster configuration, and on the number and type of artifacts stored in Apicurio Registry.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For details on building from source, see <a href="https://github.com/Apicurio/apicurio-registry" class="bare">https://github.com/Apicurio/apicurio-registry</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="installing-registry-operatorhub"><a class="anchor" href="#installing-registry-operatorhub"></a>4.1. Installing Apicurio Registry from the OpenShift OperatorHub</h3>
<div class="paragraph">
<p>You can install the Apicurio Registry Operator on your OpenShift cluster from the OperatorHub. The OperatorHub is available from the OpenShift Container Platform web console and provides an interface for cluster administrators to discover and install Operators. For more details, see the <a href="https://docs.openshift.com/container-platform/4.3/operators/olm-understanding-operatorhub.html">OpenShift documentation</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have cluster administrator access to an OpenShift cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console, log in using an account with cluster administrator privileges.</p>
</li>
<li>
<p>Create a new OpenShift project:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the left navigation menu, click <strong>Home</strong> &gt; <strong>Project</strong> &gt; <strong>Create Project</strong>.</p>
</li>
<li>
<p>Enter a project name, for example, <code>my-project</code>, and click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the left navigation menu, click <strong>Catalog</strong> &gt; <strong>OperatorHub</strong>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> text box, enter <code>Registry</code> to find the <strong>Apicurio Registry Operator</strong>.</p>
</li>
<li>
<p>Read the information about the Operator, and click <strong>Install</strong>. This displays the <strong>Create Operator Subscription</strong> page.</p>
</li>
<li>
<p>Select your subscription settings, for example:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Installation Mode</strong> &gt; <strong>A specific namespace on the cluster</strong> &gt; <strong>my-project</strong></p>
</li>
<li>
<p><strong>Update Channel</strong> &gt; <strong>alpha</strong></p>
</li>
<li>
<p><strong>Approval Strategy</strong> &gt; <strong>Manual</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Subscribe</strong>. This displays the <strong>Operators</strong> &gt; <strong>Installed Operators</strong> page.</p>
</li>
<li>
<p>Wait a few moments until the <strong>Status</strong> for the Apicurio Registry Operator displays <strong>Succeeded</strong> and the subscription is <strong>Up to Date</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.4/operators/olm-adding-operators-to-cluster.html">Adding Operators to an OpenShift cluster</a></p>
</li>
<li>
<p><a href="https://github.com/Apicurio/apicurio-registry-operator">Apicurio Registry Operator community in GitHub</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installing-kafka-streams-operatorhub"><a class="anchor" href="#installing-kafka-streams-operatorhub"></a>4.2. Installing Strimzi from the OpenShift OperatorHub</h3>
<div class="paragraph">
<p>If you do not already have Strimzi installed, you can install the Strimzi Operator on your OpenShift cluster from the OperatorHub. The OperatorHub is available from the OpenShift Container Platform web console and provides an interface for cluster administrators to discover and install Operators. For more details, see the <a href="https://docs.openshift.com/container-platform/4.4/operators/olm-understanding-operatorhub.html">OpenShift documentation</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have cluster administrator access to an OpenShift cluster</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console, log in using an account with cluster administrator privileges.</p>
</li>
<li>
<p>Change to the OpenShift project in which Apicurio Registry is installed. For example, from the <strong>Project</strong> drop-down, select <code>my-project</code>.</p>
</li>
<li>
<p>In the left navigation menu, click <strong>Catalog</strong> &gt; <strong>OperatorHub</strong>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> text box, enter <code>Strimzi</code> to find the <strong>Strimzi</strong> Operator.</p>
</li>
<li>
<p>Read the information about the Operator, and click <strong>Install</strong>. This displays the <strong>Create Operator Subscription</strong> page.</p>
</li>
<li>
<p>Select your subscription settings, for example:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Installation Mode</strong> &gt; <strong>A specific namespace on the cluster</strong> &gt; <strong>my-project</strong></p>
</li>
<li>
<p><strong>Update Channel</strong> &gt; <strong>stable</strong></p>
</li>
<li>
<p><strong>Approval Strategy</strong> &gt; <strong>Manual</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Subscribe</strong>. This displays the <strong>Operators</strong> &gt; <strong>Installed Operators</strong> page.</p>
</li>
<li>
<p>Wait a few moments until the <strong>Status</strong> for the Strimzi Operator displays <strong>Succeeded</strong> and the subscription is <strong>Up to Date</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.4/operators/olm-adding-operators-to-cluster.html">Adding Operators to an OpenShift cluster</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.7/html/using_amq_streams_on_openshift/index?">Using AMQ Streams on OpenShift</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-kafka-streams-storage"><a class="anchor" href="#setting-up-kafka-streams-storage"></a>4.3. Configuring Apicurio Registry with Strimzi storage on OpenShift</h3>
<div class="paragraph">
<p>This section explains how to configure Kafka-based storage for Apicurio Registry using Strimzi on OpenShift. This storage option is suitable for production environments when <code>persistent</code> storage is configured for the Kafka cluster on OpenShift. You can install Apicurio Registry in an existing Kafka cluster or create a new Kafka cluster, depending on your environment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have an OpenShift cluster with cluster administrator access.</p>
</li>
<li>
<p>You must have already installed Apicurio Registry. See <a href="#installing-registry-operatorhub">Installing Apicurio Registry from the OpenShift OperatorHub</a>.</p>
</li>
<li>
<p>You must have already installed Strimzi. See <a href="#installing-kafka-streams-operatorhub">Installing Strimzi from the OpenShift OperatorHub</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console, log in using an account with cluster administrator privileges.</p>
</li>
<li>
<p>If you do not already have a Kafka cluster configured, create a new Kafka cluster using Strimzi. For example, in the OpenShift OperatorHub:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Installed Operators</strong> &gt; <strong>Strimzi</strong>.</p>
</li>
<li>
<p>Under <strong>Provided APIs</strong> &gt; <strong>Kafka</strong>, click <strong>Create Instance</strong> to create a new Kafka cluster.</p>
</li>
<li>
<p>Edit the custom resource definition as appropriate, and click <strong>Create</strong>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The default example creates a cluster with 3 Zookeeper nodes and 3 Kafka nodes with <code>ephemeral</code> storage. This temporary storage is suitable for development and testing only, and not for production. For more details, see <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.7/html/using_amq_streams_on_openshift/index?">Using AMQ Streams on OpenShift</a>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>After the cluster is ready, click <strong>Provided APIs</strong> &gt; <strong>Kafka</strong> &gt; <strong>my-cluster</strong> &gt; <strong>YAML</strong>.</p>
</li>
<li>
<p>In the <code>status</code> block, make a copy of the <code>bootstrapServers</code> value, which you will use later to deploy Apicurio Registry. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">status:
  conditions:
  ...
  listeners:
    - addresses:
        - host: my-cluster-kafka-bootstrap.my-project.svc
          port: 9092
      bootstrapServers: 'my-cluster-kafka-bootstrap.my-project.svc:9092'
      type: plain
  ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create a Kafka topic to store the Apicurio Registry artifacts:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Under <strong>Provided APIs</strong> &gt; <strong>Kafka Topic</strong>, click <strong>Create topic</strong>.</p>
</li>
<li>
<p>Change the default topic name from <code>my-topic</code> to the required <code>storage-topic</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a Kafka topic to store the Apicurio Registry global IDs:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Under <strong>Provided APIs</strong> &gt; <strong>Kafka Topic</strong>, click <strong>Create topic</strong>.</p>
</li>
<li>
<p>Change the default topic name from <code>my-topic</code> to the required <code>global-id-topic</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Installed Operators</strong> &gt; <strong>Apicurio Registry</strong> &gt; <strong>ApicurioRegistry</strong> &gt; <strong>Create ApicurioRegistry</strong>.</p>
</li>
<li>
<p>Paste in the following custom resource definition, but use your <code>bootstrapServers</code> value that you copied earlier:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apicur.io/v1alpha1
kind: ApicurioRegistry
metadata:
  name: example-apicurioregistry
spec:
  configuration:
    persistence: "streams"
    streams:
      bootstrapServers: "my-cluster-kafka-bootstrap.my-project.svc:9092"</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Create</strong> and wait for the Apicurio Registry route to be created on OpenShift.</p>
</li>
<li>
<p>Click <strong>Networking</strong> &gt; <strong>Route</strong> to access the new route for the Apicurio Registry web console. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>http://example-apicurioregistry.my-project.my-domain-name.com/</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more details on installing Strimzi and on creating Kafka clusters and topics, see <a href="https://strimzi.io/docs/overview/latest/" class="bare">https://strimzi.io/docs/overview/latest/</a></p>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-infinispan-storage"><a class="anchor" href="#setting-up-infinispan-storage"></a>4.4. Configuring Apicurio Registry with embedded Infinispan storage on OpenShift</h3>
<div class="paragraph">
<p>This section explains how to configure Infinispan cache-based storage for Apicurio Registry on OpenShift. This storage option is based on Infinispan community Java libraries embedded in the Quarkus-based Apicurio Registry server. You do not need to install a separate Infinispan server using this storage option. This option is suitable for development or demonstration only, and is not suitable for production environments.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have an OpenShift cluster with cluster administrator access.</p>
</li>
<li>
<p>You must have already installed Apicurio Registry. See <a href="#installing-registry-operatorhub">Installing Apicurio Registry from the OpenShift OperatorHub</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console, log in using an account with cluster administrator privileges.</p>
</li>
<li>
<p>Click <strong>Installed Operators</strong> &gt; <strong>Apicurio Registry</strong> &gt; <strong>ApicurioRegistry</strong> &gt; <strong>Create ApicurioRegistry</strong>.</p>
</li>
<li>
<p>Paste in the following custom resource definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apicur.io/v1alpha1
kind: ApicurioRegistry
metadata:
  name: example-apicurioregistry
spec:
  configuration:
    persistence: "infinispan"
    infinispan: # Currently uses embedded version of Infinispan
      clusterName: "example-apicurioregistry"
      # ^ Optional</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Create</strong> and wait for the Apicurio Registry route to be created on OpenShift.</p>
</li>
<li>
<p>Click <strong>Networking</strong> &gt; <strong>Route</strong> to access the new route for the Apicurio Registry web console. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>http://example-apicurioregistry.my-project.my-domain-name.com/</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details on configuring Infinispan clusters, see the example custom resources available from the <a href="https://github.com/Apicurio/apicurio-registry-demo/blob/master/kubernetes/resources-infinispan.yaml">Apicurio Registry demonstration</a>.</p>
</li>
<li>
<p>For more details on Infinispan, see <a href="https://infinispan.org/" class="bare">https://infinispan.org/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installing-postgresql-operatorhub"><a class="anchor" href="#installing-postgresql-operatorhub"></a>4.5. Installing a PostgreSQL database from the OpenShift OperatorHub</h3>
<div class="paragraph">
<p>If you do not already have a PostgreSQL database Operator installed, you can install a PostgreSQL Operator on your OpenShift cluster from the OperatorHub. The OperatorHub is available from the OpenShift Container Platform web console and provides an interface for cluster administrators to discover and install Operators. For more details, see the <a href="https://docs.openshift.com/container-platform/4.4/operators/olm-understanding-operatorhub.html">OpenShift documentation</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have cluster administrator access to an OpenShift cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console, log in using an account with cluster administrator privileges.</p>
</li>
<li>
<p>Change to the OpenShift project in which Apicurio Registry is installed. For example, from the <strong>Project</strong> drop-down, select <code>my-project</code>.</p>
</li>
<li>
<p>In the left navigation menu, click <strong>Catalog</strong> &gt; <strong>OperatorHub</strong>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> text box, enter <code>PostgreSQL</code> to find an Operator suitable for your environment, for example, <strong>Crunchy PostgreSQL for OpenShift</strong> or <strong>PostgreSQL Operator by Dev4Ddevs.com</strong>.</p>
</li>
<li>
<p>Read the information about the Operator, and click <strong>Install</strong>. This displays the <strong>Create Operator Subscription</strong> page.</p>
</li>
<li>
<p>Select your subscription settings, for example:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Installation Mode</strong> &gt; <strong>A specific namespace on the cluster</strong> &gt; <strong>my-project</strong></p>
</li>
<li>
<p><strong>Update Channel</strong> &gt; <strong>stable</strong></p>
</li>
<li>
<p><strong>Approval Strategy</strong> &gt; <strong>Manual</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Subscribe</strong>. This displays the <strong>Operators</strong> &gt; <strong>Installed Operators</strong> page.</p>
</li>
<li>
<p>Wait a few moments until the <strong>Status</strong> for the PostgreSQL Operator displays <strong>Succeeded</strong> and the subscription is <strong>Up to Date</strong>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You must read the documentation from your chosen <strong>PostgreSQL</strong> Operator for details on how to create and manage your database.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.4/operators/olm-adding-operators-to-cluster.html">Adding Operators to an OpenShift cluster</a></p>
</li>
<li>
<p><a href="https://access.crunchydata.com/documentation/postgres-operator/4.3.2/quickstart/">Crunchy PostgreSQL Operator QuickStart</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-postgresql-storage"><a class="anchor" href="#setting-up-postgresql-storage"></a>4.6. Configuring Apicurio Registry with PostgreSQL database storage on OpenShift</h3>
<div class="paragraph">
<p>This section explains how to configure Java Persistence API-based storage for Apicurio Registry on OpenShift using a PostgreSQL database Operator. You can install Apicurio Registry in an existing database or create a new database, depending on your environment. This section shows a simple example using the PostgreSQL Operator by Dev4Ddevs.com.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have an OpenShift cluster with cluster administrator access.</p>
</li>
<li>
<p>You must have already installed Apicurio Registry. See <a href="#installing-registry-operatorhub">Installing Apicurio Registry from the OpenShift OperatorHub</a>.</p>
</li>
<li>
<p>You must have already installed a PostgreSQL Operator on OpenShift. For examaple, see <a href="#installing-postgresql-operatorhub">Installing a PostgreSQL database from the OpenShift OperatorHub</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console, log in using an account with cluster administrator privileges.</p>
</li>
<li>
<p>Change to the OpenShift project in which Apicurio Registry and your PostgreSQL Operator are installed. For example, from the <strong>Project</strong> drop-down, select <code>my-project</code>.</p>
</li>
<li>
<p>Create a PostgreSQL database for your Apicurio Registry storage. For example, click <strong>Installed Operators</strong> &gt; <strong>PostgreSQL Operator by Dev4Ddevs.com</strong> &gt; <strong>Create database</strong> &gt; <strong>YAML</strong>.</p>
</li>
<li>
<p>Edit the database settings as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Change the value to <code>registry</code></p>
</li>
<li>
<p><code>image</code>: Change the value to <code>centos/postgresql-10-centos7</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Edit any other database settings as needed depending on your environment, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: postgresql.dev4devs.com/v1alpha1
kind: Database
metadata:
  name: registry
  namespace: my-project
spec:
  databaseCpu: 30m
  databaseCpuLimit: 60m
  databaseMemoryLimit: 512Mi
  databaseMemoryRequest: 128Mi
  databaseName: example
  databaseNameKeyEnvVar: POSTGRESQL_DATABASE
  databasePassword: postgres
  databasePasswordKeyEnvVar: POSTGRESQL_PASSWORD
  databaseStorageRequest: 1Gi
  databaseUser: postgres
  databaseUserKeyEnvVar: POSTGRESQL_USER
  image: centos/postgresql-10-centos7
  size: 1</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Create Database</strong>, and wait until the database is created.</p>
</li>
<li>
<p>Click <strong>Installed Operators</strong> &gt; <strong>Apicurio Registry</strong> &gt; <strong>ApicurioRegistry</strong> &gt; <strong>Create ApicurioRegistry</strong>.</p>
</li>
<li>
<p>Paste in the following custom resource definition, and edit the values for the database <code>url</code> and credentials to match your environment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apicur.io/v1alpha1
kind: ApicurioRegistry
metadata:
  name: example-apicurioregistry
spec:
  configuration:
    persistence: "jpa"
    dataSource:
      url: "jdbc:postgresql://SERVICE_NAME.NAMESPACE.svc:5432/"
      # e.g. url: "jdbc:postgresql://acid-minimal-cluster.my-project.svc:5432/"
      userName: "postgres"
      password: "PASSWORD"
      # ^ Optional</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Create</strong> and wait for the Apicurio Registry route to be created on OpenShift.</p>
</li>
<li>
<p>Click <strong>Networking</strong> &gt; <strong>Route</strong> to access the new route for the Apicurio Registry web console. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>http://example-apicurioregistry.my-project.my-domain-name.com/</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://access.crunchydata.com/documentation/postgres-operator/4.3.2/quickstart/">Crunchy PostgreSQL Operator QuickStart</a></p>
</li>
<li>
<p><a href="https://github.com/Apicurio/apicurio-registry-operator/blob/master/docs/minikube-quickstart.md">Apicurio Registry Operator QuickStart</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-registry"><a class="anchor" href="#configuring-the-registry"></a>5. Configuring Apicurio Registry on OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to configure optional settings for Apicurio Registry health checks on OpenShift:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-liveness-readiness-probes">Configuring Apicurio Registry health checks on OpenShift</a></p>
</li>
<li>
<p><a href="#registry-liveness-env-vars">Environment variables for Apicurio Registry health checks</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configuring-liveness-readiness-probes"><a class="anchor" href="#configuring-liveness-readiness-probes"></a>5.1. Configuring Apicurio Registry health checks on OpenShift</h3>
<div class="paragraph">
<p>You can configure optional environment variables for liveness and readiness probes to monitor the health of the Apicurio Registry server on OpenShift:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Liveness probes</em> test if the application can make progress. If the application cannot make progress, OpenShift automatically restarts the failing Pod.</p>
</li>
<li>
<p><em>Readiness probes</em> test if the application is ready to process requests. If the application is not ready, it can become overwhelmed by requests, and OpenShift stops sending requests for the time that the probe fails. If other Pods are OK, they continue to receive requests.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The default values of the liveness and readiness environment variables are designed for most cases and should only be changed if required by your environment. Any changes to the defaults depend on your hardware, network, and amount of data stored. These values should be kept as low as possible to avoid unnecessary overhead.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have an OpenShift cluster with cluster administrator access.</p>
</li>
<li>
<p>You must have already installed Apicurio Registry. See <a href="#installing-registry-operatorhub">Installing Apicurio Registry from the OpenShift OperatorHub</a>.</p>
</li>
<li>
<p>You must have already installed and configured your chosen Apicurio Registry storage in Strimzi, embedded Infinispan, or PostgreSQL.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console, log in using an account with cluster administrator privileges.</p>
</li>
<li>
<p>Click <strong>Installed Operators</strong> &gt; <strong>Apicurio Registry</strong>.</p>
</li>
<li>
<p>On the <strong>ApicurioRegistry</strong> tab, click the Operator custom resource for your deployment, for example, <strong>example-apicurioregistry</strong>.</p>
</li>
<li>
<p>In the main overview page, find the <strong>Deployment Name</strong> section and the corresponding <code>DeploymentConfig</code> name for your Apicurio Registry deployment, for example, <strong>example-apicurioregistry</strong>.</p>
</li>
<li>
<p>In the left navigation menu, click <strong>Workloads</strong> &gt; <strong>Deployment Configs</strong>, and select your <code>DeploymentConfig</code> name.</p>
</li>
<li>
<p>Click the <strong>Environment</strong> tab, and enter your environment variables in the <strong>Single values env</strong> section, for example:</p>
<div class="ulist">
<ul>
<li>
<p><strong>NAME</strong>: <code>LIVENESS_STATUS_RESET</code></p>
</li>
<li>
<p><strong>VALUE</strong>: <code>350</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong> at the bottom.</p>
<div class="paragraph">
<p>Alternatively, you can perform these steps using the OpenShift <code>oc</code> command. For more details, see the <a href="https://docs.openshift.com/container-platform/4.4/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI documentation</a>.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#registry-liveness-env-vars">Environment variables for Apicurio Registry health checks</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.4/applications/application-health.html">OpenShift documentation on monitoring application health</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="registry-liveness-env-vars"><a class="anchor" href="#registry-liveness-env-vars"></a>5.2. Environment variables for Apicurio Registry health checks</h3>
<div class="paragraph">
<p>This section describes the available environment variables for Apicurio Registry health checks on OpenShift. These include liveness and readiness probes to monitor the health of the Apicurio Registry server on OpenShift. For an example procedure, see <a href="#configuring-liveness-readiness-probes">Configuring Apicurio Registry health checks on OpenShift</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The following environment variables are provided for reference only. The default values are designed for most cases and should only be changed if required by your environment. Any changes to the defaults depend on your hardware, network, and amount of data stored. These values should be kept as low as possible to avoid unnecessary overhead.
</td>
</tr>
</table>
</div>
<h4 id="_liveness_environment_variables" class="discrete">Liveness environment variables</h4>
<table class="tableblock frame-all grid-all stretch table-expandable">
<caption class="title">Table 2. Environment variables for Apicurio Registry liveness probes</caption>
<colgroup>
<col style="width: 29.4117%;">
<col style="width: 29.4117%;">
<col style="width: 11.7647%;">
<col style="width: 29.4119%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVENESS_ERROR_THRESHOLD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of liveness issues or errors that can occur before the liveness probe fails.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVENESS_COUNTER_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period in which the threshold number of errors must occur. For example, if this value is 60 and the threshold is 1, the check fails after two errors occur in 1 minute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVENESS_STATUS_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that must elapse without any more errors for the liveness probe to reset to OK status.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIVENESS_ERRORS_IGNORED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of ignored liveness exceptions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.grpc.StatusRuntimeException,org.apache.kafka.streams.errors.InvalidStateStoreException</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because OpenShift automatically restarts a Pod that fails a liveness check, the liveness settings, unlike readiness settings, do not directly affect behavior of Apicurio Registry on OpenShift.
</td>
</tr>
</table>
</div>
<h4 id="_readiness_environment_variables" class="discrete">Readiness environment variables</h4>
<table class="tableblock frame-all grid-all stretch table-expandable">
<caption class="title">Table 3. Environment variables for Apicurio Registry readiness probes</caption>
<colgroup>
<col style="width: 30.7692%;">
<col style="width: 38.4615%;">
<col style="width: 15.3846%;">
<col style="width: 15.3847%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READINESS_ERROR_THRESHOLD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of readiness issues or errors that can occur before the readiness probe fails.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READINESS_COUNTER_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period in which the threshold number of errors must occur. For example, if this value is 60 and the threshold is 1, the check fails after two errors occur in 1 minute.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READINESS_STATUS_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that must elapse without any more errors for the liveness probe to reset to OK status. In this case, this means how long the Pod stays not ready, until it returns to normal operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READINESS_TIMEOUT</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Readiness tracks the timeout of two operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How long it takes for storage requests to complete</p>
</li>
<li>
<p>How long it takes for HTTP REST API requests to return a response</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If these operations take more time than the configured timeout, this is counted as a readiness issue or error. This value controls the timeouts for both operations.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#configuring-liveness-readiness-probes">Configuring Apicurio Registry health checks on OpenShift</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.4/applications/application-health.html">OpenShift documentation on monitoring application health</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing-registry-artifacts-ui"><a class="anchor" href="#managing-registry-artifacts-ui"></a>6. Managing Apicurio Registry content using the web console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to manage artifacts stored in the registry using the Apicurio Registry web console. This includes uploading and browsing registry content, and configuring optional rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#adding-artifacts-using-console">Adding artifacts using the Apicurio Registry web console</a></p>
</li>
<li>
<p><a href="#browsing-artifacts-using-console">Viewing artifacts using the Apicurio Registry web console</a></p>
</li>
<li>
<p><a href="#configuring-rules-using-console">Configuring content rules using the Apicurio Registry web console</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="adding-artifacts-using-console"><a class="anchor" href="#adding-artifacts-using-console"></a>6.1. Adding artifacts using the Apicurio Registry web console</h3>
<div class="paragraph">
<p>You can use the Apicurio Registry web console to upload event schema and API design artifacts to the registry. For more details on the artifact types that you can upload, see <a href="#registry-artifact-types">Apicurio Registry artifact types</a>. This section shows simple examples of uploading Apicurio Registry artifacts, applying artifact rules, and adding new artifact versions.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry must be installed and running in your environment. For details, see <a href="#installing-the-registry">Installing Apicurio Registry on OpenShift</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to the Apicurio Registry web console on:</p>
<div class="paragraph">
<p><code><strong>http://MY_REGISTRY_URL/ui</strong></code></p>
</div>
</li>
<li>
<p>Click <strong>Upload Artifact</strong>, and specify the following:</p>
<div class="ulist">
<ul>
<li>
<p><strong>ID</strong>: Use the default empty setting to automatically generate an ID, or enter a specific artifact ID.</p>
</li>
<li>
<p><strong>Type</strong>: Use the default <strong>Auto-Detect</strong> setting to automatically detect the artifact type, or select the artifact type from the drop-down, for example, <strong>Avro Schema</strong> or <strong>OpenAPI</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Apicurio Registry server cannot automatically detect the <strong>JSON Schema</strong> artifact type. You must manually select this artifact type.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Artifact</strong>: Drag and drop or click <strong>Browse</strong> to upload a file, for example, <code>my-schema.json</code> or <code>my-openapi.json</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Upload</strong> and view the <strong>Artifact Details</strong>:</p>
<div class="imageblock">
<div class="content">
<img src="assets-images/images/getting-started/registry-web-console-artifact.png" alt="Artifact Details in Registry web console">
</div>
<div class="title">Figure 4. Artifact Details in Apicurio Registry web console</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Info</strong>: Displays the artifact name, description, lifecycle status, when created, and last modified. You can click the <strong>Edit Artifact Metadata</strong> pencil icon to edit the artifact name and description or add labels, and click <strong>Download</strong> to download the artifact file locally. Also displays artifact <strong>Content Rules</strong> that you can enable and configure.</p>
</li>
<li>
<p><strong>Documentation</strong> (OpenAPI only): Displays automatically-generated REST API documentation.</p>
</li>
<li>
<p><strong>Content</strong>: Displays a read-only view of the full artifact content.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In <strong>Content Rules</strong>, click <strong>Enable</strong> to configure a <strong>Validity Rule</strong> or <strong>Compatibility Rule</strong>, and select the appropriate rule configuration from the drop-down. For more details, see <a href="#registry-rule-types">Apicurio Registry content rule types</a>.</p>
</li>
<li>
<p>Click <strong>Upload new version</strong> to add a new artifact version, and drag and drop or click <strong>Browse</strong> to upload the file, for example, <code>my-schema.json</code> or <code>my-openapi.json</code>.</p>
</li>
<li>
<p>To delete an artifact, click the trash icon next to <strong>Upload new version</strong>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Deleting an artifact deletes the artifact and all of its versions, and cannot be undone. Artifact versions are immutable and cannot be deleted individually.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#browsing-artifacts-using-console">Viewing artifacts using the Apicurio Registry web console</a></p>
</li>
<li>
<p><a href="#configuring-rules-using-console">Configuring content rules using the Apicurio Registry web console</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="browsing-artifacts-using-console"><a class="anchor" href="#browsing-artifacts-using-console"></a>6.2. Viewing artifacts using the Apicurio Registry web console</h3>
<div class="paragraph">
<p>You can use the Apicurio Registry web console to browse the event schema and API design artifacts stored in the registry. This section shows simple examples of viewing Apicurio Registry artifacts, versions, and artifact rules. For more details on the artifact types stored in the registry, see <a href="#registry-artifact-types">Apicurio Registry artifact types</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry must be installed and running in your environment. For details, see <a href="#installing-the-registry">Installing Apicurio Registry on OpenShift</a>.</p>
</li>
<li>
<p>Artifacts must have been added to the registry using the Apicurio Registry web console, REST API commands, Maven plug-in, or a Java client application.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to the Apicurio Registry web console on:</p>
<div class="paragraph">
<p><code><strong>http://MY_REGISTRY_URL/ui</strong></code></p>
</div>
</li>
<li>
<p>Browse the list of artifacts stored in the registry, or enter a search string to find an artifact. You can select to search by a specific <strong>Name</strong>, <strong>Description</strong>, <strong>Label</strong>, or <strong>Everything</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="assets-images/images/getting-started/registry-web-console.png" alt="Browse artifacts in Registry web console">
</div>
<div class="title">Figure 5. Browse artifacts in Apicurio Registry web console</div>
</div>
</li>
<li>
<p>Click <strong>View artifact</strong> to view the <strong>Artifact Details</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Info</strong>: Displays the artifact name, description, lifecycle status, when created, and last modified. You can click the <strong>Edit Artifact Metadata</strong> pencil icon to edit the artifact name and description or add labels, and click <strong>Download</strong> to download the artifact file locally. Also displays artifact <strong>Content Rules</strong> that you can enable and configure.</p>
</li>
<li>
<p><strong>Documentation</strong> (OpenAPI only): Displays automatically-generated REST API documentation.</p>
</li>
<li>
<p><strong>Content</strong>: Displays a read-only view of the full artifact content.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Select to view a different artifact <strong>Version</strong> from the drop-down, if additional versions have been added.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#adding-artifacts-using-console">Adding artifacts using the Apicurio Registry web console</a></p>
</li>
<li>
<p><a href="#configuring-rules-using-console">Configuring content rules using the Apicurio Registry web console</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-rules-using-console"><a class="anchor" href="#configuring-rules-using-console"></a>6.3. Configuring content rules using the Apicurio Registry web console</h3>
<div class="paragraph">
<p>You can use the Apicurio Registry web console to configure optional rules to prevent invalid content from being added to the registry. All configured artifact rules or global rules must pass before a new artifact version can be uploaded to the registry. Configured artifact rules override any configured global rules. For more details, see <a href="#registry-rules">Rules for registry content</a>.</p>
</div>
<div class="paragraph">
<p>This section shows a simple example of configuring global and artifact rules. For details on the different rule types and associated configuration settings that you can select, see <a href="#registry-rule-types">Apicurio Registry content rule types</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry must be installed and running in your environment. For details, see <a href="#installing-the-registry">Installing Apicurio Registry on OpenShift</a>.</p>
</li>
<li>
<p>For artifact rules, artifacts must have been added to the registry using the Apicurio Registry web console, REST API commands, Maven plug-in, or a Java client application.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to the Apicurio Registry web console on:</p>
<div class="paragraph">
<p><code><strong>http://MY_REGISTRY_URL/ui</strong></code></p>
</div>
</li>
<li>
<p>For artifact rules, browse the list of artifacts stored in the registry, or enter a search string to find an artifact. You can select to search by a specific artifact <strong>Name</strong>, <strong>Description</strong>, <strong>Label</strong>, or <strong>Everything</strong>.</p>
</li>
<li>
<p>Click <strong>View artifact</strong> to view the <strong>Artifact Details</strong>.</p>
</li>
<li>
<p>In <strong>Content Rules</strong>, click <strong>Enable</strong> to configure an artifact <strong>Validity Rule</strong> or <strong>Compatibility Rule</strong>, and select the appropriate rule configuration from the drop-down. For more details, see <a href="#registry-rule-types">Apicurio Registry content rule types</a>.</p>
<div class="imageblock">
<div class="content">
<img src="assets-images/images/getting-started/registry-web-console-rules.png" alt="Configure rules in Registry web console">
</div>
<div class="title">Figure 6. Configure content rules in Apicurio Registry web console</div>
</div>
</li>
<li>
<p>For global rules, click the <strong>Settings</strong> cog icon at the top right of the toolbar, and click <strong>Enable</strong> to configure a global <strong>Validity Rule</strong> or <strong>Compatibility Rule</strong>, and select the appropriate rule configuration from the drop-down. For more details, see <a href="#registry-rule-types">Apicurio Registry content rule types</a>.</p>
</li>
<li>
<p>To disable an artifact rule or global rule, click the trash icon next to the rule.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#adding-artifacts-using-console">Adding artifacts using the Apicurio Registry web console</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing-registry-artifacts-api"><a class="anchor" href="#managing-registry-artifacts-api"></a>7. Managing Apicurio Registry content using the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to manage artifacts stored in the registry using the Registry REST API. This includes using Registry REST API commands, a Maven plug-in, or a Java client application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#managing-artifacts-using-rest-api">Managing artifacts using Registry REST API commands</a></p>
</li>
<li>
<p><a href="#managing-artifacts-using-maven-plugin">Managing artifacts using the Apicurio Registry Maven plug-in</a></p>
</li>
<li>
<p><a href="#managing-artifacts-using-client-code">Managing artifacts using a Apicurio Registry client application</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="managing-artifacts-using-rest-api"><a class="anchor" href="#managing-artifacts-using-rest-api"></a>7.1. Managing artifacts using Registry REST API commands</h3>
<div class="paragraph">
<p>Client applications can use Registry REST API commands to manage artifacts in Apicurio Registry, for example, in a CI/CD pipeline deployed in production. The Registry REST API provides create, read, update, and delete operations for artifacts, versions, metadata, and rules stored in the registry. For detailed information, see the <a href="files/registry-rest-api.htm">Apicurio Registry REST API documentation</a>.</p>
</div>
<div class="paragraph">
<p>This section shows a simple curl-based example of using the Registry REST API to add and retrieve an Apache Avro schema artifact in the registry.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When adding artifacts in Apicurio Registry using the REST API, if you do not specify a unique artifact ID, Apicurio Registry generates one automatically as a UUID.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>See <a href="#registry-rest-api">Registry REST API</a>.</p>
</li>
<li>
<p>Apicurio Registry must be installed and running in your environment. For details, see <a href="#installing-the-registry">Installing Apicurio Registry on OpenShift</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add an artifact in the registry using the <code>/artifacts</code> operation. The following example <code>curl</code> command adds a simple artifact for a share price application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST -H "Content-type: application/json; artifactType=AVRO" -H "X-Registry-ArtifactId: share-price" --data '{"type":"record","name":"price","namespace":"com.example","fields":[{"name":"symbol","type":"string"},{"name":"price","type":"string"}]}' http://MY-REGISTRY-HOST/api/artifacts</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows adding an Avro schema artifact with an artifact ID of <code>share-price</code>.</p>
</div>
<div class="paragraph">
<p><code>MY-REGISTRY-HOST</code> is the host name on which Apicurio Registry is deployed. For example: <code>http://localhost:8080/api/artifacts</code>.</p>
</div>
</li>
<li>
<p>Verify that the response includes the expected JSON body to confirm that the artifact was added. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{"createdOn":1578310374517,"modifiedOn":1578310374517,"id":"share-price","version":1,"type":"AVRO","globalId":8}</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the artifact from the registry using its artifact ID. For example, in this case the specified ID is <code>share-price</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://MY-REGISTRY-URL/api/artifacts/share-price
'{"type":"record","name":"price","namespace":"com.example","fields":[{"name":"symbol","type":"string"},{"name":"price","type":"string"}]}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more REST API sample requests, see the <a href="files/registry-rest-api.htm">Registry REST API documentation</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="managing-artifacts-using-maven-plugin"><a class="anchor" href="#managing-artifacts-using-maven-plugin"></a>7.2. Managing artifacts using the Apicurio Registry Maven plug-in</h3>
<div class="paragraph">
<p>Apicurio Registry provides a Maven plug-in to enable you to upload or download registry artifacts as part of your development build. For example, this plug-in is useful for testing and validating that your schema updates are compatible with client applications.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry must be installed and running in your environment</p>
</li>
<li>
<p>Maven must be installed and configured in your environment</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update your Maven <code>pom.xml</code> file to use the <code>apicurio-registry-maven-plugin</code> to upload an artifact to Apicurio Registry. The following example shows registering an Apache Avro schema artifact:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
&lt;groupId&gt;io.apicurio&lt;/groupId&gt;
&lt;artifactId&gt;apicurio-registry-maven-plugin&lt;/artifactId&gt;
&lt;version&gt;${registry.version}&lt;/version&gt;
&lt;executions&gt;
  &lt;execution&gt;
    &lt;phase&gt;generate-sources&lt;/phase&gt;
    &lt;goals&gt;
      &lt;goal&gt;register&lt;/goal&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;/goals&gt;
    &lt;configuration&gt;
      &lt;registryUrl&gt;http://my-cluster-service-registry-myproject.example.com/api&lt;/registryUrl&gt; <i class="conum" data-value="2"></i><b>(2)</b>
      &lt;artifactType&gt;AVRO&lt;/artifactType&gt;
      &lt;artifacts&gt;
        &lt;schema1&gt;${project.basedir}/schemas/schema1.avsc&lt;/schema1&gt; <i class="conum" data-value="3"></i><b>(3)</b>
      &lt;/artifacts&gt;
    &lt;/configuration&gt;
  &lt;/execution&gt;
&lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify <code>register</code> as the execution goal to upload an artifact to the registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You must specify the Apicurio Registry URL with the <code>/api</code> endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can upload multiple artifacts using the artifact ID and location.</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can also update your Maven <code>pom.xml</code> file to download a previously registered artifact from Apicurio Registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
&lt;groupId&gt;io.apicurio&lt;/groupId&gt;
&lt;artifactId&gt;apicurio-registry-maven-plugin&lt;/artifactId&gt;
&lt;version&gt;${registry.version}&lt;/version&gt;
&lt;executions&gt;
  &lt;execution&gt;
    &lt;phase&gt;generate-sources&lt;/phase&gt;
    &lt;goals&gt;
      &lt;goal&gt;download&lt;/goal&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;/goals&gt;
    &lt;configuration&gt;
      &lt;registryUrl&gt;http://my-cluster-service-registry-myproject.example.com/api&lt;/registryUrl&gt; <i class="conum" data-value="2"></i><b>(2)</b>
          &lt;ids&gt;
            &lt;param1&gt;schema1&lt;/param1&gt; <i class="conum" data-value="3"></i><b>(3)</b>
          &lt;/ids&gt;
      &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;
   &lt;/configuration&gt;
 &lt;/execution&gt;
&lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify <code>download</code> as the execution goal.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You must specify the Apicurio Registry URL with the <code>/api</code> endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can download multiple artifacts to a specified directory using the artifact ID.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details on the Maven plug-in, see <a href="https://github.com/Apicurio/apicurio-registry-demo" class="bare">https://github.com/Apicurio/apicurio-registry-demo</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="managing-artifacts-using-client-code"><a class="anchor" href="#managing-artifacts-using-client-code"></a>7.3. Managing artifacts using a Apicurio Registry client application</h3>
<div class="paragraph">
<p>You can also manage artifacts stored in Apicurio Registry using a Java client application. You create, read, update, or delete artifacts stored in the registry using the Apicurio Registry Java client classes.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>See <a href="#client-serde">Kafka client serializers/deserializers</a></p>
</li>
<li>
<p>You must have implemented a client application in Java that imports the Apicurio Registry client classes: <code>io.apicurio.registry.client.RegistryClient</code></p>
</li>
<li>
<p>Apicurio Registry must be installed and running in your environment</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Update your client application to add a new artifact in the registry. The following example shows adding an Apache Avro schema artifact from a Kafka producer client application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl_node1 = PropertiesUtil.property(clientProperties, "registry.url.node1",
  "http://my-cluster-service-registry-myproject.example.com/api"); <i class="conum" data-value="1"></i><b>(1)</b>
   try (RegistryService service = RegistryClient.create(registryUrl_node1))
   {
    String artifactId = ApplicationImpl.INPUT_TOPIC + "-value";
    try {
     service.getArtifactMetaData(artifactId); <i class="conum" data-value="2"></i><b>(2)</b>
    }
    catch (WebApplicationException e) {
     CompletionStage &lt; ArtifactMetaData &gt; csa = service.createArtifact( <i class="conum" data-value="3"></i><b>(3)</b>
        ArtifactType.AVRO,
        artifactId,
         new ByteArrayInputStream(LogInput.SCHEMA$.toString().getBytes())
        );
    csa.toCompletableFuture().get();
    }
 }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure the client application with the Apicurio Registry URL in the client properties. You must specify the Apicurio Registry URL with the <code>/api</code> endpoint. You can create properties for more than one registry node.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Check to see if the schema artifact already exists in the registry based on the artifact ID.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the new schema artifact in the registry.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For an example Java client application, see <a href="https://github.com/Apicurio/apicurio-registry-demo" class="bare">https://github.com/Apicurio/apicurio-registry-demo</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="artifact-and-rule-types"><a class="anchor" href="#artifact-and-rule-types"></a>8. Apicurio Registry reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter lists the supported artifact types and content rule types that are stored in Apicurio Registry.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-artifact-types">Apicurio Registry artifact types</a></p>
</li>
<li>
<p><a href="#registry-rule-types">Apicurio Registry content rule types</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more detailed information on artifact and rule types, see the <a href="files/registry-rest-api.htm">Apicurio Registry REST API documentation</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="registry-artifact-types"><a class="anchor" href="#registry-artifact-types"></a>8.1. Apicurio Registry artifact types</h3>
<div class="paragraph">
<p>You can store and manage the following artifact types in Apicurio Registry:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Apicurio Registry artifact types</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ASYNCAPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AsyncAPI specification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AVRO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Avro schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GRAPHQL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GraphQL schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JSON</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON Schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KCONNECT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Kafka Connect schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OPENAPI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenAPI specification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PROTOBUF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google protocol buffers schema</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PROTOBUF_FD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google protocol buffers file descriptor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WSDL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Services Definition Language</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XSD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML Schema Definition</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="registry-rule-types"><a class="anchor" href="#registry-rule-types"></a>8.2. Apicurio Registry content rule types</h3>
<div class="paragraph">
<p>You can specify the following rule types to govern content evolution in Apicurio Registry:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Apicurio Registry content rule types</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VALIDITY</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Validate data before adding it to the registry. The possible configuration values for this rule are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FULL</code>: The validation is both syntax and semantic.</p>
</li>
<li>
<p><code>SYNTAX_ONLY</code>: The validation is syntax only.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPATIBILITY</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Ensure that newly added artifacts are compatible with previously added versions. The possible configuration values for this rule are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FULL</code>: The new artifact is forward and backward compatible with the most recently added artifact.</p>
</li>
<li>
<p><code>FULL_TRANSITIVE</code>: The new artifact is forward and backward compatible with all previously added artifacts.</p>
</li>
<li>
<p><code>BACKWARD</code>: Clients using the new artifact can read data written using the most recently added artifact.</p>
</li>
<li>
<p><code>BACKWARD_TRANSITIVE</code>: Clients using the new artifact can read data written using all previously added artifacts.</p>
</li>
<li>
<p><code>FORWARD</code>: Clients using the most recently added artifact can read data written using the new artifact.</p>
</li>
<li>
<p><code>FORWARD_TRANSITIVE</code>: Clients using all previously added artifacts can read data written using the new artifact.</p>
</li>
<li>
<p><code>NONE</code>: All backward and forward compatibility checks are disabled.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright Â© 2020 Red Hat, Inc. All rights reserved.</p>
</footer>
<script src="../assets/js/site.js"></script>
<script async src="../assets/js/vendor/highlight.js"></script>
  </body>
</html>
