<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using the Kafka client serializers/deserializers :: Apicurio Registry</title>
    <link rel="canonical" href="https://www.apicur.io/registry/docs/apicurio-registry/getting-started/assembly-using-kafka-client-serdes.html">
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="../../assets/css/site.css">
    <link rel="stylesheet" href="https://www.apicur.io/css/rhbar.css">
    <link rel="shortcut icon" href="https://www.apicur.io/images/favicon.ico" type="image/x-icon" integrity="sha384-if9KH+NQ2dMhdrWu+INnJTcvG6riRakUAnbhecX5a7voubrapo7ouFGS+GYZ/N4P" crossorigin="anonymous"/>
  </head>
  <body class="article">
<div id="rhbar">
    <a class="jbdevlogo" href="https://www.jboss.org/projects/about" rel="nofollow" target="_blank"></a>
    <a class="rhlogo" href="https://www.redhat.com/" rel="nofollow" target="_blank"></a>
</div>
<div class="masthead-header">

    <a href="" target="_blank" class="github-corner" aria-label="View source on Github">
        <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    </a>

    <div class="masthead-logo"></div>
    <div class="masthead-brand"><a href="/">Apicurio Studio</a></div>
    <div class="masthead-menu">
        <ul>
            <li><a href="/contact/">Contact</a></li>
        </ul>
    </div>
</div>
<div class="body">
<div class="nav-container" data-component="apicurio-registry" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apicurio Registry</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-intro-to-the-registry.html">Introduction to Apicurio Registry</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-intro-to-registry-rules.html">Apicurio Registry content rules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-the-registry-docker.html">Installing Apicurio Registry using Docker</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-installing-the-registry-openshift.html">Installing Apicurio Registry on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-configuring-the-registry.html">Configuring Apicurio Registry on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-managing-registry-artifacts-ui.html">Managing Apicurio Registry content using the web console</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="assembly-using-kafka-client-serdes.html">Using the Kafka client serializers/deserializers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-using-the-registry-client.html">Using the Apicurio Registry Java client</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="assembly-registry-reference.html">Apicurio Registry reference</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apicurio Registry</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apicurio Registry</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apicurio Registry</a></li>
    <li><a href="assembly-using-kafka-client-serdes.html">Using the Kafka client serializers/deserializers</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/Apicurio/apicurio-registry">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Using the Kafka client serializers/deserializers</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apicurio Registry provides Kafka client serializers/deserializers for producer and consumer applications. Kafka producer applications use serializers to encode messages that conform to a specific event schema. Kafka consumer applications use deserializers to validate that the messages have been serialized using the correct schema, based on a specific schema ID. This ensures consistent schema use and helps to prevent data errors at runtime.</p>
</div>
<div class="paragraph">
<p>This chapter provides instructions on how to use the Kafka client serializer and deserializer for Apache Avro in your Kafka producer and consumer client applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-serdes-concepts-serde-registry">Kafka client applications and Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-concepts-strategy-registry">Strategies to lookup a schema</a></p>
</li>
<li>
<p><a href="#registry-serdes-concepts-constants-registry">Apicurio Registry serializer/deserializer constants</a></p>
</li>
<li>
<p><a href="#registry-serdes-register-registry">Registering a schema to Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-consumer-registry">Using a schema from a consumer client</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-producer-registry">Using a schema from a producer client</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have read <a href="assembly-intro-to-the-registry.html">Registry Overview</a></p>
</li>
<li>
<p>You must have installed Apicurio Registry.</p>
</li>
<li>
<p>You must have created Kafka producer and consumer client applications.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-concepts-serde-registry"><a class="anchor" href="#registry-serdes-concepts-serde-registry"></a>Kafka client applications and Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using Apicurio Registry decouples schema management from client application configuration. You can enable an application to use a schema from the registry by specifying its URL in the client code.</p>
</div>
<div class="paragraph">
<p>For example, you can store the schemas to serialize and deserialize messages in the registry, which are then referenced from the applications that use them to ensure that the messages that they send and receive are compatible with those schemas. Kafka client applications can push or pull their schemas from Apicurio Registry at runtime.</p>
</div>
<div class="paragraph">
<p>Schemas can evolve, so you can define rules in Apicurio Registry, for example, to ensure that changes to a schema are valid and do not break previous versions used by applications. Apicurio Registry checks for compatibility by comparing a modified schema with previous schema versions.</p>
</div>
<div class="paragraph">
<p>Apicurio Registry provides full schema registry support for Avro schemas,
which are used by client applications through Kafka client serializer/deserializer (SerDe) services provided by Apicurio Registry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_producer_schema_configuration"><a class="anchor" href="#_producer_schema_configuration"></a>Producer schema configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A producer client application uses a serializer to put the messages that it sends to a specific broker topic into the correct data format.</p>
</div>
<div class="paragraph">
<p>To enable a producer to use Apicurio Registry for serialization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#registry-serdes-register-registry">Define and register your schema with Apicurio Registry</a></p>
</li>
<li>
<p><a href="#registry-serdes-config-producer-registry">Configure the producer client code</a>:</p>
<div class="ulist">
<ul>
<li>
<p>URL of Apicurio Registry</p>
</li>
<li>
<p>Apicurio Registry serializer to use with the messages</p>
</li>
<li>
<p><em>Strategy</em> to look up the schema used for serialization in Apicurio Registry</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After registering your schema, when you start Kafka and Apicurio Registry,
you can access the schema to format messages sent to the Kafka broker topic by the producer.</p>
</div>
<div class="paragraph">
<p>If a schema already exists, you can create a new version using the REST API based on compatibility rules defined in Apicurio Registry. Versions are used for compatibility checking as a schema evolves.An artifact ID and schema version represents a unique tuple that identifies a schema.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consumer_schema_configuration"><a class="anchor" href="#_consumer_schema_configuration"></a>Consumer schema configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A consumer client application uses a deserializer to get the messages that it consumes from a specific broker topic into the correct data format.</p>
</div>
<div class="paragraph">
<p>To enable a consumer to use Apicurio Registry for deserialization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#service-registry-register-registry">Define and register your schema with Apicurio Registry</a></p>
</li>
<li>
<p><a href="#service-registry-config-consumer-registry">Configure the consumer client code</a>:</p>
<div class="ulist">
<ul>
<li>
<p>URL of Apicurio Registry</p>
</li>
<li>
<p>Apicurio Registry deserializer to use with the messages</p>
</li>
<li>
<p>Input data stream for deserialization</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The schema is then retrieved by the deserializer using a global ID written into the message being consumed.
The message received must, therefore, include a global ID as well as the message data.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># ...
[MAGIC_BYTE]
[GLOBAL_ID]
[MESSAGE DATA]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when you start Kafka and Apicurio Registry, you can access the schema to format messages received from the Kafka broker topic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-concepts-strategy-registry"><a class="anchor" href="#registry-serdes-concepts-strategy-registry"></a>Strategies to lookup a schema</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Kafka client serializer/deserializer uses a lookup <em>strategy</em> to determine the artifact ID or global ID under which the message schema is registered in Apicurio Registry.</p>
</div>
<div class="paragraph">
<p>For a given topic and message, you can use implementations of the following Java classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ArtifactIdStrategy</code> to return an artifact ID</p>
</li>
<li>
<p><code>GlobalIdStrategy</code> to return a global ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The artifact ID returned depends on whether the <em>key</em> or <em>value</em> in the message is being serialized.</p>
</div>
<div class="paragraph">
<p>The classes for each strategy are organized in the <code>io.apicurio.registry.utils.serde.strategy</code> package.</p>
</div>
<div class="paragraph">
<p>The default strategy is <code>TopicIdStrategy</code>, which looks for Apicurio Registry artifacts with the same name as the Kafka topic receiving messages.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public String artifactId(String topic, boolean isKey, T schema) {
    return String.format("%s-%s", topic, isKey ? "key" : "value");
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>topic</code> parameter is the name of the Kafka topic receiving the message.</p>
</li>
<li>
<p>The <code>isKey</code> parameter is <em>true</em> when the message key is being serialized, and <em>false</em> when the message value is being serialized.</p>
</li>
<li>
<p>The <code>schema</code> parameter is the schema of the message being serialized/deserialized.</p>
</li>
<li>
<p>The <code>artifactID</code> returned is the ID under which the schema is registered in Apicurio Registry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What lookup strategy you use depends on how and where you store your schema.
For example, you might use a strategy that uses a <em>record ID</em> if you have different Kafka topics with the same Avro message type.</p>
</div>
<h3 id="service-registry-concepts-artifactid-registry" class="discrete">Strategies to return an artifact ID</h3>
<div class="paragraph">
<p>Strategies to return an artifact ID based on an implementation of <code>ArtifactIdStrategy</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>RecordIdStrategy</code></dt>
<dd>
<p>Avro-specific strategy that uses the full name of the schema.</p>
</dd>
<dt class="hdlist1"><code>TopicRecordIdStrategy</code></dt>
<dd>
<p>Avro-specific strategy that uses the topic name and the full name of the schema.</p>
</dd>
<dt class="hdlist1"><code>TopicIdStrategy</code></dt>
<dd>
<p>(Default) strategy that uses the topic name and <code>key</code> or <code>value</code> suffix.</p>
</dd>
<dt class="hdlist1"><code>SimpleTopicIdStrategy</code></dt>
<dd>
<p>Simple strategy that only uses the topic name.</p>
</dd>
</dl>
</div>
<h3 id="service-registry-concepts-globalid-registry" class="discrete">Strategies to return a global ID</h3>
<div class="paragraph">
<p>Strategies to return a global ID based on an implementation of <code>GlobalIdStrategy</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>FindLatestIdStrategy</code></dt>
<dd>
<p>Strategy that returns the global ID of the latest schema version, based on an artifact ID.</p>
</dd>
<dt class="hdlist1"><code>FindBySchemaIdStrategy</code></dt>
<dd>
<p>Strategy that matches schema content, based on an artifact ID, to return a global ID.</p>
</dd>
<dt class="hdlist1"><code>GetOrCreateIdStrategy</code></dt>
<dd>
<p>Strategy that tries to get the latest schema, based on an artifact ID, and if it does not exist, it creates a new schema.</p>
</dd>
<dt class="hdlist1"><code>AutoRegisterIdStrategy</code></dt>
<dd>
<p>Strategy that updates the schema, and uses the global ID of the updated schema.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-concepts-constants-registry"><a class="anchor" href="#registry-serdes-concepts-constants-registry"></a>Apicurio Registry serializer/deserializer constants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure specific client serializer/deserializer (SerDe) services and schema lookup strategies directly into a client using the constants outlined in this section.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use specify the constants in a properties file, or a properties instance.</p>
</div>
<h3 id="_constants_for_serializerdeserializer_services" class="discrete">Constants for serializer/deserializer services</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class AbstractKafkaSerDe&lt;T extends AbstractKafkaSerDe&lt;T&gt;&gt; implements AutoCloseable {
   protected final Logger log = LoggerFactory.getLogger(getClass());

   public static final String REGISTRY_URL_CONFIG_PARAM = "apicurio.registry.url"; <i class="conum" data-value="1"></i><b>(1)</b>
   public static final String REGISTRY_CACHED_CONFIG_PARAM = "apicurio.registry.cached"; <i class="conum" data-value="2"></i><b>(2)</b>
   public static final String REGISTRY_ID_HANDLER_CONFIG_PARAM = "apicurio.registry.id-handler"; <i class="conum" data-value="3"></i><b>(3)</b>
   public static final String REGISTRY_CONFLUENT_ID_HANDLER_CONFIG_PARAM = "apicurio.registry.as-confluent"; <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>(Required) The URL of Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Allows the client to make the request and look up the information from a cache of previous results, to improve processing time.
If the cache is empty, the lookup is performed from Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Extends ID handling to support other ID formats and make them compatible with Apicurio Registry SerDe services.
For example, changing the ID format from <code>Long</code> to <code>Integer</code> supports the Confluent ID format.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A flag to simplify the handling of Confluent IDs. If set to <code>true</code>, an <code>Integer</code> is used for the global ID lookup.</td>
</tr>
</table>
</div>
<h3 id="_constants_for_lookup_strategies" class="discrete">Constants for lookup strategies</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class AbstractKafkaStrategyAwareSerDe&lt;T, S extends AbstractKafkaStrategyAwareSerDe&lt;T, S&gt;&gt; extends AbstractKafkaSerDe&lt;S&gt; {
   public static final String REGISTRY_ARTIFACT_ID_STRATEGY_CONFIG_PARAM = "apicurio.registry.artifact-id"; <i class="conum" data-value="1"></i><b>(1)</b>
   public static final String REGISTRY_GLOBAL_ID_STRATEGY_CONFIG_PARAM = "apicurio.registry.global-id"; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#service-registry-concepts-artifactid-registry">ArtifactId strategy</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#service-registry-concepts-globalid-registry">Global ID strategy</a>.</td>
</tr>
</table>
</div>
<h3 id="_constants_for_converters" class="discrete">Constants for converters</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SchemalessConverter&lt;T&gt; extends AbstractKafkaSerDe&lt;SchemalessConverter&lt;T&gt;&gt; implements Converter {
   public static final String REGISTRY_CONVERTER_SERIALIZER_PARAM = "apicurio.registry.converter.serializer"; <i class="conum" data-value="1"></i><b>(1)</b>
   public static final String REGISTRY_CONVERTER_DESERIALIZER_PARAM = "apicurio.registry.converter.deserializer"; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>(Required) Serializer to use with the converter.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>(Required) Deserializer to use with the converter.</td>
</tr>
</table>
</div>
<h3 id="_constants_for_avro_data_providers" class="discrete">Constants for Avro data providers</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface AvroDatumProvider&lt;T&gt; {
   String REGISTRY_AVRO_DATUM_PROVIDER_CONFIG_PARAM = "apicurio.registry.avro-datum-provider"; <i class="conum" data-value="1"></i><b>(1)</b>
   String REGISTRY_USE_SPECIFIC_AVRO_READER_CONFIG_PARAM = "apicurio.registry.use-specific-avro-reader"; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Avro Datum provider to write data to a schema, with or without reflection.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Flag to set to use an Avro-specific datum reader.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DefaultAvroDatumProvider (io.apicurio.registry.utils.serde.avro) <i class="conum" data-value="1"></i><b>(1)</b>
ReflectAvroDatumProvider (io.apicurio.registry.utils.serde.avro) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default datum reader.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Datum reader using reflection.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-register-registry"><a class="anchor" href="#registry-serdes-register-registry"></a>Registering a schema to Apicurio Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you have defined a schema in the appropriate format, such as <em>Apache Avro</em>, you can add the schema to Apicurio Registry.</p>
</div>
<div class="paragraph">
<p>You can add the schema using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Apicurio Registry web console</p>
</li>
<li>
<p>A curl command using the Apicurio Registry API</p>
</li>
<li>
<p>A Maven plugin supplied with Apicurio Registry</p>
</li>
<li>
<p>Schema configuration added to your client code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Client applications cannot use Apicurio Registry until you have registered your schemas.</p>
</div>
<h3 id="_apicurio_registry_web_console" class="discrete">Apicurio Registry web console</h3>
<div class="paragraph">
<p>Having installed Apicurio Registry, you connect to the web console from the <code>ui</code> endpoint:</p>
</div>
<div class="paragraph">
<p><code>http://MY-REGISTRY-URL/ui</code></p>
</div>
<div class="paragraph">
<p>From the console, you can add, view and configure schemas.
You can also create the rules that prevent invalid content being added to the registry.</p>
</div>
<h3 id="_curl_command_example" class="discrete">Curl command example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">curl -X POST -H "Content-type: application/json; artifactType=AVRO" \
  -H "X-Registry-ArtifactId: prices-value" \
  --data '{ <i class="conum" data-value="1"></i><b>(1)</b>
      "type":"record",
      "name":"price",
      "namespace":"com.redhat",
      "fields":[{"name":"symbol","type":"string"},
      {"name":"price","type":"string"}]
    }'
  https://my-cluster-service-registry-myproject.example.com/api/artifacts -s <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Avro schema</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>OpenShift route name that exposes Apicurio Registry</td>
</tr>
</table>
</div>
<h3 id="_maven_plugin_example" class="discrete">Maven plugin example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
&lt;groupId&gt;io.apicurio&lt;/groupId&gt;
&lt;artifactId&gt;apicurio-registry-maven-plugin&lt;/artifactId&gt;
&lt;version&gt;${registry.version}&lt;/version&gt;
&lt;executions&gt;
  &lt;execution&gt;
    &lt;phase&gt;generate-sources&lt;/phase&gt;
    &lt;goals&gt;
      &lt;goal&gt;register&lt;/goal&gt;
    &lt;/goals&gt;
    &lt;configuration&gt;
      &lt;registryUrl&gt;https://my-cluster-service-registry-myproject.example.com/api&lt;/registryUrl&gt;
      &lt;artifactType&gt;AVRO&lt;/artifactType&gt;
      &lt;artifacts&gt;
        &lt;schema1&gt;${project.basedir}/schemas/schema1.avsc&lt;/schema1&gt;
      &lt;/artifacts&gt;
    &lt;/configuration&gt;
  &lt;/execution&gt;
&lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<h3 id="_configuration_using_a_producer_client_example" class="discrete">Configuration using a producer client example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl_node1 = PropertiesUtil.property(clientProperties, "registry.url.node1", <i class="conum" data-value="1"></i><b>(1)</b>
    "https://my-cluster-service-registry-myproject.example.com/api");
try (RegistryService service = RegistryClient.create(registryUrl_node1)) {
    String artifactId = ApplicationImpl.INPUT_TOPIC + "-value";
    try {
        service.getArtifactMetaData(artifactId); <i class="conum" data-value="2"></i><b>(2)</b>
    } catch (WebApplicationException e) {
        CompletionStage &lt;ArtifactMetaData&gt; csa = service.createArtifact(
            ArtifactType.AVRO,
            artifactId,
            new ByteArrayInputStream(LogInput.SCHEMA$.toString().getBytes())
        );
        csa.toCompletableFuture().get();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The properties are registered. You can register properties against more than one node.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Check to see if the schema already exists based on the artifact ID.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-config-consumer-registry"><a class="anchor" href="#registry-serdes-config-consumer-registry"></a>Using a schema from a consumer client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This procedure describes how to configure a Kafka consumer client written in Java to use a schema from Apicurio Registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry is installed</p>
</li>
<li>
<p>The schema is registered with Apicurio Registry</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the client with the URL of Apicurio Registry.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">String registryUrl_node1 = PropertiesUtil.property(clientProperties, "registry.url.node1",
    "https://my-cluster-service-registry-myproject.example.com/api");
RegistryService service = RegistryClient.cached(registryUrl);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the client with the Apicurio Registry deserializer service.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Deserializer&lt;LogInput&gt; deserializer = new AvroKafkaDeserializer &lt;&gt; ( <i class="conum" data-value="1"></i><b>(1)</b>
    service,
    new DefaultAvroDatumProvider&lt;LogInput&gt;().setUseSpecificAvroReader(true)
);
Serde&lt;LogInput&gt; logSerde = Serdes.serdeFrom( <i class="conum" data-value="2"></i><b>(2)</b>
    new AvroKafkaSerializer&lt;&gt;(service),
    deserializer
);
KStream&lt;String, LogInput&gt; input = builder.stream( <i class="conum" data-value="3"></i><b>(3)</b>
    INPUT_TOPIC,
    Consumed.with(Serdes.String(), logSerde)
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The deserializer service provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The deserialization is in <em>Apache Avro</em> JSON format.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The input data for deserialization derived from the topic values consumed by the client.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-serdes-config-producer-registry"><a class="anchor" href="#registry-serdes-config-producer-registry"></a>Using a schema from a producer client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This procedure describes how to configure a Kafka producer client written in Java to use a schema from Apicurio Registry.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Apicurio Registry is installed</p>
</li>
<li>
<p>The schema is registered with Apicurio Registry</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the client with the URL of Apicurio Registry.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl_node1 = PropertiesUtil.property(clientProperties, "registry.url.node1",
    "https://my-cluster-service-registry-myproject.example.com/api");
RegistryService service = RegistryClient.cached(registryUrl);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the client with the serializer services, and the strategy to look up the schema in Apicurio Registry.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String registryUrl_node1 = PropertiesUtil.property(clientProperties, "registry.url.node1",
    "https://my-cluster-service-registry-myproject.example.com/api");

    clientProperties.put(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG, property(clientProperties, CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG, "my-cluster-kafka-bootstrap:9092"));
    clientProperties.put(AbstractKafkaSerDe.REGISTRY_URL_CONFIG_PARAM, registryUrl_node1); <i class="conum" data-value="1"></i><b>(1)</b>
    clientProperties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); <i class="conum" data-value="2"></i><b>(2)</b>
    clientProperties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, AvroKafkaSerializer.class.getName()); <i class="conum" data-value="3"></i><b>(3)</b>
    clientProperties.put(AbstractKafkaSerializer.REGISTRY_GLOBAL_ID_STRATEGY_CONFIG_PARAM, FindLatestIdStrategy.class.getName()); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Apicurio Registry URL.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The serializer service for the message <em>key</em> provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The serializer service for the message <em>value</em> provided by Apicurio Registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Lookup strategy to find the global ID for the schema. Matches the schema of the message against its global ID (artifact ID and schema version) in Apicurio Registry.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright Â© 2020 Red Hat, Inc. All rights reserved.</p>
</footer>
<script src="../../assets/js/site.js"></script>
<script async src="../../assets/js/vendor/highlight.js"></script>
  </body>
</html>
